'use client';
import { jsxs, jsx } from "react/jsx-runtime";
import { useEffect, useCallback, useMemo } from "react";
import { useAnalytics } from "../../core/analytics/hooks/useAnalytics.js";
import { SwapEvent } from "../../core/analytics/types.js";
import { TextInput } from "../../internal/components/TextInput.js";
import { useValue } from "../../internal/hooks/useValue.js";
import { getRoundedAmount } from "../../internal/utils/getRoundedAmount.js";
import { isValidAmount } from "../../internal/utils/isValidAmount.js";
import { cn, text, pressable } from "../../styles/theme.js";
import { TokenChip } from "../../token/components/TokenChip.js";
import "../../token/components/TokenRow.js";
import { TokenSelectDropdown } from "../../token/components/TokenSelectDropdown.js";
import "viem";
import { formatToDecimalString, formatUSD } from "../../internal/utils/formatter.js";
import { useSwapContext } from "./SwapProvider.js";
function SwapAmountInput({
  className,
  delayMs = 1e3,
  label,
  token,
  type,
  swappableTokens,
  render
}) {
  const {
    address,
    to,
    from,
    handleAmountChange
  } = useSwapContext();
  const {
    sendAnalytics
  } = useAnalytics();
  const source = useValue(type === "from" ? from : to);
  const destination = useValue(type === "from" ? to : from);
  const {
    setToken,
    setAmount,
    balance,
    amount,
    amountUSD
  } = source;
  useEffect(() => {
    if (token) {
      setToken == null ? void 0 : setToken(token);
    }
  }, [token, setToken]);
  const handleMaxButtonClick = useCallback(() => {
    if (!balance) {
      return;
    }
    setAmount(balance);
    handleAmountChange(type, balance);
  }, [balance, setAmount, handleAmountChange, type]);
  const handleChange = useCallback((amount2) => {
    handleAmountChange(type, amount2);
  }, [handleAmountChange, type]);
  const handleAnalyticsTokenSelected = useCallback((token2) => {
    sendAnalytics(SwapEvent.TokenSelected, {
      token: token2.symbol
    });
  }, [sendAnalytics]);
  const handleSetToken = useCallback((token2) => {
    setToken == null ? void 0 : setToken(token2);
    handleAmountChange(type, amount, token2);
    handleAnalyticsTokenSelected(token2);
  }, [amount, setToken, handleAmountChange, handleAnalyticsTokenSelected, type]);
  const sourceTokenOptions = useMemo(() => {
    return (swappableTokens == null ? void 0 : swappableTokens.filter(({
      symbol
    }) => {
      var _a;
      return symbol !== ((_a = destination.token) == null ? void 0 : _a.symbol);
    })) ?? [];
  }, [swappableTokens, destination.token]);
  const hasInsufficientBalance = type === "from" && Number(balance) < Number(amount);
  if (render) {
    return render({
      token: source,
      hasInsufficientBalance,
      setAmountToMax: handleMaxButtonClick,
      onSetToken: handleSetToken
    });
  }
  return /* @__PURE__ */ jsxs("div", { className: cn("ock:bg-ock-secondary ock:rounded-ock-default ock:my-0.5 ock:box-border ock:flex ock:h-[148px] ock:w-full ock:flex-col ock:items-start ock:p-4", className), "data-testid": "ockSwapAmountInput_Container", children: [
    /* @__PURE__ */ jsx("div", { className: cn(text.label2, "ock:text-ock-foreground-muted ock:flex ock:w-full ock:items-center ock:justify-between"), children: label }),
    /* @__PURE__ */ jsxs("div", { className: "ock:flex ock:w-full ock:items-center ock:justify-between", children: [
      /* @__PURE__ */ jsx(TextInput, { className: cn("ock:mr-2 ock:w-full ock:border-[none] ock:bg-transparent ock:font-display ock:text-[2.5rem] ock:leading-none ock:outline-none ock:truncate"), "aria-label": type === "from" ? "From amount" : "To amount", error: !!(hasInsufficientBalance && address), placeholder: "0.0", delayMs, value: formatToDecimalString(amount), setValue: setAmount, disabled: source.loading, onChange: handleChange, inputValidator: isValidAmount }),
      sourceTokenOptions.length > 0 ? /* @__PURE__ */ jsx(TokenSelectDropdown, { token: source.token, setToken: handleSetToken, options: sourceTokenOptions }) : source.token && /* @__PURE__ */ jsx(TokenChip, { className: pressable.inverse, token: source.token })
    ] }),
    /* @__PURE__ */ jsxs("div", { className: "ock:mt-4 ock:flex ock:w-full ock:items-center ock:justify-between", children: [
      /* @__PURE__ */ jsxs("div", { className: cn(text.label2, "ock:text-ock-foreground-muted"), children: [
        "~",
        formatUSD(amountUSD)
      ] }),
      /* @__PURE__ */ jsxs("div", { className: cn(text.label2, "ock:text-ock-foreground-muted ock:flex ock:grow ock:items-center ock:justify-end"), children: [
        balance && /* @__PURE__ */ jsx("span", { children: `Balance: ${getRoundedAmount(balance, 8)}` }),
        type === "from" && address && /* @__PURE__ */ jsx("button", { type: "button", className: cn(text.label1, "ock:text-ock-primary ock:flex ock:cursor-pointer ock:items-center ock:justify-center ock:px-2 ock:py-1"), "data-testid": "ockSwapAmountInput_MaxButton", onClick: handleMaxButtonClick, children: "Max" })
      ] })
    ] })
  ] });
}
export {
  SwapAmountInput
};
//# sourceMappingURL=SwapAmountInput.js.map
