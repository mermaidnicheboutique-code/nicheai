{"version":3,"file":"SwapSettingsSlippageInput.js","sources":["../../../src/swap/components/SwapSettingsSlippageInput.tsx"],"sourcesContent":["'use client';\nimport { useAnalytics } from '@/core/analytics/hooks/useAnalytics';\nimport { SwapEvent } from '@/core/analytics/types';\nimport { ComponentProps, useCallback, useId, useState } from 'react';\nimport { cn, pressable, text } from '@/styles/theme';\nimport type { SwapSettingsSlippageInputProps } from '../types';\nimport { useSwapContext } from './SwapProvider';\nimport { TextInput } from '@/internal/components/TextInput';\nimport { SLIPPAGE_SETTINGS, SlippageSettingsType } from '../constants';\n\nexport function SwapSettingsSlippageInput({\n  className,\n  render,\n}: SwapSettingsSlippageInputProps) {\n  const { sendAnalytics } = useAnalytics();\n  const {\n    config: { maxSlippage: defaultMaxSlippage },\n    updateLifecycleStatus,\n    lifecycleStatus,\n  } = useSwapContext();\n\n  // Set initial slippage values to match previous selection or default,\n  // ensuring consistency when dropdown is reopened\n  const [slippageSetting, setSlippageSetting] = useState<SlippageSettingsType>(\n    lifecycleStatus.statusData.maxSlippage === defaultMaxSlippage\n      ? SLIPPAGE_SETTINGS.AUTO\n      : SLIPPAGE_SETTINGS.CUSTOM,\n  );\n\n  const handleAnalyticsSlippageChange = useCallback(\n    (previousSlippage: number, newSlippage: number) => {\n      sendAnalytics(SwapEvent.SlippageChanged, {\n        previousSlippage,\n        slippage: newSlippage,\n      });\n    },\n    [sendAnalytics],\n  );\n\n  const updateSlippage = useCallback(\n    (newSlippage: number) => {\n      const currentSlippage = lifecycleStatus.statusData.maxSlippage;\n      if (newSlippage !== currentSlippage) {\n        handleAnalyticsSlippageChange(currentSlippage, newSlippage);\n\n        if (slippageSetting === SLIPPAGE_SETTINGS.AUTO) {\n          setSlippageSetting(SLIPPAGE_SETTINGS.CUSTOM);\n        }\n\n        updateLifecycleStatus({\n          statusName: 'slippageChange',\n          statusData: {\n            maxSlippage: newSlippage,\n          },\n        });\n      }\n    },\n    [\n      lifecycleStatus.statusData.maxSlippage,\n      updateLifecycleStatus,\n      handleAnalyticsSlippageChange,\n      slippageSetting,\n    ],\n  );\n\n  // Handles user input for custom slippage.\n  // Parses the input and updates slippage state.\n  const handleSlippageChange: ComponentProps<typeof TextInput>['onChange'] =\n    useCallback(\n      (newSlippage: string) => {\n        const parsedSlippage = Number.parseFloat(newSlippage);\n        const isValidNumber = !Number.isNaN(parsedSlippage);\n\n        // Update slippage to parsed value if valid, otherwise set to 0\n        updateSlippage(isValidNumber ? parsedSlippage : 0);\n      },\n      [updateSlippage],\n    );\n\n  // Toggles between auto and custom slippage settings\n  // Resets to default slippage when auto is selected\n  const handleSlippageSettingChange = useCallback(\n    (setting: string) => {\n      setSlippageSetting(setting as SlippageSettingsType);\n      if (setting === SLIPPAGE_SETTINGS.AUTO) {\n        updateSlippage(defaultMaxSlippage);\n      }\n    },\n    [defaultMaxSlippage, updateSlippage],\n  );\n\n  const slippageInputId = useId();\n\n  if (render) {\n    return render({\n      slippageSetting,\n      setSlippageSetting: handleSlippageSettingChange,\n      setSlippageValue: updateSlippage,\n    });\n  }\n\n  return (\n    <section\n      className={cn(\n        'bg-ock-background',\n        'border-ock-background-active',\n        'rounded-ock-default',\n        'flex items-center gap-2 flex-grow max-sm:pt-4',\n        className,\n      )}\n    >\n      <fieldset\n        className={cn(\n          'bg-ock-background',\n          'border-ock-background-active',\n          'rounded-ock-default',\n          'flex h-9 flex-1 rounded-xl border p-1',\n        )}\n      >\n        <legend className=\"sr-only\">Slippage Setting</legend>\n        {Object.values(SLIPPAGE_SETTINGS).map((setting) => (\n          <button\n            key={setting}\n            type=\"button\"\n            aria-current={slippageSetting === setting ? 'true' : undefined}\n            className={cn(\n              pressable.default,\n              'text-ock-foreground',\n              text.label1,\n              'rounded-ock-inner',\n              'flex-1 px-3 py-1 transition-colors',\n              // Highlight the button if it is selected\n              slippageSetting === setting\n                ? cn(\n                    'bg-ock-background-inverse',\n                    'text-ock-primary',\n                    'shadow-ock-default',\n                  )\n                : 'text-ock-foreground-muted',\n            )}\n            onClick={() => handleSlippageSettingChange(setting)}\n          >\n            {setting}\n          </button>\n        ))}\n      </fieldset>\n      <div\n        className={cn(\n          'bg-ock-background',\n          'border-ock-background-active',\n          'rounded-ock-default',\n          'flex h-9 w-24 items-center justify-between border px-2 py-1',\n          slippageSetting === SLIPPAGE_SETTINGS.AUTO && 'opacity-50',\n        )}\n      >\n        <label htmlFor={slippageInputId} className=\"sr-only\">\n          Slippage Percentage\n        </label>\n        <TextInput\n          id={slippageInputId}\n          type=\"text\"\n          value={String(lifecycleStatus.statusData.maxSlippage)}\n          onChange={handleSlippageChange}\n          placeholder=\"0\"\n          disabled={slippageSetting === SLIPPAGE_SETTINGS.AUTO}\n          className={cn(\n            'text-ock-foreground truncate',\n            text.label2,\n            'w-full flex-grow bg-transparent pl-1 font-normal leading-6 focus:outline-none',\n            slippageSetting === SLIPPAGE_SETTINGS.AUTO && 'cursor-not-allowed',\n          )}\n        />\n        <span\n          className={cn(\n            'bg-ock-background',\n            'text-ock-foreground',\n            text.label2,\n            'ml-1 flex-shrink-0 font-normal leading-6',\n          )}\n        >\n          %\n        </span>\n      </div>\n    </section>\n  );\n}\n"],"names":["SwapSettingsSlippageInput","className","render","sendAnalytics","useAnalytics","config","maxSlippage","defaultMaxSlippage","updateLifecycleStatus","lifecycleStatus","useSwapContext","slippageSetting","setSlippageSetting","useState","statusData","SLIPPAGE_SETTINGS","AUTO","CUSTOM","handleAnalyticsSlippageChange","useCallback","previousSlippage","newSlippage","SwapEvent","SlippageChanged","slippage","updateSlippage","currentSlippage","statusName","handleSlippageChange","parsedSlippage","Number","parseFloat","isValidNumber","isNaN","handleSlippageSettingChange","setting","slippageInputId","useId","setSlippageValue","cn","Object","values","map","undefined","pressable","default","text","label1","String","label2"],"mappings":"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"}