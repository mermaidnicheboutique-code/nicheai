{"version":3,"file":"SwapAmountInput.js","sources":["../../../src/swap/components/SwapAmountInput.tsx"],"sourcesContent":["'use client';\nimport { useCallback, useEffect, useMemo } from 'react';\nimport { useAnalytics } from '@/core/analytics/hooks/useAnalytics';\nimport { SwapEvent } from '@/core/analytics/types';\nimport { TextInput } from '@/internal/components/TextInput';\nimport { useValue } from '@/internal/hooks/useValue';\nimport { getRoundedAmount } from '@/internal/utils/getRoundedAmount';\nimport { isValidAmount } from '@/internal/utils/isValidAmount';\nimport { cn, pressable, text } from '@/styles/theme';\nimport type { Token } from '@/token';\nimport { TokenChip, TokenSelectDropdown } from '@/token';\nimport type { SwapAmountInputProps } from '../types';\nimport { formatToDecimalString, formatUSD } from '@/internal/utils/formatter';\nimport { useSwapContext } from './SwapProvider';\n\nexport function SwapAmountInput({\n  className,\n  delayMs = 1000,\n  label,\n  token,\n  type,\n  swappableTokens,\n  render,\n}: SwapAmountInputProps) {\n  const { address, to, from, handleAmountChange } = useSwapContext();\n  const { sendAnalytics } = useAnalytics();\n\n  const source = useValue(type === 'from' ? from : to);\n  const destination = useValue(type === 'from' ? to : from);\n  const { setToken, setAmount, balance, amount, amountUSD } = source;\n\n  useEffect(() => {\n    if (token) {\n      setToken?.(token);\n    }\n  }, [token, setToken]);\n\n  const handleMaxButtonClick = useCallback(() => {\n    if (!balance) {\n      return;\n    }\n    setAmount(balance);\n    handleAmountChange(type, balance);\n  }, [balance, setAmount, handleAmountChange, type]);\n\n  const handleChange = useCallback(\n    (amount: string) => {\n      handleAmountChange(type, amount);\n    },\n    [handleAmountChange, type],\n  );\n\n  const handleAnalyticsTokenSelected = useCallback(\n    (token: Token) => {\n      sendAnalytics(SwapEvent.TokenSelected, {\n        token: token.symbol,\n      });\n    },\n    [sendAnalytics],\n  );\n\n  const handleSetToken = useCallback(\n    (token: Token) => {\n      setToken?.(token);\n      handleAmountChange(type, amount, token);\n      handleAnalyticsTokenSelected(token);\n    },\n    [amount, setToken, handleAmountChange, handleAnalyticsTokenSelected, type],\n  );\n\n  // We are mocking the token selectors so I'm not able\n  // to test this since the components aren't actually rendering\n  const sourceTokenOptions = useMemo(() => {\n    return (\n      swappableTokens?.filter(\n        ({ symbol }: Token) => symbol !== destination.token?.symbol,\n      ) ?? []\n    );\n  }, [swappableTokens, destination.token]);\n\n  const hasInsufficientBalance =\n    type === 'from' && Number(balance) < Number(amount);\n\n  if (render) {\n    return render({\n      token: source,\n      hasInsufficientBalance,\n      setAmountToMax: handleMaxButtonClick,\n      onSetToken: handleSetToken,\n    });\n  }\n\n  return (\n    <div\n      className={cn(\n        'bg-ock-secondary rounded-ock-default my-0.5 box-border flex h-[148px] w-full flex-col items-start p-4',\n        className,\n      )}\n      data-testid=\"ockSwapAmountInput_Container\"\n    >\n      <div\n        className={cn(\n          text.label2,\n          'text-ock-foreground-muted flex w-full items-center justify-between',\n        )}\n      >\n        {label}\n      </div>\n      <div className=\"flex w-full items-center justify-between\">\n        <TextInput\n          className={cn(\n            'mr-2 w-full border-[none] bg-transparent font-display text-[2.5rem] leading-none outline-none truncate',\n          )}\n          aria-label={type === 'from' ? 'From amount' : 'To amount'}\n          error={!!(hasInsufficientBalance && address)}\n          placeholder=\"0.0\"\n          delayMs={delayMs}\n          value={formatToDecimalString(amount)}\n          setValue={setAmount}\n          disabled={source.loading}\n          onChange={handleChange}\n          inputValidator={isValidAmount}\n        />\n        {sourceTokenOptions.length > 0 ? (\n          <TokenSelectDropdown\n            token={source.token}\n            setToken={handleSetToken}\n            options={sourceTokenOptions}\n          />\n        ) : (\n          source.token && (\n            <TokenChip className={pressable.inverse} token={source.token} />\n          )\n        )}\n      </div>\n      <div className=\"mt-4 flex w-full items-center justify-between\">\n        <div className={cn(text.label2, 'text-ock-foreground-muted')}>\n          ~{formatUSD(amountUSD)}\n        </div>\n        <div\n          className={cn(\n            text.label2,\n            'text-ock-foreground-muted flex grow items-center justify-end',\n          )}\n        >\n          {balance && <span>{`Balance: ${getRoundedAmount(balance, 8)}`}</span>}\n          {type === 'from' && address && (\n            <button\n              type=\"button\"\n              className={cn(\n                text.label1,\n                'text-ock-primary flex cursor-pointer items-center justify-center px-2 py-1',\n              )}\n              data-testid=\"ockSwapAmountInput_MaxButton\"\n              onClick={handleMaxButtonClick}\n            >\n              Max\n            </button>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":["SwapAmountInput","className","delayMs","label","token","type","swappableTokens","render","address","to","from","handleAmountChange","useSwapContext","sendAnalytics","useAnalytics","source","useValue","destination","setToken","setAmount","balance","amount","amountUSD","useEffect","handleMaxButtonClick","useCallback","handleChange","handleAnalyticsTokenSelected","SwapEvent","TokenSelected","symbol","handleSetToken","sourceTokenOptions","useMemo","filter","hasInsufficientBalance","Number","setAmountToMax","onSetToken","cn","text","label2","formatToDecimalString","loading","isValidAmount","length","pressable","inverse","formatUSD","getRoundedAmount","label1"],"mappings":"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"}