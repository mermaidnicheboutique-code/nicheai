{"version":3,"file":"CheckoutProvider.js","sources":["../../../src/checkout/components/CheckoutProvider.tsx"],"sourcesContent":["import { useLifecycleStatus } from '@/internal/hooks/useLifecycleStatus';\nimport { openPopup } from '@/internal/utils/openPopup';\nimport {\n  createContext,\n  useCallback,\n  useContext,\n  useEffect,\n  useRef,\n  useState,\n} from 'react';\nimport type { Address, ContractFunctionParameters } from 'viem';\nimport { base } from 'viem/chains';\nimport { useAccount, useConnect, useSwitchChain } from 'wagmi';\nimport {\n  useWaitForTransactionReceipt,\n  useSendCalls,\n  useCallsStatus,\n} from 'wagmi';\nimport { coinbaseWallet } from 'wagmi/connectors';\nimport { useAnalytics } from '../../core/analytics/hooks/useAnalytics';\nimport {\n  type AnalyticsEventData,\n  CheckoutEvent,\n  CheckoutEventType,\n} from '../../core/analytics/types';\nimport { useValue } from '../../internal/hooks/useValue';\nimport { isUserRejectedRequestError } from '../../transaction/utils/isUserRejectedRequestError';\nimport { useOnchainKit } from '../../useOnchainKit';\nimport { useIsWalletACoinbaseSmartWallet } from '../../wallet/hooks/useIsWalletACoinbaseSmartWallet';\nimport {\n  CHECKOUT_LIFECYCLE_STATUS,\n  GENERIC_ERROR_MESSAGE,\n  NO_CONNECTED_ADDRESS_ERROR,\n  NO_CONTRACTS_ERROR,\n  USER_REJECTED_ERROR,\n} from '../constants';\nimport { CheckoutErrorCode } from '../constants';\nimport { useCommerceContracts } from '../hooks/useCommerceContracts';\nimport type {\n  CheckoutContextType,\n  CheckoutProviderProps,\n  LifecycleStatus,\n} from '../types';\nimport { ONRAMP_POPUP_HEIGHT, ONRAMP_POPUP_WIDTH } from '@/fund/constants';\nimport {\n  normalizeStatus,\n  normalizeTransactionId,\n} from '@/internal/utils/normalizeWagmi';\n\nconst emptyContext = {} as CheckoutContextType;\nexport const CheckoutContext = createContext<CheckoutContextType>(emptyContext);\n\n/**\n * @deprecated The <Checkout /> component and its related components and hooks are deprecated\n * and will be removed in a future version. We recommend looking at Base Pay for similar functionality.\n * @see {@link https://docs.base.org/base-account/guides/accept-payments}\n */\nexport function useCheckoutContext() {\n  const context = useContext(CheckoutContext);\n  if (context === emptyContext) {\n    throw new Error(\n      'useCheckoutContext must be used within a Checkout component',\n    );\n  }\n  return context;\n}\n\nexport function CheckoutProvider({\n  chargeHandler,\n  children,\n  isSponsored,\n  onStatus,\n  productId,\n}: CheckoutProviderProps) {\n  // Core hooks\n  const {\n    config: { appearance, paymaster } = {\n      appearance: { name: undefined, logo: undefined },\n      paymaster: undefined,\n    },\n  } = useOnchainKit();\n  const { address, chainId, isConnected } = useAccount();\n  const { connectAsync } = useConnect();\n  const { switchChainAsync } = useSwitchChain();\n  const [chargeId, setChargeId] = useState('');\n  const [transactionId, setTransactionId] = useState('');\n  const [errorMessage, setErrorMessage] = useState<string>('');\n  const isSmartWallet = useIsWalletACoinbaseSmartWallet();\n  const { sendAnalytics } = useAnalytics();\n\n  // Refs\n  const fetchedDataUseEffect = useRef<boolean>(false);\n  const fetchedDataHandleSubmit = useRef<boolean>(false);\n  const userRejectedRef = useRef<boolean>(false);\n  const contractsRef = useRef<ContractFunctionParameters[] | null>(null);\n  const insufficientBalanceRef = useRef<boolean>(false);\n  const priceInUSDCRef = useRef<string | undefined>('');\n\n  // Component lifecycle\n  const [lifecycleStatus, updateLifecycleStatus] =\n    useLifecycleStatus<LifecycleStatus>({\n      statusName: CHECKOUT_LIFECYCLE_STATUS.INIT,\n      statusData: {},\n    });\n\n  // Transaction hooks\n  const fetchContracts = useCommerceContracts({\n    chargeHandler,\n    productId,\n  });\n\n  // Helper function used in both `useEffect` and `handleSubmit` to fetch data from the Commerce API and set state and refs\n  const fetchData = useCallback(\n    async (address: Address) => {\n      updateLifecycleStatus({\n        statusName: CHECKOUT_LIFECYCLE_STATUS.FETCHING_DATA,\n        statusData: {},\n      });\n      const {\n        contracts,\n        chargeId: hydratedChargeId,\n        insufficientBalance,\n        priceInUSDC,\n        error,\n      } = await fetchContracts(address);\n      if (error) {\n        setErrorMessage(GENERIC_ERROR_MESSAGE);\n        updateLifecycleStatus({\n          statusName: CHECKOUT_LIFECYCLE_STATUS.ERROR,\n          statusData: {\n            code: CheckoutErrorCode.UNEXPECTED_ERROR,\n            error: (error as Error).name,\n            message: (error as Error).message,\n          },\n        });\n        return;\n      }\n      setChargeId(hydratedChargeId);\n      contractsRef.current = contracts;\n      insufficientBalanceRef.current = insufficientBalance;\n      priceInUSDCRef.current = priceInUSDC;\n      updateLifecycleStatus({\n        statusName: CHECKOUT_LIFECYCLE_STATUS.READY,\n        statusData: {\n          chargeId,\n          contracts: contractsRef.current || [],\n        },\n      });\n    },\n    [chargeId, fetchContracts, updateLifecycleStatus],\n  );\n\n  const { status, sendCallsAsync } = useSendCalls({\n    /* v8 ignore start */\n    mutation: {\n      onSuccess: (data) => {\n        setTransactionId(normalizeTransactionId(data));\n      },\n    },\n    /* v8 ignore stop */\n  });\n  const { data } = useCallsStatus({\n    id: transactionId,\n    query: {\n      /* v8 ignore next 5 */\n      refetchInterval: (query) => {\n        return normalizeStatus(query.state.data?.status) === 'success'\n          ? false\n          : 1000;\n      },\n      enabled: !!transactionId,\n    },\n  });\n  const transactionHash = data?.receipts?.[0]?.transactionHash;\n  const { data: receipt } = useWaitForTransactionReceipt({\n    hash: transactionHash,\n  });\n\n  // Component lifecycle emitters\n  useEffect(() => {\n    onStatus?.(lifecycleStatus);\n  }, [\n    lifecycleStatus,\n    lifecycleStatus.statusData, // Keep statusData, so that the effect runs when it changes\n    lifecycleStatus.statusName, // Keep statusName, so that the effect runs when it changes\n    onStatus,\n  ]);\n\n  // Set transaction pending status when writeContracts is pending\n  useEffect(() => {\n    if (status === 'pending') {\n      updateLifecycleStatus({\n        statusName: CHECKOUT_LIFECYCLE_STATUS.PENDING,\n        statusData: {},\n      });\n    }\n  }, [status, updateLifecycleStatus]);\n\n  // Trigger success status when receipt is generated by useWaitForTransactionReceipt\n  useEffect(() => {\n    if (!receipt) {\n      return;\n    }\n    updateLifecycleStatus({\n      statusName: CHECKOUT_LIFECYCLE_STATUS.SUCCESS,\n      statusData: {\n        transactionReceipts: [receipt],\n        chargeId: chargeId,\n        receiptUrl: `https://commerce.coinbase.com/pay/${chargeId}/receipt`,\n      },\n    });\n  }, [chargeId, receipt, updateLifecycleStatus]);\n\n  // We need to pre-load transaction data in `useEffect` when the wallet is already connected due to a Smart Wallet popup blocking issue in Safari iOS\n  useEffect(() => {\n    if (\n      lifecycleStatus.statusName === CHECKOUT_LIFECYCLE_STATUS.INIT &&\n      address &&\n      !fetchedDataHandleSubmit.current\n    ) {\n      fetchedDataUseEffect.current = true;\n      fetchData(address);\n    }\n  }, [address, fetchData, lifecycleStatus]);\n\n  const handleAnalytics = useCallback(\n    (event: CheckoutEventType, data: AnalyticsEventData[CheckoutEventType]) => {\n      sendAnalytics(event, data);\n    },\n    [sendAnalytics],\n  );\n\n  // eslint-disable-next-line complexity\n  const handleSubmit = useCallback(async () => {\n    try {\n      handleAnalytics(CheckoutEvent.CheckoutInitiated, {\n        address,\n        amount: Number(priceInUSDCRef.current),\n        productId: productId || '',\n      });\n\n      // Open Coinbase Commerce receipt\n      if (lifecycleStatus.statusName === CHECKOUT_LIFECYCLE_STATUS.SUCCESS) {\n        window.open(\n          `https://commerce.coinbase.com/pay/${chargeId}/receipt`,\n          '_blank',\n          'noopener,noreferrer',\n        );\n        return;\n      }\n      if (errorMessage === USER_REJECTED_ERROR) {\n        // Reset status if previous request was a rejection\n        setErrorMessage('');\n      }\n\n      let connectedAddress = address;\n      let connectedChainId = chainId;\n      if (!isConnected || !isSmartWallet) {\n        // Prompt for wallet connection\n        // This is defaulted to Coinbase Smart Wallet\n        fetchedDataHandleSubmit.current = true; // Set this here so useEffect does not run\n        const { accounts, chainId: _connectedChainId } = await connectAsync({\n          /* v8 ignore next 5 */\n          connector: coinbaseWallet({\n            appName: appearance?.name ?? undefined,\n            appLogoUrl: appearance?.logo ?? undefined,\n            preference: 'smartWalletOnly',\n          }),\n        });\n        connectedAddress = accounts[0];\n        connectedChainId = _connectedChainId;\n      }\n\n      // This shouldn't ever happen, but to make Typescript happy\n      /* v8 ignore start */\n      if (!connectedAddress) {\n        setErrorMessage(GENERIC_ERROR_MESSAGE);\n        updateLifecycleStatus({\n          statusName: CHECKOUT_LIFECYCLE_STATUS.ERROR,\n          statusData: {\n            code: CheckoutErrorCode.UNEXPECTED_ERROR,\n            error: NO_CONNECTED_ADDRESS_ERROR,\n            message: NO_CONNECTED_ADDRESS_ERROR,\n          },\n        });\n        return;\n      }\n      /* v8 ignore stop */\n\n      // Fetch contracts if not already done in useEffect\n      // Don't re-fetch contracts if the user rejected the previous request, and just use the cached data\n      /* v8 ignore next 3 */\n      if (!fetchedDataUseEffect.current && !userRejectedRef.current) {\n        await fetchData(connectedAddress);\n      }\n\n      // Switch chain, if applicable\n      if (connectedChainId !== base.id) {\n        await switchChainAsync({ chainId: base.id });\n      }\n\n      // Check for sufficient balance\n      if (insufficientBalanceRef.current && priceInUSDCRef.current) {\n        openPopup({\n          url: `https://keys.coinbase.com/fund?asset=USDC&chainId=8453&presetCryptoAmount=${priceInUSDCRef.current}`,\n          target: '_blank',\n          height: ONRAMP_POPUP_HEIGHT,\n          width: ONRAMP_POPUP_WIDTH,\n        });\n        // Reset state\n        insufficientBalanceRef.current = false;\n        priceInUSDCRef.current = undefined;\n        fetchedDataUseEffect.current = false;\n        return;\n      }\n\n      // Contracts weren't successfully fetched from `fetchContracts`\n      if (!contractsRef.current || contractsRef.current.length === 0) {\n        setErrorMessage(GENERIC_ERROR_MESSAGE);\n        updateLifecycleStatus({\n          statusName: CHECKOUT_LIFECYCLE_STATUS.ERROR,\n          statusData: {\n            code: CheckoutErrorCode.UNEXPECTED_ERROR,\n            error: NO_CONTRACTS_ERROR,\n            message: NO_CONTRACTS_ERROR,\n          },\n        });\n        return;\n      }\n\n      // Open keys.coinbase.com for payment\n      await sendCallsAsync({\n        calls: contractsRef.current.map((contract) => {\n          return {\n            to: contract.address,\n            abi: contract.abi,\n            functionName: contract.functionName,\n            args: contract.args,\n          };\n        }),\n        capabilities:\n          isSponsored && paymaster\n            ? {\n                paymasterService: {\n                  url: paymaster,\n                },\n              }\n            : undefined,\n      });\n    } catch (error) {\n      handleAnalytics(CheckoutEvent.CheckoutFailure, {\n        error: error instanceof Error ? error.message : 'Checkout failed',\n        metadata: { error: JSON.stringify(error) },\n      });\n\n      const isUserRejectedError =\n        (error as Error).message?.includes('User denied connection request') ||\n        isUserRejectedRequestError(error);\n      const errorCode = isUserRejectedError\n        ? CheckoutErrorCode.USER_REJECTED_ERROR\n        : CheckoutErrorCode.UNEXPECTED_ERROR;\n      const errorMessage = isUserRejectedError\n        ? USER_REJECTED_ERROR\n        : GENERIC_ERROR_MESSAGE;\n      if (isUserRejectedError) {\n        // Set the ref so that we can use the cached commerce API call\n        userRejectedRef.current = true;\n      }\n\n      setErrorMessage(errorMessage);\n      updateLifecycleStatus({\n        statusName: CHECKOUT_LIFECYCLE_STATUS.ERROR,\n        statusData: {\n          code: errorCode,\n          error: JSON.stringify(error),\n          message: errorMessage,\n        },\n      });\n    }\n  }, [\n    address,\n    appearance,\n    chainId,\n    chargeId,\n    connectAsync,\n    errorMessage,\n    fetchData,\n    isConnected,\n    isSmartWallet,\n    isSponsored,\n    lifecycleStatus.statusName,\n    paymaster,\n    switchChainAsync,\n    updateLifecycleStatus,\n    sendCallsAsync,\n    handleAnalytics,\n    productId,\n  ]);\n\n  const value = useValue({\n    errorMessage,\n    lifecycleStatus,\n    onSubmit: handleSubmit,\n    updateLifecycleStatus,\n  });\n  return (\n    <CheckoutContext.Provider value={value}>\n      {children}\n    </CheckoutContext.Provider>\n  );\n}\n"],"names":["emptyContext","CheckoutContext","createContext","useCheckoutContext","context","useContext","Error","CheckoutProvider","chargeHandler","children","isSponsored","onStatus","productId","config","appearance","paymaster","name","undefined","logo","useOnchainKit","address","chainId","isConnected","useAccount","connectAsync","useConnect","switchChainAsync","useSwitchChain","chargeId","setChargeId","useState","transactionId","setTransactionId","errorMessage","setErrorMessage","isSmartWallet","useIsWalletACoinbaseSmartWallet","sendAnalytics","useAnalytics","fetchedDataUseEffect","useRef","fetchedDataHandleSubmit","userRejectedRef","contractsRef","insufficientBalanceRef","priceInUSDCRef","lifecycleStatus","updateLifecycleStatus","useLifecycleStatus","statusName","CHECKOUT_LIFECYCLE_STATUS","INIT","statusData","fetchContracts","useCommerceContracts","fetchData","useCallback","FETCHING_DATA","contracts","hydratedChargeId","insufficientBalance","priceInUSDC","error","GENERIC_ERROR_MESSAGE","ERROR","code","CheckoutErrorCode","UNEXPECTED_ERROR","message","current","READY","status","sendCallsAsync","useSendCalls","mutation","onSuccess","data","normalizeTransactionId","useCallsStatus","id","query","refetchInterval","normalizeStatus","state","enabled","transactionHash","receipts","receipt","useWaitForTransactionReceipt","hash","useEffect","PENDING","SUCCESS","transactionReceipts","receiptUrl","handleAnalytics","event","handleSubmit","CheckoutEvent","CheckoutInitiated","amount","Number","window","open","USER_REJECTED_ERROR","connectedAddress","connectedChainId","accounts","_connectedChainId","connector","coinbaseWallet","appName","appLogoUrl","preference","NO_CONNECTED_ADDRESS_ERROR","base","url","target","height","ONRAMP_POPUP_HEIGHT","width","ONRAMP_POPUP_WIDTH","length","NO_CONTRACTS_ERROR","calls","map","contract","to","abi","functionName","args","capabilities","paymasterService","CheckoutFailure","metadata","JSON","stringify","isUserRejectedError","includes","isUserRejectedRequestError","errorCode","value","useValue","onSubmit"],"mappings":"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"}