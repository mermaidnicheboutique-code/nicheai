'use client';
import { jsx, jsxs, Fragment } from "react/jsx-runtime";
import { useMemo, useEffect } from "react";
import { useAnalytics } from "../../core/analytics/hooks/useAnalytics.js";
import { CheckoutEvent } from "../../core/analytics/types.js";
import { Spinner } from "../../internal/components/Spinner.js";
import { useIcon } from "../../internal/hooks/useIcon.js";
import { cn, text, pressable } from "../../styles/theme.js";
import { useCheckoutContext } from "./CheckoutProvider.js";
import { CHECKOUT_LIFECYCLE_STATUS } from "../constants.js";
function CheckoutButton({
  className,
  coinbaseBranded,
  disabled,
  icon,
  text: text$1 = "Pay"
}) {
  if (coinbaseBranded) {
    icon = "coinbasePay";
    text$1 = "Pay";
  }
  const {
    lifecycleStatus,
    onSubmit
  } = useCheckoutContext();
  const iconSvg = useIcon({
    icon
  });
  const {
    sendAnalytics
  } = useAnalytics();
  const isLoading = (lifecycleStatus == null ? void 0 : lifecycleStatus.statusName) === CHECKOUT_LIFECYCLE_STATUS.PENDING;
  const isFetchingData = (lifecycleStatus == null ? void 0 : lifecycleStatus.statusName) === CHECKOUT_LIFECYCLE_STATUS.FETCHING_DATA;
  const isDisabled = disabled || isLoading || isFetchingData;
  const buttonText = useMemo(() => {
    if ((lifecycleStatus == null ? void 0 : lifecycleStatus.statusName) === CHECKOUT_LIFECYCLE_STATUS.SUCCESS) {
      return "View payment details";
    }
    return text$1;
  }, [lifecycleStatus == null ? void 0 : lifecycleStatus.statusName, text$1]);
  const shouldRenderIcon = buttonText === text$1 && iconSvg;
  useEffect(() => {
    var _a;
    if ((lifecycleStatus == null ? void 0 : lifecycleStatus.statusName) === CHECKOUT_LIFECYCLE_STATUS.SUCCESS && lifecycleStatus.statusData) {
      const {
        transactionReceipts,
        chargeId
      } = lifecycleStatus.statusData;
      const transactionHash = (_a = transactionReceipts == null ? void 0 : transactionReceipts[0]) == null ? void 0 : _a.transactionHash;
      if (transactionHash && chargeId) {
        sendAnalytics(CheckoutEvent.CheckoutSuccess, {
          chargeHandlerId: chargeId,
          transactionHash
        });
      }
    }
  }, [lifecycleStatus, sendAnalytics]);
  return /* @__PURE__ */ jsx("button", { className: cn(coinbaseBranded ? pressable.coinbaseBranding : pressable.primary, "ock:rounded-ock-default", isDisabled && pressable.disabled, text.headline, "ock:mt-4 ock:w-full ock:px-4 ock:py-3", className), onClick: onSubmit, type: "button", disabled: isDisabled, "aria-label": isLoading ? "Transaction in progress" : buttonText, children: /* @__PURE__ */ jsx("div", { className: "ock:flex ock:items-center ock:justify-center ock:whitespace-nowrap", children: isLoading ? /* @__PURE__ */ jsx(Spinner, { className: "ock:h-5 ock:w-5" }) : /* @__PURE__ */ jsxs(Fragment, { children: [
    shouldRenderIcon && /* @__PURE__ */ jsx("div", { className: "ock:mr-2 ock:flex ock:h-5 ock:w-5 ock:shrink-0 ock:items-center ock:justify-center", children: iconSvg }),
    /* @__PURE__ */ jsx("span", { className: cn(text.headline, coinbaseBranded ? "ock:text-gray-50" : "ock:text-ock-foreground-inverse"), children: buttonText })
  ] }) }) });
}
export {
  CheckoutButton
};
//# sourceMappingURL=CheckoutButton.js.map
