{"version":3,"file":"useCommerceContracts.js","sources":["../../../src/checkout/hooks/useCommerceContracts.tsx"],"sourcesContent":["import { useCallback } from 'react';\nimport { type Address, formatUnits } from 'viem';\nimport { useConfig } from 'wagmi';\nimport type { UseCommerceContractsParams } from '../types';\nimport { getCommerceContracts } from '../utils/getCommerceContracts';\nimport { getUSDCBalance } from '../utils/getUSDCBalance';\nimport { handlePayRequest } from '../utils/handlePayRequest';\n\nexport const useCommerceContracts = ({\n  chargeHandler,\n  productId,\n}: UseCommerceContractsParams) => {\n  const config = useConfig();\n\n  return useCallback(\n    async (address: Address) => {\n      try {\n        // Make the Pay request to the appropriate endpoint\n        // `productId` to create and hydrate a charge for a product (serverless)\n        // `chargeHandler` for a developer-provided callback used to return a charge ID (e.g. from the merchant backend)\n        const [response, usdcBalance] = await Promise.all([\n          handlePayRequest({\n            address,\n            chargeHandler,\n            productId,\n          }),\n          getUSDCBalance({\n            address,\n            config,\n          }),\n        ]);\n\n        // Set the `chargeId`\n        const { id: chargeId } = response;\n\n        // Retrieve commerce contracts from response\n        const contracts = getCommerceContracts({\n          transaction: response,\n        });\n\n        // Calculate user's USDC balance\n        const priceInUSDC = formatUnits(\n          BigInt(response.callData.feeAmount) +\n            BigInt(response.callData.recipientAmount),\n          6,\n        );\n\n        // Set insufficient balance flag, if applicable\n        const insufficientBalance =\n          Number.parseFloat(usdcBalance) < Number.parseFloat(priceInUSDC);\n\n        return { chargeId, contracts, insufficientBalance, priceInUSDC };\n      } catch (error) {\n        console.error('Unexpected error fetching contracts:', error);\n        return {\n          chargeId: '',\n          contracts: null,\n          insufficientBalance: false,\n          error,\n        };\n      }\n    },\n    [config, chargeHandler, productId],\n  );\n};\n"],"names":["useCommerceContracts","chargeHandler","productId","config","useConfig","useCallback","address","response","usdcBalance","Promise","all","handlePayRequest","getUSDCBalance","id","chargeId","contracts","getCommerceContracts","transaction","priceInUSDC","formatUnits","BigInt","callData","feeAmount","recipientAmount","insufficientBalance","Number","parseFloat","error"],"mappings":";;;;;;AAQO,MAAMA,uBAAuBA,CAAC;AAAA,EACnCC;AAAAA,EACAC;AAC0B,MAAM;AAChC,QAAMC,SAASC,UAAU;AAElBC,SAAAA,YACL,OAAOC,YAAqB;AACtB,QAAA;AAII,YAAA,CAACC,UAAUC,WAAW,IAAI,MAAMC,QAAQC,IAAI,CAChDC,iBAAiB;AAAA,QACfL;AAAAA,QACAL;AAAAA,QACAC;AAAAA,MACD,CAAA,GACDU,eAAe;AAAA,QACbN;AAAAA,QACAH;AAAAA,MACD,CAAA,CAAC,CACH;AAGK,YAAA;AAAA,QAAEU,IAAIC;AAAAA,MAAAA,IAAaP;AAGzB,YAAMQ,YAAYC,qBAAqB;AAAA,QACrCC,aAAaV;AAAAA,MAAAA,CACd;AAGD,YAAMW,cAAcC,YAClBC,OAAOb,SAASc,SAASC,SAAS,IAChCF,OAAOb,SAASc,SAASE,eAAe,GAC1C,CACF;AAGA,YAAMC,sBACJC,OAAOC,WAAWlB,WAAW,IAAIiB,OAAOC,WAAWR,WAAW;AAEzD,aAAA;AAAA,QAAEJ;AAAAA,QAAUC;AAAAA,QAAWS;AAAAA,QAAqBN;AAAAA,MAAY;AAAA,aACxDS,OAAO;AACNA,cAAAA,MAAM,wCAAwCA,KAAK;AACpD,aAAA;AAAA,QACLb,UAAU;AAAA,QACVC,WAAW;AAAA,QACXS,qBAAqB;AAAA,QACrBG;AAAAA,MACF;AAAA,IAAA;AAAA,EAGJ,GAAA,CAACxB,QAAQF,eAAeC,SAAS,CACnC;AACF;"}