{"version":3,"file":"useDotsPath.js","sources":["../../../../src/internal/components/QrCode/useDotsPath.ts"],"sourcesContent":["import { useMemo } from 'react';\n\ntype LogoConfig = {\n  hasLogo: boolean;\n  logoSize: number;\n  logoMargin: number;\n  logoBorderRadius: number;\n  matrixLength: number;\n  dotSize: number;\n};\n\nconst squareMask = [\n  [1, 1, 1, 1, 1, 1, 1],\n  [1, 0, 0, 0, 0, 0, 1],\n  [1, 0, 0, 0, 0, 0, 1],\n  [1, 0, 0, 0, 0, 0, 1],\n  [1, 0, 0, 0, 0, 0, 1],\n  [1, 0, 0, 0, 0, 0, 1],\n  [1, 1, 1, 1, 1, 1, 1],\n];\n\nconst dotMask = [\n  [0, 0, 0, 0, 0, 0, 0],\n  [0, 0, 0, 0, 0, 0, 0],\n  [0, 0, 1, 1, 1, 0, 0],\n  [0, 0, 1, 1, 1, 0, 0],\n  [0, 0, 1, 1, 1, 0, 0],\n  [0, 0, 0, 0, 0, 0, 0],\n  [0, 0, 0, 0, 0, 0, 0],\n];\n\nfunction getDistance(x1: number, y1: number, x2: number, y2: number) {\n  return Math.sqrt((y2 - y1) ** 2 + (x2 - x1) ** 2);\n}\n\nfunction shouldSkipMaskedCell(\n  i: number,\n  j: number,\n  matrixLength: number,\n): boolean {\n  return Boolean(\n    squareMask[i]?.[j] ||\n      squareMask[i - matrixLength + CORNER_SIZE]?.[j] ||\n      squareMask[i]?.[j - matrixLength + CORNER_SIZE] ||\n      dotMask[i]?.[j] ||\n      dotMask[i - matrixLength + CORNER_SIZE]?.[j] ||\n      dotMask[i]?.[j - matrixLength + CORNER_SIZE],\n  );\n}\n\nfunction shouldSkipLogoArea(\n  i: number,\n  j: number,\n  {\n    hasLogo,\n    logoSize,\n    logoMargin,\n    logoBorderRadius,\n    matrixLength,\n    dotSize,\n  }: LogoConfig,\n): boolean {\n  if (!hasLogo) {\n    return false;\n  }\n\n  const logoAndMarginTotalSize = logoSize + logoMargin * 2;\n  const logoSizeInDots = logoAndMarginTotalSize / dotSize;\n  const midpoint = Math.floor(matrixLength / 2);\n  const isRoundLogo = logoBorderRadius >= logoSize / 2;\n\n  if (isRoundLogo) {\n    const logoRadiusInDots = logoSizeInDots / 2;\n    const distFromMiddleInDots = getDistance(j, i, midpoint, midpoint);\n    return distFromMiddleInDots - 0.5 <= logoRadiusInDots;\n  }\n\n  const numDotsOffCenterToHide = Math.ceil(logoSizeInDots / 2);\n  return (\n    i <= midpoint + numDotsOffCenterToHide &&\n    i >= midpoint - numDotsOffCenterToHide &&\n    j <= midpoint + numDotsOffCenterToHide &&\n    j >= midpoint - numDotsOffCenterToHide\n  );\n}\n\nfunction getDotPath(centerX: number, centerY: number, radius: number): string {\n  return `\n    M ${centerX - radius} ${centerY}\n    A ${radius} ${radius} 0 1 1 ${centerX + radius} ${centerY}\n    A ${radius} ${radius} 0 1 1 ${centerX - radius} ${centerY}`;\n}\n\nexport const CORNER_SIZE = 7;\n\ntype UseDotsPathProps = {\n  matrix: number[][];\n  size: number;\n  logoSize: number;\n  logoMargin: number;\n  logoBorderRadius: number;\n  hasLogo: boolean;\n};\n\nexport function useDotsPath({\n  matrix,\n  size,\n  logoSize,\n  logoMargin,\n  logoBorderRadius,\n  hasLogo,\n}: UseDotsPathProps): string {\n  const dotsPath = useMemo(() => {\n    const cellSize = size / matrix.length;\n    let path = '';\n    const matrixLength = matrix.length;\n    const dotSize = size / matrixLength;\n\n    matrix.forEach((row, i) => {\n      row.forEach((column, j) => {\n        if (\n          shouldSkipMaskedCell(i, j, matrixLength) ||\n          shouldSkipLogoArea(i, j, {\n            hasLogo,\n            logoSize,\n            logoMargin,\n            logoBorderRadius,\n            matrixLength,\n            dotSize,\n          })\n        ) {\n          return;\n        }\n\n        if (column) {\n          const centerX = cellSize * j + cellSize / 2;\n          const centerY = cellSize * i + cellSize / 2;\n          path += getDotPath(centerX, centerY, cellSize / 2);\n        }\n      });\n    });\n\n    return path;\n  }, [hasLogo, logoBorderRadius, logoMargin, logoSize, matrix, size]);\n\n  return dotsPath;\n}\n"],"names":["squareMask","dotMask","getDistance","x1","y1","x2","y2","Math","sqrt","shouldSkipMaskedCell","i","j","matrixLength","Boolean","CORNER_SIZE","shouldSkipLogoArea","hasLogo","logoSize","logoMargin","logoBorderRadius","dotSize","logoAndMarginTotalSize","logoSizeInDots","midpoint","floor","isRoundLogo","logoRadiusInDots","distFromMiddleInDots","numDotsOffCenterToHide","ceil","getDotPath","centerX","centerY","radius","useDotsPath","matrix","size","dotsPath","useMemo","cellSize","length","path","forEach","row","column"],"mappings":"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"}