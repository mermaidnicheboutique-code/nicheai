{"version":3,"file":"Draggable.js","sources":["../../../../src/internal/components/Draggable/Draggable.tsx"],"sourcesContent":["'use client';\n\n// import { zIndex } from '@/styles/constants';\nimport { cn } from '@/styles/theme';\nimport { useCallback, useEffect, useRef, useState } from 'react';\nimport { getBoundedPosition } from './getBoundedPosition';\nimport { useRespositionOnWindowResize } from './useRepositionOnResize';\n\ntype DraggableProps = {\n  children: React.ReactNode;\n  gridSize?: number;\n  startingPosition?: { x: number; y: number };\n  snapToGrid?: boolean;\n  disabled?: boolean;\n};\n\nexport function Draggable({\n  children,\n  gridSize = 1,\n  startingPosition = { x: 20, y: 20 },\n  snapToGrid = false,\n  disabled = false,\n}: DraggableProps) {\n  const [position, setPosition] = useState(startingPosition);\n  const [dragOffset, setDragOffset] = useState({ x: 0, y: 0 });\n  const [dragStartPosition, setDragStartPosition] = useState({ x: 0, y: 0 });\n  const [isDragging, setIsDragging] = useState(false);\n  const draggableRef = useRef<HTMLDivElement | null>(null);\n\n  const calculateSnapToGrid = useCallback(\n    (positionValue: number) => {\n      return Math.round(positionValue / gridSize) * gridSize;\n    },\n    [gridSize],\n  );\n\n  const handleDragStart = useCallback(\n    (e: React.PointerEvent) => {\n      if (disabled) {\n        return;\n      }\n\n      setIsDragging(true);\n      setDragStartPosition({ x: e.clientX, y: e.clientY });\n      setDragOffset({\n        x: e.clientX - position.x,\n        y: e.clientY - position.y,\n      });\n    },\n    [position, disabled],\n  );\n\n  useEffect(() => {\n    if (!isDragging) {\n      return;\n    }\n\n    const handleGlobalMove = (e: PointerEvent) => {\n      const newPosition = getBoundedPosition({\n        draggableRef,\n        position: {\n          x: e.clientX - dragOffset.x,\n          y: e.clientY - dragOffset.y,\n        },\n      });\n      setPosition(newPosition);\n    };\n\n    const handleGlobalEnd = (e: PointerEvent) => {\n      const moveDistance = Math.hypot(\n        e.clientX - dragStartPosition.x,\n        e.clientY - dragStartPosition.y,\n      );\n\n      if (moveDistance > 2) {\n        e.preventDefault();\n        e.stopPropagation();\n        const clickEvent = (e2: MouseEvent) => {\n          e2.preventDefault();\n          e2.stopPropagation();\n          document.removeEventListener('click', clickEvent, true);\n        };\n        document.addEventListener('click', clickEvent, true);\n      }\n\n      setPosition((prev) => ({\n        x: snapToGrid ? calculateSnapToGrid(prev.x) : prev.x,\n        y: snapToGrid ? calculateSnapToGrid(prev.y) : prev.y,\n      }));\n      setIsDragging(false);\n    };\n\n    document.addEventListener('pointermove', handleGlobalMove);\n    document.addEventListener('pointerup', handleGlobalEnd);\n\n    return () => {\n      document.removeEventListener('pointermove', handleGlobalMove);\n      document.removeEventListener('pointerup', handleGlobalEnd);\n    };\n  }, [\n    isDragging,\n    dragOffset,\n    snapToGrid,\n    calculateSnapToGrid,\n    dragStartPosition,\n  ]);\n\n  useRespositionOnWindowResize(draggableRef, position, setPosition);\n\n  return (\n    <div\n      ref={draggableRef}\n      data-testid=\"ockDraggable\"\n      className={cn(\n        'fixed touch-none select-none',\n        'cursor-grab active:cursor-grabbing',\n      )}\n      style={{\n        left: `${position.x}px`,\n        top: `${position.y}px`,\n      }}\n      onPointerDown={handleDragStart}\n    >\n      {children}\n    </div>\n  );\n}\n"],"names":["Draggable","children","gridSize","startingPosition","x","y","snapToGrid","disabled","position","setPosition","useState","dragOffset","setDragOffset","dragStartPosition","setDragStartPosition","isDragging","setIsDragging","draggableRef","useRef","calculateSnapToGrid","useCallback","positionValue","Math","round","handleDragStart","e","clientX","clientY","useEffect","handleGlobalMove","newPosition","getBoundedPosition","handleGlobalEnd","moveDistance","hypot","preventDefault","stopPropagation","clickEvent","e2","removeEventListener","addEventListener","prev","cn","left","top"],"mappings":"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"}