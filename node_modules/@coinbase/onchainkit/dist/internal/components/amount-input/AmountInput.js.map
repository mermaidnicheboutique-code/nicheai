{"version":3,"file":"AmountInput.js","sources":["../../../../src/internal/components/amount-input/AmountInput.tsx"],"sourcesContent":["import { useInputResize } from '@/internal/hooks/useInputResize';\nimport { cn, text } from '@/styles/theme';\nimport { useCallback, useEffect, useRef } from 'react';\nimport { useAmountInput } from '@/internal/hooks/useAmountInput';\nimport { isValidAmount } from '@/internal/utils/isValidAmount';\nimport { TextInput } from '../TextInput';\n\ntype AmountInputProps = {\n  asset: string;\n  currency: string;\n  fiatAmount: string;\n  cryptoAmount: string;\n  selectedInputType: 'fiat' | 'crypto';\n  setFiatAmount: (value: string) => void;\n  setCryptoAmount: (value: string) => void;\n  exchangeRate: string;\n  delayMs?: number;\n  className?: string;\n  textClassName?: string;\n};\n\nexport function AmountInput({\n  fiatAmount,\n  cryptoAmount,\n  asset,\n  selectedInputType,\n  currency,\n  setFiatAmount,\n  setCryptoAmount,\n  exchangeRate,\n  delayMs,\n  className,\n  textClassName,\n}: AmountInputProps) {\n  const containerRef = useRef<HTMLDivElement | null>(null);\n  const wrapperRef = useRef<HTMLDivElement | null>(null);\n  const inputRef = useRef<HTMLInputElement | null>(null);\n  const measureRef = useRef<HTMLSpanElement | null>(null);\n  const labelRef = useRef<HTMLSpanElement | null>(null);\n\n  const currencyOrAsset = selectedInputType === 'fiat' ? currency : asset;\n  const value = selectedInputType === 'fiat' ? fiatAmount : cryptoAmount;\n\n  const updateScale = useInputResize(\n    containerRef,\n    wrapperRef,\n    inputRef,\n    measureRef,\n    labelRef,\n  );\n\n  const { handleChange } = useAmountInput({\n    setFiatAmount,\n    setCryptoAmount,\n    selectedInputType,\n    exchangeRate,\n  });\n\n  const handleAmountChange = useCallback(\n    (value: string) => {\n      handleChange(value, () => {\n        if (inputRef.current) {\n          inputRef.current.focus();\n        }\n      });\n    },\n    [handleChange],\n  );\n\n  useEffect(() => {\n    updateScale();\n  }, [value, updateScale]);\n\n  const selectedInputTypeRef = useRef(selectedInputType);\n\n  useEffect(() => {\n    /**\n     * We need to focus the input when the input type changes\n     * but not on the initial render.\n     */\n    if (selectedInputTypeRef.current !== selectedInputType) {\n      selectedInputTypeRef.current = selectedInputType;\n      handleFocusInput();\n    }\n  }, [selectedInputType]);\n\n  const handleFocusInput = () => {\n    if (inputRef.current) {\n      inputRef.current.focus();\n    }\n  };\n\n  return (\n    <div\n      ref={containerRef}\n      data-testid=\"ockAmountInputContainer\"\n      className={cn('relative h-24 cursor-text', className)}\n    >\n      <div className=\"absolute inset-x-0 top-6 bottom-4\">\n        <div className=\"relative flex h-14\">\n          <div ref={wrapperRef} className=\"flex flex-shrink-0 items-center\">\n            <TextInput\n              className={cn(\n                text.body,\n                'border-none bg-transparent',\n                'text-6xl leading-none outline-none',\n                '[appearance:textfield]',\n                '[&::-webkit-inner-spin-button]:m-0 [&::-webkit-inner-spin-button]:appearance-none',\n                '[&::-webkit-outer-spin-button]:m-0 [&::-webkit-outer-spin-button]:appearance-none',\n                textClassName,\n              )}\n              value={value}\n              onChange={handleAmountChange}\n              delayMs={delayMs}\n              inputValidator={isValidAmount}\n              ref={inputRef}\n              inputMode=\"decimal\"\n              placeholder=\"0\"\n            />\n            <div className=\"ml-1\">\n              <span\n                className={cn(\n                  text.body,\n                  'text-ock-foreground-disabled',\n                  'flex items-center justify-center bg-transparent',\n                  'text-6xl leading-none outline-none',\n                  textClassName,\n                )}\n                data-testid=\"ockCurrencySpan\"\n              >\n                {currencyOrAsset}\n              </span>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Hidden span for measuring text width\n          Without this span the input field would not adjust its width based on the text width and would look like this:\n          [0.12--------Empty Space-------][ETH] - As you can see the currency symbol is far away from the inputted value\n\n          With this span we can measure the width of the text in the input field and set the width of the input field to match the text width\n          [0.12][ETH] - Now the currency symbol is displayed next to the input field\n      */}\n      <span\n        data-testid=\"ockHiddenSpan\"\n        ref={measureRef}\n        className={cn(\n          text.body,\n          'border-none bg-transparent',\n          'text-6xl leading-none outline-none',\n          'pointer-events-none absolute whitespace-nowrap opacity-0',\n          'left-[-99999px]', // Hide the span from the DOM\n        )}\n      >\n        {value ? `${value}.` : '0.'}\n      </span>\n    </div>\n  );\n}\n"],"names":["AmountInput","fiatAmount","cryptoAmount","asset","selectedInputType","currency","setFiatAmount","setCryptoAmount","exchangeRate","delayMs","className","textClassName","containerRef","useRef","wrapperRef","inputRef","measureRef","labelRef","currencyOrAsset","value","updateScale","useInputResize","handleChange","useAmountInput","handleAmountChange","useCallback","current","focus","useEffect","selectedInputTypeRef","handleFocusInput","cn","text","body","isValidAmount"],"mappings":";;;;;;;AAqBO,SAASA,YAAY;AAAA,EAC1BC;AAAAA,EACAC;AAAAA,EACAC;AAAAA,EACAC;AAAAA,EACAC;AAAAA,EACAC;AAAAA,EACAC;AAAAA,EACAC;AAAAA,EACAC;AAAAA,EACAC;AAAAA,EACAC;AACgB,GAAG;AACbC,QAAAA,eAAeC,OAA8B,IAAI;AACjDC,QAAAA,aAAaD,OAA8B,IAAI;AAC/CE,QAAAA,WAAWF,OAAgC,IAAI;AAC/CG,QAAAA,aAAaH,OAA+B,IAAI;AAChDI,QAAAA,WAAWJ,OAA+B,IAAI;AAE9CK,QAAAA,kBAAkBd,sBAAsB,SAASC,WAAWF;AAC5DgB,QAAAA,QAAQf,sBAAsB,SAASH,aAAaC;AAE1D,QAAMkB,cAAcC,eAClBT,cACAE,YACAC,UACAC,YACAC,QACF;AAEM,QAAA;AAAA,IAAEK;AAAAA,MAAiBC,eAAe;AAAA,IACtCjB;AAAAA,IACAC;AAAAA,IACAH;AAAAA,IACAI;AAAAA,EAAAA,CACD;AAEKgB,QAAAA,qBAAqBC,YACzB,CAACN,WAAkB;AACjBG,iBAAaH,QAAO,MAAM;AACxB,UAAIJ,SAASW,SAAS;AACpBX,iBAASW,QAAQC,MAAM;AAAA,MAAA;AAAA,IACzB,CACD;AAAA,EAAA,GAEH,CAACL,YAAY,CACf;AAEAM,YAAU,MAAM;AACF,gBAAA;AAAA,EAAA,GACX,CAACT,OAAOC,WAAW,CAAC;AAEjBS,QAAAA,uBAAuBhB,OAAOT,iBAAiB;AAErDwB,YAAU,MAAM;AAKVC,QAAAA,qBAAqBH,YAAYtB,mBAAmB;AACtDyB,2BAAqBH,UAAUtB;AACd,uBAAA;AAAA,IAAA;AAAA,EACnB,GACC,CAACA,iBAAiB,CAAC;AAEtB,QAAM0B,mBAAmBA,MAAM;AAC7B,QAAIf,SAASW,SAAS;AACpBX,eAASW,QAAQC,MAAM;AAAA,IAAA;AAAA,EAE3B;AAGE,SAAA,qBAAC,OACC,EAAA,KAAKf,cACL,eAAY,2BACZ,WAAWmB,GAAgCrB,yCAAAA,SAAS,GAEpD,UAAA;AAAA,IAAA,oBAAC,OAAI,EAAA,WAAU,qDACb,UAAA,oBAAC,OAAI,EAAA,WAAU,kCACb,UAAA,qBAAC,OAAI,EAAA,KAAKI,YAAY,WAAU,+CAC9B,UAAA;AAAA,MAAC,oBAAA,WAAA,EACC,WAAWiB,GACTC,KAAKC,MAAI,sCAAA,kDAAA,8BAAA,6FAAA,6FAMTtB,aACF,GACA,OACA,UAAUa,oBACV,SACA,gBAAgBU,eAChB,KAAKnB,UACL,WAAU,WACV,aAAY,IAAG,CAAA;AAAA,0BAEhB,OAAI,EAAA,WAAU,YACb,UAAC,oBAAA,QAAA,EACC,WAAWgB,GACTC,KAAKC,+JAILtB,aACF,GACA,eAAY,mBAEXO,2BACH,EACF,CAAA;AAAA,IAAA,EACF,CAAA,EACF,CAAA,GACF;AAAA,wBASC,QACC,EAAA,eAAY,iBACZ,KAAKF,YACL,WAAWe,GACTC,KAAKC,MAKP,sCAAA,kDAAA,4EAAA,qBAAA,GAECd,kBAAQ,GAAGA,KAAK,MAAM,KACzB,CAAA;AAAA,EAAA,GACF;AAEJ;"}