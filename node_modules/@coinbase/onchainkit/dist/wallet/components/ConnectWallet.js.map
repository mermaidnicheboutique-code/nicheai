{"version":3,"file":"ConnectWallet.js","sources":["../../../src/wallet/components/ConnectWallet.tsx"],"sourcesContent":["'use client';\nimport { Avatar, Name } from '@/identity';\nimport { ReactNode, useCallback, useContext, useMemo } from 'react';\nimport { useEffect, useState } from 'react';\nimport { useAccount, useConnect } from 'wagmi';\nimport { useAnalytics } from '@/core/analytics/hooks/useAnalytics';\nimport { WalletEvent } from '@/core/analytics/types';\nimport { IdentityProvider } from '@/identity/components/IdentityProvider';\nimport { Spinner } from '@/internal/components/Spinner';\nimport { cn, pressable, text } from '../../styles/theme';\nimport { useOnchainKit } from '@/useOnchainKit';\nimport { WalletModal } from './WalletModal';\nimport {\n  useWalletContext,\n  WalletContext,\n  WalletProvider,\n  type WalletContextType,\n} from './WalletProvider';\nimport { WithRenderProps } from '@/internal/types';\nimport { MiniKitContext } from '@/minikit/MiniKitProvider';\nimport { Button } from '@/ui/Button';\nimport { IfInMiniApp } from '@/minikit/components/IfInMiniApp';\nimport { useMiniKit } from '@/minikit';\n\nexport type ConnectWalletProps = WithRenderProps<{\n  /** Children can be utilized to display customized content when the wallet is connected. */\n  children?: ReactNode;\n  /** Optional className override for button element */\n  className?: string;\n  /** Optional callback function to execute when the wallet is connected. */\n  onConnect?: () => void;\n  /** Optional disconnected display override */\n  disconnectedLabel?: ReactNode;\n  /** Custom render function for complete control of button rendering */\n  render?: ({\n    label,\n    onClick,\n    context,\n    status,\n    isLoading,\n  }: {\n    label: ReactNode;\n    onClick: () => void;\n    context: WalletContextType;\n    status: 'disconnected' | 'connecting' | 'connected';\n    isLoading: boolean;\n  }) => ReactNode;\n}>;\n\nfunction MiniAppDefaultChildren() {\n  const { context } = useMiniKit();\n\n  return (\n    <>\n      <Avatar\n        className=\"h-6 w-6\"\n        name={context?.user.displayName}\n        avatar={context?.user.pfpUrl}\n      />\n      <Name name={context?.user.displayName} />\n    </>\n  );\n}\n\nfunction ConnectWalletContent({\n  children = (\n    <IfInMiniApp\n      fallback={\n        <>\n          <Avatar className=\"h-6 w-6\" />\n          <Name />\n        </>\n      }\n    >\n      <MiniAppDefaultChildren />\n    </IfInMiniApp>\n  ),\n  className,\n  onConnect,\n  disconnectedLabel = 'Connect Wallet',\n  render,\n}: ConnectWalletProps) {\n  const { config = { wallet: { display: undefined } } } = useOnchainKit();\n  const walletContext = useWalletContext();\n  const {\n    isConnectModalOpen,\n    setIsConnectModalOpen,\n    isSubComponentOpen,\n    setIsSubComponentOpen,\n    handleClose,\n  } = walletContext;\n  const {\n    address: accountAddress,\n    status,\n    connector: accountConnector,\n  } = useAccount();\n  const { connectors, connect, status: connectStatus } = useConnect();\n  const { sendAnalytics } = useAnalytics();\n  const [hasClickedConnect, setHasClickedConnect] = useState(false);\n  const miniKitContext = useContext(MiniKitContext);\n  const isWalletModalEnabled = useMemo(() => {\n    return config?.wallet?.display === 'modal' && !miniKitContext?.context;\n  }, [config?.wallet?.display, miniKitContext?.context]);\n\n  const connector = accountConnector || connectors[0];\n  const isLoading = connectStatus === 'pending' || status === 'connecting';\n\n  const handleToggle = useCallback(() => {\n    if (isSubComponentOpen) {\n      handleClose();\n    } else {\n      setIsSubComponentOpen(true);\n    }\n  }, [isSubComponentOpen, handleClose, setIsSubComponentOpen]);\n\n  const handleCloseConnectModal = useCallback(() => {\n    setIsConnectModalOpen(false);\n  }, [setIsConnectModalOpen]);\n\n  const handleOpenConnectModal = useCallback(() => {\n    setIsConnectModalOpen(true);\n    setHasClickedConnect(true);\n  }, [setIsConnectModalOpen]);\n\n  const handleAnalyticsSuccess = useCallback(() => {\n    if (!accountAddress || !connector) return;\n\n    sendAnalytics(WalletEvent.ConnectSuccess, {\n      address: accountAddress,\n      walletProvider: connector?.name,\n    });\n  }, [sendAnalytics, connector, accountAddress]);\n\n  const handleAnalyticsError = useCallback(\n    (errorMessage: string, component: string) => {\n      const walletProvider = connector?.name;\n      sendAnalytics(WalletEvent.ConnectError, {\n        error: errorMessage,\n        metadata: {\n          connector: walletProvider,\n          component,\n        },\n      });\n    },\n    [sendAnalytics, connector],\n  );\n\n  useEffect(() => {\n    if (status !== 'connected') return;\n\n    if (hasClickedConnect && onConnect) {\n      onConnect();\n      setHasClickedConnect(false);\n    }\n\n    handleAnalyticsSuccess();\n  }, [\n    status,\n    hasClickedConnect,\n    onConnect,\n    accountAddress,\n    connector,\n    handleAnalyticsSuccess,\n  ]);\n\n  const handleConnectClick = useCallback(() => {\n    if (isWalletModalEnabled) {\n      handleOpenConnectModal();\n      setHasClickedConnect(true);\n      sendAnalytics(WalletEvent.ConnectInitiated, {\n        component: 'WalletModal',\n      });\n      return;\n    }\n\n    sendAnalytics(WalletEvent.ConnectInitiated, {\n      component: 'ConnectWallet',\n    });\n    connect(\n      { connector },\n      {\n        onSuccess: () => {\n          onConnect?.();\n          handleAnalyticsSuccess();\n        },\n        onError: (error) => {\n          handleAnalyticsError(error.message, 'ConnectWallet');\n        },\n      },\n    );\n  }, [\n    isWalletModalEnabled,\n    connect,\n    connector,\n    handleAnalyticsError,\n    handleAnalyticsSuccess,\n    handleOpenConnectModal,\n    onConnect,\n    sendAnalytics,\n  ]);\n\n  const buttonContent = useMemo(() => {\n    if (isLoading) return <Spinner />;\n\n    if (status === 'disconnected') return disconnectedLabel;\n\n    return (\n      <div className=\"flex items-center justify-center gap-2\">{children}</div>\n    );\n  }, [isLoading, status, disconnectedLabel, children]);\n\n  if (render) {\n    return (\n      <ConnectWalletRenderHandler\n        label={buttonContent}\n        onClick={handleConnectClick}\n        isLoading={isLoading}\n        render={render}\n        isWalletModalEnabled={isWalletModalEnabled}\n      />\n    );\n  }\n\n  if (status === 'disconnected') {\n    return (\n      <div className=\"flex\" data-testid=\"ockConnectWallet_Container\">\n        <Button\n          type=\"button\"\n          data-testid=\"ockConnectButton\"\n          className={cn('inline-flex min-w-[153px]', className)}\n          onClick={handleConnectClick}\n        >\n          {buttonContent}\n        </Button>\n        {isWalletModalEnabled && (\n          <WalletModal\n            isOpen={isConnectModalOpen}\n            onClose={handleCloseConnectModal}\n          />\n        )}\n      </div>\n    );\n  }\n\n  if (isLoading) {\n    return (\n      <div className=\"flex\" data-testid=\"ockConnectWallet_Container\">\n        <button\n          type=\"button\"\n          data-testid=\"ockConnectAccountButtonInner\"\n          className={cn(\n            pressable.primary,\n            text.headline,\n            'text-ock-foreground-inverse',\n            'inline-flex min-w-[153px] items-center justify-center rounded-xl px-4 py-3',\n            pressable.disabled,\n            className,\n          )}\n          disabled={true}\n        >\n          {buttonContent}\n        </button>\n      </div>\n    );\n  }\n\n  return (\n    <IdentityProvider address={accountAddress}>\n      <div className=\"flex gap-4\" data-testid=\"ockConnectWallet_Container\">\n        <button\n          type=\"button\"\n          data-testid=\"ockConnectWallet_Connected\"\n          className={cn(\n            pressable.secondary,\n            'rounded-ock-default',\n            'text-ock-foreground',\n            'px-4 py-3',\n            isSubComponentOpen &&\n              'bg-ock-secondary-active hover:bg-ock-secondary-active',\n            className,\n          )}\n          onClick={handleToggle}\n        >\n          <div className=\"flex items-center justify-center gap-2\">\n            {children}\n          </div>\n        </button>\n      </div>\n    </IdentityProvider>\n  );\n}\n\nfunction ConnectWalletRenderHandler({\n  label,\n  onClick,\n  isLoading,\n  render,\n  isWalletModalEnabled,\n}: {\n  label: ReactNode;\n  onClick: () => void;\n  isLoading: boolean;\n  render: NonNullable<ConnectWalletProps['render']>;\n  isWalletModalEnabled: boolean;\n}) {\n  const walletContext = useWalletContext();\n  const { isConnectModalOpen, setIsConnectModalOpen } = walletContext;\n  const { status, address } = useAccount();\n\n  if (status === 'disconnected') {\n    return (\n      <>\n        {render({\n          label,\n          onClick,\n          context: walletContext,\n          status: 'disconnected',\n          isLoading,\n        })}\n        {isWalletModalEnabled && (\n          <WalletModal\n            isOpen={isConnectModalOpen}\n            onClose={() => setIsConnectModalOpen(false)}\n          />\n        )}\n      </>\n    );\n  }\n\n  if (isLoading) {\n    return render({\n      label: <Spinner />,\n      onClick,\n      context: walletContext,\n      status: 'connecting',\n      isLoading,\n    });\n  }\n\n  return (\n    <IdentityProvider address={address}>\n      {render({\n        label,\n        onClick,\n        context: walletContext,\n        status: 'connected',\n        isLoading,\n      })}\n    </IdentityProvider>\n  );\n}\n\nexport function ConnectWallet(props: ConnectWalletProps) {\n  // Using `useContext` because `useWalletContext` will throw if there is no\n  // Provider up the tree.\n  const walletContext = useContext(WalletContext);\n\n  if (!walletContext) {\n    return (\n      <WalletProvider>\n        <ConnectWalletContent {...props} />\n      </WalletProvider>\n    );\n  }\n\n  return <ConnectWalletContent {...props} />;\n}\n"],"names":["MiniAppDefaultChildren","context","useMiniKit","user","displayName","pfpUrl","ConnectWalletContent","children","className","onConnect","disconnectedLabel","render","config","wallet","display","undefined","useOnchainKit","walletContext","useWalletContext","isConnectModalOpen","setIsConnectModalOpen","isSubComponentOpen","setIsSubComponentOpen","handleClose","address","accountAddress","status","connector","accountConnector","useAccount","connectors","connect","connectStatus","useConnect","sendAnalytics","useAnalytics","hasClickedConnect","setHasClickedConnect","useState","miniKitContext","useContext","MiniKitContext","isWalletModalEnabled","useMemo","isLoading","handleToggle","useCallback","handleCloseConnectModal","handleOpenConnectModal","handleAnalyticsSuccess","WalletEvent","ConnectSuccess","walletProvider","name","handleAnalyticsError","errorMessage","component","ConnectError","error","metadata","useEffect","handleConnectClick","ConnectInitiated","onSuccess","onError","message","buttonContent","cn","pressable","primary","text","headline","disabled","secondary","ConnectWalletRenderHandler","label","onClick","ConnectWallet","props","WalletContext"],"mappings":"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"}