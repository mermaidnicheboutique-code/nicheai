{"version":3,"file":"getSwapQuote.js","sources":["../../src/api/getSwapQuote.ts"],"sourcesContent":["import { RequestContext, RequestContextType } from '@/core/network/constants';\nimport { SwapMessage } from '@/swap/constants';\nimport { UNSUPPORTED_AMOUNT_REFERENCE_ERROR_CODE } from '@/swap/constants';\nimport { CDP_GET_SWAP_QUOTE } from '@/core/network/definitions/swap';\nimport { sendRequest } from '@/core/network/request';\nimport type { SwapQuoteParams } from '@/swap/types';\nimport { getSwapErrorCode } from '@/swap/utils/getSwapErrorCode';\nimport type {\n  GetSwapQuoteParams,\n  GetSwapQuoteResponse,\n  SwapAPIParams,\n} from './types';\nimport { getAPIParamsForToken } from './utils/getAPIParamsForToken';\nimport { buildErrorStruct } from './utils/buildErrorStruct';\n\n/**\n * Retrieves a quote for a swap from Token A to Token B.\n */\nexport async function getSwapQuote(\n  params: GetSwapQuoteParams,\n  _context: RequestContextType = RequestContext.API,\n): Promise<GetSwapQuoteResponse> {\n  // Default parameters\n  const defaultParams = {\n    amountReference: 'from' as const,\n    isAmountInDecimals: false,\n  };\n  let apiParams = getAPIParamsForToken({\n    ...defaultParams,\n    ...params,\n  });\n  if ('error' in apiParams) {\n    return apiParams;\n  }\n\n  if (params.useAggregator && params.amountReference === 'to') {\n    console.error(SwapMessage.UNSUPPORTED_AMOUNT_REFERENCE);\n    return {\n      code: UNSUPPORTED_AMOUNT_REFERENCE_ERROR_CODE,\n      error: SwapMessage.UNSUPPORTED_AMOUNT_REFERENCE,\n      message: '',\n    };\n  }\n\n  if (!params.useAggregator) {\n    apiParams = {\n      v2Enabled: true,\n      ...apiParams,\n    };\n  }\n  if (params.maxSlippage) {\n    let slippagePercentage = params.maxSlippage;\n    // Adjust slippage for V1 API (aggregator)\n    // V1 expects slippage in tenths of a percent (e.g., 30 = 3%)\n    if (params.useAggregator) {\n      slippagePercentage = (Number(params.maxSlippage) * 10).toString();\n    }\n    apiParams = {\n      slippagePercentage: slippagePercentage,\n      ...apiParams,\n    };\n  }\n\n  try {\n    const res = await sendRequest<SwapAPIParams, SwapQuoteParams>(\n      CDP_GET_SWAP_QUOTE,\n      [apiParams],\n      _context,\n    );\n    if (res.error) {\n      return buildErrorStruct({\n        code: getSwapErrorCode('quote', res.error?.code),\n        error: res.error.message,\n        message: '',\n      });\n    }\n    return res.result;\n  } catch {\n    return buildErrorStruct({\n      code: getSwapErrorCode('uncaught-quote'),\n      error: 'Something went wrong',\n      message: '',\n    });\n  }\n}\n"],"names":["getSwapQuote","params","_context","RequestContext","API","defaultParams","amountReference","isAmountInDecimals","apiParams","getAPIParamsForToken","useAggregator","error","SwapMessage","UNSUPPORTED_AMOUNT_REFERENCE","code","UNSUPPORTED_AMOUNT_REFERENCE_ERROR_CODE","message","v2Enabled","maxSlippage","slippagePercentage","Number","toString","res","sendRequest","CDP_GET_SWAP_QUOTE","buildErrorStruct","getSwapErrorCode","result"],"mappings":";;;;;;;AAkBA,eAAsBA,aACpBC,QACAC,WAA+BC,eAAeC,KACf;;AAE/B,QAAMC,gBAAgB;AAAA,IACpBC,iBAAiB;AAAA,IACjBC,oBAAoB;AAAA,EACtB;AACA,MAAIC,YAAYC,qBAAqB;AAAA,IACnC,GAAGJ;AAAAA,IACH,GAAGJ;AAAAA,EAAAA,CACJ;AACD,MAAI,WAAWO,WAAW;AACjBA,WAAAA;AAAAA,EAAAA;AAGT,MAAIP,OAAOS,iBAAiBT,OAAOK,oBAAoB,MAAM;AACnDK,YAAAA,MAAMC,YAAYC,4BAA4B;AAC/C,WAAA;AAAA,MACLC,MAAMC;AAAAA,MACNJ,OAAOC,YAAYC;AAAAA,MACnBG,SAAS;AAAA,IACX;AAAA,EAAA;AAGE,MAAA,CAACf,OAAOS,eAAe;AACb,gBAAA;AAAA,MACVO,WAAW;AAAA,MACX,GAAGT;AAAAA,IACL;AAAA,EAAA;AAEF,MAAIP,OAAOiB,aAAa;AACtB,QAAIC,qBAAqBlB,OAAOiB;AAGhC,QAAIjB,OAAOS,eAAe;AACxBS,4BAAsBC,OAAOnB,OAAOiB,WAAW,IAAI,IAAIG,SAAS;AAAA,IAAA;AAEtD,gBAAA;AAAA,MACVF;AAAAA,MACA,GAAGX;AAAAA,IACL;AAAA,EAAA;AAGE,MAAA;AACF,UAAMc,MAAM,MAAMC,YAChBC,oBACA,CAAChB,SAAS,GACVN,QACF;AACA,QAAIoB,IAAIX,OAAO;AACb,aAAOc,iBAAiB;AAAA,QACtBX,MAAMY,iBAAiB,UAASJ,SAAIX,UAAJW,mBAAWR,IAAI;AAAA,QAC/CH,OAAOW,IAAIX,MAAMK;AAAAA,QACjBA,SAAS;AAAA,MAAA,CACV;AAAA,IAAA;AAEH,WAAOM,IAAIK;AAAAA,EAAAA,QACL;AACN,WAAOF,iBAAiB;AAAA,MACtBX,MAAMY,iBAAiB,gBAAgB;AAAA,MACvCf,OAAO;AAAA,MACPK,SAAS;AAAA,IAAA,CACV;AAAA,EAAA;AAEL;"}