{"version":3,"file":"buildPayTransaction.js","sources":["../../src/api/buildPayTransaction.ts"],"sourcesContent":["import { RequestContext, RequestContextType } from '@/core/network/constants';\nimport {\n  CDP_CREATE_PRODUCT_CHARGE,\n  CDP_HYDRATE_CHARGE,\n} from '@/core/network/definitions/pay';\nimport { type JSONRPCResult, sendRequest } from '@/core/network/request';\nimport type {\n  BuildPayTransactionParams,\n  BuildPayTransactionResponse,\n  CreateProductChargeParams,\n  HydrateChargeAPIParams,\n} from './types';\nimport { getPayErrorMessage } from './utils/getPayErrorMessage';\nimport { ApiErrorCode } from './constants';\nimport { buildErrorStruct } from './utils/buildErrorStruct';\n\nexport async function buildPayTransaction(\n  params: BuildPayTransactionParams,\n  _context: RequestContextType = RequestContext.API,\n): Promise<BuildPayTransactionResponse> {\n  const { address, chargeId, productId } = params;\n\n  try {\n    let res: JSONRPCResult<BuildPayTransactionResponse>;\n    if (chargeId) {\n      res = await sendRequest<\n        HydrateChargeAPIParams,\n        BuildPayTransactionResponse\n      >(\n        CDP_HYDRATE_CHARGE,\n        [\n          {\n            sender: address,\n            chargeId,\n          },\n        ],\n        _context,\n      );\n    } else if (productId) {\n      res = await sendRequest<\n        CreateProductChargeParams,\n        BuildPayTransactionResponse\n      >(\n        CDP_CREATE_PRODUCT_CHARGE,\n        [\n          {\n            sender: address,\n            productId,\n          },\n        ],\n        _context,\n      );\n    } else {\n      return buildErrorStruct({\n        code: ApiErrorCode.AmBPTa01,\n        error: 'No chargeId or productId provided',\n        message: getPayErrorMessage(),\n      });\n    }\n    if (res.error) {\n      return buildErrorStruct({\n        code: ApiErrorCode.AmBPTa02,\n        error: res.error.message,\n        message: getPayErrorMessage(res.error?.code),\n      });\n    }\n    return res.result;\n  } catch {\n    return buildErrorStruct({\n      code: ApiErrorCode.AmBPTa03,\n      error: 'Something went wrong',\n      message: getPayErrorMessage(),\n    });\n  }\n}\n"],"names":["buildPayTransaction","params","_context","RequestContext","API","address","chargeId","productId","res","sendRequest","CDP_HYDRATE_CHARGE","sender","CDP_CREATE_PRODUCT_CHARGE","buildErrorStruct","code","ApiErrorCode","AmBPTa01","error","message","getPayErrorMessage","AmBPTa02","result","AmBPTa03"],"mappings":";;;;;;AAgBA,eAAsBA,oBACpBC,QACAC,WAA+BC,eAAeC,KACR;;AAChC,QAAA;AAAA,IAAEC;AAAAA,IAASC;AAAAA,IAAUC;AAAAA,EAAAA,IAAcN;AAErC,MAAA;AACEO,QAAAA;AACJ,QAAIF,UAAU;AACN,YAAA,MAAMG,YAIVC,oBACA,CACE;AAAA,QACEC,QAAQN;AAAAA,QACRC;AAAAA,MACD,CAAA,GAEHJ,QACF;AAAA,eACSK,WAAW;AACd,YAAA,MAAME,YAIVG,2BACA,CACE;AAAA,QACED,QAAQN;AAAAA,QACRE;AAAAA,MACD,CAAA,GAEHL,QACF;AAAA,IAAA,OACK;AACL,aAAOW,iBAAiB;AAAA,QACtBC,MAAMC,aAAaC;AAAAA,QACnBC,OAAO;AAAA,QACPC,SAASC,mBAAmB;AAAA,MAAA,CAC7B;AAAA,IAAA;AAEH,QAAIX,IAAIS,OAAO;AACb,aAAOJ,iBAAiB;AAAA,QACtBC,MAAMC,aAAaK;AAAAA,QACnBH,OAAOT,IAAIS,MAAMC;AAAAA,QACjBA,SAASC,oBAAmBX,SAAIS,UAAJT,mBAAWM,IAAI;AAAA,MAAA,CAC5C;AAAA,IAAA;AAEH,WAAON,IAAIa;AAAAA,EAAAA,QACL;AACN,WAAOR,iBAAiB;AAAA,MACtBC,MAAMC,aAAaO;AAAAA,MACnBL,OAAO;AAAA,MACPC,SAASC,mBAAmB;AAAA,IAAA,CAC7B;AAAA,EAAA;AAEL;"}