{"version":3,"file":"useMintAnalytics.js","sources":["../../../src/nft/hooks/useMintAnalytics.ts"],"sourcesContent":["import { useAnalytics } from '@/core/analytics/hooks/useAnalytics';\nimport { MintEvent } from '@/core/analytics/types';\nimport { useNFTContext } from '@/nft/components/NFTProvider';\nimport type { LifecycleStatus } from '@/transaction/types';\nimport { useEffect, useMemo, useRef, useState } from 'react';\nimport { useAccount } from 'wagmi';\n\nexport const useMintAnalytics = () => {\n  const [transactionState, setTransactionState] = useState<\n    LifecycleStatus['statusName'] | null\n  >(null);\n  const successSent = useRef(false);\n  const errorSent = useRef(false);\n  const { sendAnalytics } = useAnalytics();\n  const { address } = useAccount();\n\n  const { contractAddress, tokenId, quantity, isSponsored } = useNFTContext();\n\n  const analyticsData = useMemo(() => {\n    if (!tokenId || !address) {\n      return null;\n    }\n\n    return {\n      address,\n      contractAddress,\n      tokenId,\n      quantity,\n      isSponsored: isSponsored ?? false,\n    };\n  }, [address, contractAddress, tokenId, quantity, isSponsored]);\n\n  useEffect(() => {\n    if (!analyticsData) {\n      return;\n    }\n\n    if (transactionState === 'buildingTransaction') {\n      successSent.current = false;\n      errorSent.current = false;\n      sendAnalytics(MintEvent.MintInitiated, analyticsData);\n    }\n\n    if (transactionState === 'success' && !successSent.current) {\n      successSent.current = true;\n      sendAnalytics(MintEvent.MintSuccess, {\n        ...analyticsData,\n        amountMinted: quantity,\n      });\n    }\n\n    if (transactionState === 'error' && !errorSent.current) {\n      errorSent.current = true;\n      sendAnalytics(MintEvent.MintFailure, {\n        error: 'Transaction failed',\n        metadata: analyticsData,\n      });\n    }\n  }, [transactionState, quantity, analyticsData, sendAnalytics]);\n\n  const handleQuantityChange = (newQuantity: number) => {\n    sendAnalytics(MintEvent.MintQuantityChanged, {\n      quantity: newQuantity,\n    });\n  };\n\n  return {\n    setTransactionState,\n    handleQuantityChange,\n  };\n};\n"],"names":["useMintAnalytics","transactionState","setTransactionState","useState","successSent","useRef","errorSent","sendAnalytics","useAnalytics","address","useAccount","contractAddress","tokenId","quantity","isSponsored","useNFTContext","analyticsData","useMemo","useEffect","current","MintEvent","MintInitiated","MintSuccess","amountMinted","MintFailure","error","metadata","handleQuantityChange","newQuantity","MintQuantityChanged"],"mappings":";;;;;AAOO,MAAMA,mBAAmBA,MAAM;AACpC,QAAM,CAACC,kBAAkBC,mBAAmB,IAAIC,SAE9C,IAAI;AACAC,QAAAA,cAAcC,OAAO,KAAK;AAC1BC,QAAAA,YAAYD,OAAO,KAAK;AACxB,QAAA;AAAA,IAAEE;AAAAA,MAAkBC,aAAa;AACjC,QAAA;AAAA,IAAEC;AAAAA,MAAYC,WAAW;AAEzB,QAAA;AAAA,IAAEC;AAAAA,IAAiBC;AAAAA,IAASC;AAAAA,IAAUC;AAAAA,MAAgBC,cAAc;AAEpEC,QAAAA,gBAAgBC,QAAQ,MAAM;AAC9B,QAAA,CAACL,WAAW,CAACH,SAAS;AACjB,aAAA;AAAA,IAAA;AAGF,WAAA;AAAA,MACLA;AAAAA,MACAE;AAAAA,MACAC;AAAAA,MACAC;AAAAA,MACAC,aAAaA,eAAe;AAAA,IAC9B;AAAA,EAAA,GACC,CAACL,SAASE,iBAAiBC,SAASC,UAAUC,WAAW,CAAC;AAE7DI,YAAU,MAAM;AACd,QAAI,CAACF,eAAe;AAClB;AAAA,IAAA;AAGF,QAAIf,qBAAqB,uBAAuB;AAC9CG,kBAAYe,UAAU;AACtBb,gBAAUa,UAAU;AACNC,oBAAAA,UAAUC,eAAeL,aAAa;AAAA,IAAA;AAGtD,QAAIf,qBAAqB,aAAa,CAACG,YAAYe,SAAS;AAC1Df,kBAAYe,UAAU;AACtBZ,oBAAca,UAAUE,aAAa;AAAA,QACnC,GAAGN;AAAAA,QACHO,cAAcV;AAAAA,MAAAA,CACf;AAAA,IAAA;AAGH,QAAIZ,qBAAqB,WAAW,CAACK,UAAUa,SAAS;AACtDb,gBAAUa,UAAU;AACpBZ,oBAAca,UAAUI,aAAa;AAAA,QACnCC,OAAO;AAAA,QACPC,UAAUV;AAAAA,MAAAA,CACX;AAAA,IAAA;AAAA,KAEF,CAACf,kBAAkBY,UAAUG,eAAeT,aAAa,CAAC;AAEvDoB,QAAAA,uBAAuBA,CAACC,gBAAwB;AACpDrB,kBAAca,UAAUS,qBAAqB;AAAA,MAC3ChB,UAAUe;AAAAA,IAAAA,CACX;AAAA,EACH;AAEO,SAAA;AAAA,IACL1B;AAAAA,IACAyB;AAAAA,EACF;AACF;"}