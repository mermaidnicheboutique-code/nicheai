{"version":3,"file":"NFTMintButton.js","sources":["../../../../src/nft/components/mint/NFTMintButton.tsx"],"sourcesContent":["import { Spinner } from '@/internal/components/Spinner';\nimport { useNFTLifecycleContext } from '@/nft/components/NFTLifecycleProvider';\nimport { useNFTContext } from '@/nft/components/NFTProvider';\nimport { useMintAnalytics } from '@/nft/hooks/useMintAnalytics';\nimport { cn, text } from '@/styles/theme';\nimport {\n  Transaction,\n  TransactionButton,\n  type TransactionButtonProps,\n  type LifecycleStatus as TransactionLifecycleStatus,\n  TransactionSponsor,\n  TransactionStatus,\n  TransactionStatusAction,\n  TransactionStatusLabel,\n} from '@/transaction';\nimport type { Call } from '@/transaction/types';\nimport { ConnectWallet } from '@/wallet';\nimport { useCallback, useEffect, useMemo, useState } from 'react';\nimport { useAccount, useChainId } from 'wagmi';\n\ntype NFTMintButtonProps = {\n  className?: string;\n  label?: string;\n} & Pick<TransactionButtonProps, 'disabled'>;\n\nexport function NFTMintButton({\n  className,\n  label = 'Mint',\n  disabled,\n}: NFTMintButtonProps) {\n  const chainId = useChainId();\n  const { address } = useAccount();\n  const {\n    contractAddress,\n    tokenId,\n    network,\n    isEligibleToMint,\n    buildMintTransaction,\n    isSponsored,\n    quantity,\n    name,\n  } = useNFTContext();\n  const { updateLifecycleStatus } = useNFTLifecycleContext();\n  const [callData, setCallData] = useState<Call[]>([]);\n  const [mintError, setMintError] = useState<string | null>(null);\n  const { setTransactionState } = useMintAnalytics();\n\n  const handleTransactionError = useCallback(\n    (error: string) => {\n      updateLifecycleStatus({\n        statusName: 'error',\n        statusData: {\n          error: 'Error building mint transaction',\n          code: 'NmNBc01', // NFT module NFTMintButton component 01 error\n          message: error,\n        },\n      });\n      setMintError(error);\n    },\n    [updateLifecycleStatus],\n  );\n\n  const fetchTransactions = useCallback(async () => {\n    // don't fetch transactions until data is available\n    if (name && address && buildMintTransaction && isEligibleToMint) {\n      try {\n        setCallData([]);\n        setMintError(null);\n        setTransactionState('buildingTransaction');\n        const mintTransaction = await buildMintTransaction({\n          takerAddress: address,\n          contractAddress,\n          tokenId,\n          network,\n          quantity,\n        });\n        setCallData(mintTransaction);\n      } catch (error) {\n        handleTransactionError(error as string);\n      }\n    } else {\n      setCallData([]);\n    }\n  }, [\n    address,\n    buildMintTransaction,\n    contractAddress,\n    handleTransactionError,\n    isEligibleToMint,\n    name,\n    network,\n    quantity,\n    setTransactionState,\n    tokenId,\n  ]);\n\n  useEffect(() => {\n    // need to fetch calls on quantity change instead of onClick to avoid smart wallet\n    // popups getting blocked by safari\n    fetchTransactions();\n  }, [fetchTransactions]);\n\n  const handleOnStatus = useCallback(\n    (transactionStatus: TransactionLifecycleStatus) => {\n      setTransactionState(transactionStatus.statusName);\n\n      if (transactionStatus.statusName === 'transactionPending') {\n        updateLifecycleStatus({ statusName: 'transactionPending' });\n      }\n\n      if (\n        transactionStatus.statusName === 'transactionLegacyExecuted' ||\n        transactionStatus.statusName === 'success' ||\n        transactionStatus.statusName === 'error'\n      ) {\n        updateLifecycleStatus(transactionStatus);\n      }\n    },\n    [updateLifecycleStatus, setTransactionState],\n  );\n\n  const transactionButtonLabel = useMemo(() => {\n    if (isEligibleToMint === false || mintError) {\n      return 'Minting not available';\n    }\n\n    if (callData.length === 0) {\n      return <Spinner />;\n    }\n\n    return label;\n  }, [callData, isEligibleToMint, label, mintError]);\n\n  if (!buildMintTransaction) {\n    return null;\n  }\n\n  if (!address) {\n    return <ConnectWallet className={cn('w-full', className)} />;\n  }\n\n  return (\n    <>\n      <Transaction\n        isSponsored={isSponsored}\n        chainId={chainId}\n        calls={callData}\n        onStatus={handleOnStatus}\n      >\n        <TransactionButton\n          className={className}\n          text={transactionButtonLabel}\n          disabled={disabled || transactionButtonLabel !== label}\n        />\n        {!mintError && <TransactionSponsor />}\n        <TransactionStatus>\n          <TransactionStatusLabel />\n          <TransactionStatusAction />\n        </TransactionStatus>\n      </Transaction>\n      {mintError && (\n        <div className={cn(text.label2, 'text-ock-foreground-muted', 'pb-2')}>\n          {mintError}\n        </div>\n      )}\n    </>\n  );\n}\n"],"names":["NFTMintButton","className","label","disabled","chainId","useChainId","address","useAccount","contractAddress","tokenId","network","isEligibleToMint","buildMintTransaction","isSponsored","quantity","name","useNFTContext","updateLifecycleStatus","useNFTLifecycleContext","callData","setCallData","useState","mintError","setMintError","setTransactionState","useMintAnalytics","handleTransactionError","useCallback","error","statusName","statusData","code","message","fetchTransactions","mintTransaction","takerAddress","useEffect","handleOnStatus","transactionStatus","transactionButtonLabel","useMemo","length","cn","text","label2"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyBO,SAASA,cAAc;AAAA,EAC5BC;AAAAA,EACAC,QAAQ;AAAA,EACRC;AACkB,GAAG;AACrB,QAAMC,UAAUC,WAAW;AACrB,QAAA;AAAA,IAAEC;AAAAA,MAAYC,WAAW;AACzB,QAAA;AAAA,IACJC;AAAAA,IACAC;AAAAA,IACAC;AAAAA,IACAC;AAAAA,IACAC;AAAAA,IACAC;AAAAA,IACAC;AAAAA,IACAC;AAAAA,MACEC,cAAc;AACZ,QAAA;AAAA,IAAEC;AAAAA,MAA0BC,uBAAuB;AACzD,QAAM,CAACC,UAAUC,WAAW,IAAIC,SAAiB,CAAA,CAAE;AACnD,QAAM,CAACC,WAAWC,YAAY,IAAIF,SAAwB,IAAI;AACxD,QAAA;AAAA,IAAEG;AAAAA,MAAwBC,iBAAiB;AAE3CC,QAAAA,yBAAyBC,YAC7B,CAACC,UAAkB;AACK,0BAAA;AAAA,MACpBC,YAAY;AAAA,MACZC,YAAY;AAAA,QACVF,OAAO;AAAA,QACPG,MAAM;AAAA;AAAA,QACNC,SAASJ;AAAAA,MAAAA;AAAAA,IACX,CACD;AACDL,iBAAaK,KAAK;AAAA,EAAA,GAEpB,CAACX,qBAAqB,CACxB;AAEMgB,QAAAA,oBAAoBN,YAAY,YAAY;AAE5CZ,QAAAA,QAAQT,WAAWM,wBAAwBD,kBAAkB;AAC3D,UAAA;AACFS,oBAAY,CAAA,CAAE;AACdG,qBAAa,IAAI;AACjBC,4BAAoB,qBAAqB;AACnCU,cAAAA,kBAAkB,MAAMtB,qBAAqB;AAAA,UACjDuB,cAAc7B;AAAAA,UACdE;AAAAA,UACAC;AAAAA,UACAC;AAAAA,UACAI;AAAAA,QAAAA,CACD;AACDM,oBAAYc,eAAe;AAAA,eACpBN,OAAO;AACdF,+BAAuBE,KAAe;AAAA,MAAA;AAAA,IACxC,OACK;AACLR,kBAAY,CAAA,CAAE;AAAA,IAAA;AAAA,EAEf,GAAA,CACDd,SACAM,sBACAJ,iBACAkB,wBACAf,kBACAI,MACAL,SACAI,UACAU,qBACAf,OAAO,CACR;AAED2B,YAAU,MAAM;AAGI,sBAAA;AAAA,EAAA,GACjB,CAACH,iBAAiB,CAAC;AAEhBI,QAAAA,iBAAiBV,YACrB,CAACW,sBAAkD;AACjDd,wBAAoBc,kBAAkBT,UAAU;AAE5CS,QAAAA,kBAAkBT,eAAe,sBAAsB;AACnC,4BAAA;AAAA,QAAEA,YAAY;AAAA,MAAA,CAAsB;AAAA,IAAA;AAI1DS,QAAAA,kBAAkBT,eAAe,+BACjCS,kBAAkBT,eAAe,aACjCS,kBAAkBT,eAAe,SACjC;AACAZ,4BAAsBqB,iBAAiB;AAAA,IAAA;AAAA,EACzC,GAEF,CAACrB,uBAAuBO,mBAAmB,CAC7C;AAEMe,QAAAA,yBAAyBC,QAAQ,MAAM;AACvC7B,QAAAA,qBAAqB,SAASW,WAAW;AACpC,aAAA;AAAA,IAAA;AAGLH,QAAAA,SAASsB,WAAW,GAAG;AACzB,iCAAQ,SAAU,EAAA;AAAA,IAAA;AAGbvC,WAAAA;AAAAA,KACN,CAACiB,UAAUR,kBAAkBT,OAAOoB,SAAS,CAAC;AAEjD,MAAI,CAACV,sBAAsB;AAClB,WAAA;AAAA,EAAA;AAGT,MAAI,CAACN,SAAS;AACZ,+BAAQ,eAAc,EAAA,WAAWoC,GAAazC,cAAAA,SAAS,GAAK;AAAA,EAAA;AAG9D,SAEI,qBAAA,UAAA,EAAA,UAAA;AAAA,IAAA,qBAAC,eACC,aACA,SACA,OAAOkB,UACP,UAAUkB,gBAEV,UAAA;AAAA,MAAA,oBAAC,qBACC,WACA,MAAME,wBACN,UAAUpC,YAAYoC,2BAA2BrC,OAAM;AAAA,MAExD,CAACoB,aAAa,oBAAC,oBAAqB,EAAA;AAAA,2BACpC,mBACC,EAAA,UAAA;AAAA,QAAA,oBAAC,wBAAsB,EAAA;AAAA,4BACtB,yBAAuB,CAAA,CAAA;AAAA,MAAA,EAC1B,CAAA;AAAA,IAAA,GACF;AAAA,IACCA,aACE,oBAAA,OAAA,EAAI,WAAWoB,GAAGC,KAAKC,QAAM,iCAAA,UAAqC,GAChEtB,UACH,UAAA,CAAA;AAAA,EAAA,GAEJ;AAEJ;"}