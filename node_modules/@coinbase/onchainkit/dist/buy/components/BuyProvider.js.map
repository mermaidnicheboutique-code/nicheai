{"version":3,"file":"BuyProvider.js","sources":["../../../src/buy/components/BuyProvider.tsx"],"sourcesContent":["'use client';\nimport { RequestContext } from '@/core/network/constants';\nimport { useLifecycleStatus } from '@/internal/hooks/useLifecycleStatus';\nimport {\n  createContext,\n  useCallback,\n  useContext,\n  useEffect,\n  useState,\n} from 'react';\nimport { base } from 'viem/chains';\nimport { useAccount, useConfig, useSendTransaction } from 'wagmi';\nimport { useSwitchChain } from 'wagmi';\nimport { useSendCalls } from 'wagmi/experimental';\nimport { buildSwapTransaction } from '../../api/buildSwapTransaction';\nimport { useAnalytics } from '../../core/analytics/hooks/useAnalytics';\nimport { BuyEvent } from '../../core/analytics/types';\nimport { useCapabilitiesSafe } from '../../internal/hooks/useCapabilitiesSafe';\nimport { FALLBACK_DEFAULT_MAX_SLIPPAGE } from '../../swap/constants';\nimport { useAwaitCalls } from '../../swap/hooks/useAwaitCalls';\nimport type { LifecycleStatus, SwapUnit } from '../../swap/types';\nimport { isSwapError } from '../../swap/utils/isSwapError';\nimport { processSwapTransaction } from '../../swap/utils/processSwapTransaction';\nimport { GENERIC_ERROR_MESSAGE } from '../../transaction/constants';\nimport { isUserRejectedRequestError } from '../../transaction/utils/isUserRejectedRequestError';\nimport { useOnchainKit } from '../../useOnchainKit';\nimport { useBuyTokens } from '../hooks/useBuyTokens';\nimport { useOnrampEventListeners } from '../hooks/useOnrampEventListeners';\nimport { usePopupMonitor } from '../hooks/usePopupMonitor';\nimport { useResetBuyInputs } from '../hooks/useResetBuyInputs';\nimport type { BuyContextType, BuyProviderProps } from '../types';\nimport { getBuyQuote } from '../utils/getBuyQuote';\nimport { validateQuote } from '../utils/validateQuote';\n\nconst emptyContext = {} as BuyContextType;\n\nexport const BuyContext = createContext<BuyContextType>(emptyContext);\n\nexport function useBuyContext() {\n  const context = useContext(BuyContext);\n  if (context === emptyContext) {\n    throw new Error('useBuyContext must be used within a Buy component');\n  }\n  return context;\n}\n\nexport function BuyProvider({\n  children,\n  config = {\n    maxSlippage: FALLBACK_DEFAULT_MAX_SLIPPAGE,\n  },\n  disabled,\n  experimental,\n  isSponsored,\n  onError,\n  onStatus,\n  onSuccess,\n  toToken,\n  fromToken,\n  sessionToken,\n}: BuyProviderProps) {\n  const { config: { paymaster } = { paymaster: undefined }, projectId } =\n    useOnchainKit();\n  const { address, chainId } = useAccount();\n  const { switchChainAsync } = useSwitchChain();\n  // Feature flags\n  const { useAggregator } = experimental;\n  // Core Hooks\n  const accountConfig = useConfig();\n  const [isDropdownOpen, setIsDropdownOpen] = useState(false);\n\n  const walletCapabilities = useCapabilitiesSafe({\n    chainId: base.id,\n  }); // Swap is only available on Base\n  const [lifecycleStatus, updateLifecycleStatus] =\n    useLifecycleStatus<LifecycleStatus>({\n      statusName: 'init',\n      statusData: {\n        isMissingRequiredField: true,\n        maxSlippage: config.maxSlippage,\n      },\n    }); // Component lifecycle\n\n  const [transactionHash, setTransactionHash] = useState('');\n  const [hasHandledSuccess, setHasHandledSuccess] = useState(false);\n  const { from, fromETH, fromUSDC, to } = useBuyTokens(\n    toToken,\n    fromToken,\n    address,\n  );\n  const { sendTransactionAsync } = useSendTransaction(); // Sending the transaction (and approval, if applicable)\n  const { sendCallsAsync } = useSendCalls(); // Atomic Batch transactions (and approval, if applicable)\n\n  // Refreshes balances and inputs post-swap\n  const resetInputs = useResetBuyInputs({ fromETH, fromUSDC, from, to });\n  // For batched transactions, listens to and awaits calls from the Wallet server\n  const awaitCallsStatus = useAwaitCalls({\n    accountConfig,\n    lifecycleStatus,\n    updateLifecycleStatus,\n  });\n\n  const { onPopupClose } = useOnrampEventListeners({\n    updateLifecycleStatus,\n    maxSlippage: config.maxSlippage,\n    lifecycleStatus,\n  });\n\n  // used to detect when the popup is closed in order to stop loading state\n  const { startPopupMonitor } = usePopupMonitor(onPopupClose);\n\n  // Analytics\n  const { sendAnalytics } = useAnalytics();\n\n  // Component lifecycle emitters\n  useEffect(() => {\n    // Error\n    if (lifecycleStatus.statusName === 'error') {\n      onError?.(lifecycleStatus.statusData);\n    }\n    // Success\n    if (lifecycleStatus.statusName === 'success') {\n      onSuccess?.(lifecycleStatus?.statusData.transactionReceipt);\n      const txHash =\n        lifecycleStatus.statusData.transactionReceipt?.transactionHash;\n      setTransactionHash(txHash);\n      setHasHandledSuccess(true);\n\n      sendAnalytics(BuyEvent.BuySuccess, {\n        address,\n        amount: Number(from?.amount),\n        from: from?.token?.address,\n        paymaster: !!paymaster,\n        to: to?.token?.address,\n        transactionHash: txHash,\n      });\n    }\n    // Emit Status\n    onStatus?.(lifecycleStatus);\n  }, [\n    onError,\n    onStatus,\n    onSuccess,\n    lifecycleStatus,\n    lifecycleStatus.statusData, // Keep statusData, so that the effect runs when it changes\n    lifecycleStatus.statusName, // Keep statusName, so that the effect runs when it changes\n    from,\n    to,\n    address,\n    paymaster,\n    sendAnalytics,\n  ]);\n\n  useEffect(() => {\n    if (!projectId) {\n      console.error(\n        'Project ID is required for this component, please set the projectId in the OnchainKitProvider',\n      );\n    }\n  }, [projectId]);\n\n  useEffect(() => {\n    // Reset inputs after status reset. `resetInputs` is dependent\n    // on 'from' and 'to' so moved to separate useEffect to\n    // prevents multiple calls to `onStatus`\n    if (lifecycleStatus.statusName === 'init' && hasHandledSuccess) {\n      setHasHandledSuccess(false);\n      resetInputs();\n    }\n  }, [hasHandledSuccess, lifecycleStatus.statusName, resetInputs]);\n\n  useEffect(() => {\n    // For batched transactions, `transactionApproved` will contain the calls ID\n    // We'll use the `useAwaitCalls` hook to listen to the call status from the wallet server\n    // This will update the lifecycle status to `success` once the calls are confirmed\n    if (\n      lifecycleStatus.statusName === 'transactionApproved' &&\n      lifecycleStatus.statusData.transactionType === 'Batched'\n    ) {\n      awaitCallsStatus();\n    }\n  }, [\n    awaitCallsStatus,\n    lifecycleStatus,\n    lifecycleStatus.statusData,\n    lifecycleStatus.statusName,\n  ]);\n\n  useEffect(() => {\n    let timer: NodeJS.Timeout;\n    // Reset status to init after success has been handled\n    if (lifecycleStatus.statusName === 'success' && hasHandledSuccess) {\n      timer = setTimeout(() => {\n        updateLifecycleStatus({\n          statusName: 'init',\n          statusData: {\n            isMissingRequiredField: true,\n            maxSlippage: config.maxSlippage,\n          },\n        });\n      }, 3000);\n    }\n    return () => {\n      if (timer) {\n        return clearTimeout(timer);\n      }\n    };\n  }, [\n    config.maxSlippage,\n    hasHandledSuccess,\n    lifecycleStatus.statusName,\n    updateLifecycleStatus,\n  ]);\n\n  const handleAmountChange = useCallback(\n    async (amount: string) => {\n      if (\n        to.token === undefined ||\n        fromETH.token === undefined ||\n        fromUSDC.token === undefined\n      ) {\n        updateLifecycleStatus({\n          statusName: 'amountChange',\n          statusData: {\n            amountETH: fromETH.amount,\n            amountUSDC: fromUSDC.amount,\n            amountTo: to.amount,\n            tokenTo: to.token,\n            isMissingRequiredField: true,\n          },\n        });\n        return;\n      }\n\n      if (amount === '' || amount === '.' || Number.parseFloat(amount) === 0) {\n        to.setAmount('');\n        to.setAmountUSD('');\n        fromETH.setAmountUSD('');\n        fromUSDC.setAmountUSD('');\n        from?.setAmountUSD('');\n        return;\n      }\n\n      fromETH.setLoading(true);\n      fromUSDC.setLoading(true);\n      from?.setLoading(true);\n\n      updateLifecycleStatus({\n        statusName: 'amountChange',\n        statusData: {\n          // when fetching quote, the previous\n          // amount is irrelevant\n          amountTo: amount,\n          amountETH: '',\n          amountUSDC: '',\n          amountFrom: '',\n          tokenFromETH: fromETH.token,\n          tokenFromUSDC: fromUSDC.token,\n          tokenFrom: from?.token,\n          tokenTo: to.token,\n          // when fetching quote, the destination\n          // amount is missing\n          isMissingRequiredField: true,\n        },\n      });\n\n      try {\n        const maxSlippage = lifecycleStatus.statusData.maxSlippage;\n\n        const {\n          response: responseETH,\n          formattedFromAmount: formattedAmountETH,\n        } = await getBuyQuote({\n          amount,\n          from: fromETH.token,\n          maxSlippage: String(maxSlippage),\n          to: to.token,\n          useAggregator,\n          fromSwapUnit: fromETH,\n        });\n\n        const {\n          response: responseUSDC,\n          formattedFromAmount: formattedAmountUSDC,\n        } = await getBuyQuote({\n          amount,\n          from: fromUSDC.token,\n          maxSlippage: String(maxSlippage),\n          to: to.token,\n          useAggregator,\n          fromSwapUnit: fromUSDC,\n        });\n\n        const {\n          response: responseFrom,\n          formattedFromAmount: formattedAmountFrom,\n        } = await getBuyQuote({\n          amount,\n          from: from?.token,\n          maxSlippage: String(maxSlippage),\n          to: to.token,\n          useAggregator,\n          fromSwapUnit: from,\n        });\n\n        const { isValid } = validateQuote({\n          to,\n          responseETH,\n          responseUSDC,\n          responseFrom,\n          updateLifecycleStatus,\n        });\n\n        if (!isValid) {\n          return;\n        }\n\n        updateLifecycleStatus({\n          statusName: 'amountChange',\n          statusData: {\n            amountETH: formattedAmountETH,\n            amountUSDC: formattedAmountUSDC,\n            amountFrom: formattedAmountFrom || '',\n            amountTo: amount,\n            tokenFromETH: fromETH.token,\n            tokenFromUSDC: fromUSDC.token,\n            tokenFrom: from?.token,\n            tokenTo: to.token,\n            // if quote was fetched successfully, we\n            // have all required fields\n            isMissingRequiredField: !formattedAmountETH,\n          },\n        });\n      } catch (err) {\n        sendAnalytics(BuyEvent.BuyFailure, {\n          error: err instanceof Error ? err.message : String(err),\n          metadata: { amount },\n        });\n        updateLifecycleStatus({\n          statusName: 'error',\n          statusData: {\n            code: 'TmBPc02', // Transaction module BuyProvider component 01 error\n            error: JSON.stringify(err),\n            message: '',\n          },\n        });\n      } finally {\n        // reset loading state when quote request resolves\n        fromETH.setLoading(false);\n        fromUSDC.setLoading(false);\n        from?.setLoading(false);\n      }\n    },\n    [\n      to,\n      from,\n      fromETH,\n      fromUSDC,\n      useAggregator,\n      updateLifecycleStatus,\n      lifecycleStatus.statusData.maxSlippage,\n      sendAnalytics,\n    ],\n  );\n\n  const handleSubmit = useCallback(\n    async (from: SwapUnit) => {\n      if (!address || !from.token || !to.token || !from.amount) {\n        return;\n      }\n\n      try {\n        sendAnalytics(BuyEvent.BuyInitiated, {\n          amount: Number(from.amount),\n          token: from.token.symbol,\n        });\n\n        const maxSlippage = lifecycleStatus.statusData.maxSlippage;\n        const response = await buildSwapTransaction(\n          {\n            amount: from.amount,\n            fromAddress: address,\n            from: from.token,\n            maxSlippage: String(maxSlippage),\n            to: to.token,\n            useAggregator,\n          },\n          RequestContext.Buy,\n        );\n        if (isSwapError(response)) {\n          updateLifecycleStatus({\n            statusName: 'error',\n            statusData: {\n              code: response.code,\n              error: response.error,\n              message: response.message,\n            },\n          });\n          return;\n        }\n        await processSwapTransaction({\n          chainId,\n          config: accountConfig,\n          isSponsored,\n          paymaster: paymaster || '',\n          sendCallsAsync,\n          sendTransactionAsync,\n          swapTransaction: response,\n          switchChainAsync,\n          updateLifecycleStatus,\n          useAggregator,\n          walletCapabilities,\n        });\n      } catch (err) {\n        sendAnalytics(BuyEvent.BuyFailure, {\n          error: err instanceof Error ? err.message : String(err),\n          metadata: {\n            token: from.token.symbol,\n            amount: from.amount,\n          },\n        });\n        const errorMessage = isUserRejectedRequestError(err)\n          ? 'Request denied.'\n          : GENERIC_ERROR_MESSAGE;\n        updateLifecycleStatus({\n          statusName: 'error',\n          statusData: {\n            code: 'TmBPc03',\n            error: JSON.stringify(err),\n            message: errorMessage,\n          },\n        });\n      }\n    },\n    [\n      accountConfig,\n      address,\n      chainId,\n      isSponsored,\n      lifecycleStatus,\n      paymaster,\n      sendCallsAsync,\n      sendTransactionAsync,\n      switchChainAsync,\n      to.token,\n      updateLifecycleStatus,\n      useAggregator,\n      walletCapabilities,\n      sendAnalytics,\n    ],\n  );\n\n  return (\n    <BuyContext.Provider\n      value={{\n        address,\n        config,\n        disabled,\n        from,\n        fromETH,\n        fromUSDC,\n        handleAmountChange,\n        handleSubmit,\n        lifecycleStatus,\n        updateLifecycleStatus,\n        to,\n        setTransactionHash,\n        transactionHash,\n        isDropdownOpen,\n        setIsDropdownOpen,\n        toToken,\n        fromToken,\n        startPopupMonitor,\n        sessionToken,\n      }}\n    >\n      {children}\n    </BuyContext.Provider>\n  );\n}\n"],"names":["emptyContext","BuyContext","createContext","useBuyContext","context","useContext","Error","BuyProvider","children","config","maxSlippage","FALLBACK_DEFAULT_MAX_SLIPPAGE","disabled","experimental","isSponsored","onError","onStatus","onSuccess","toToken","fromToken","sessionToken","paymaster","undefined","projectId","useOnchainKit","address","chainId","useAccount","switchChainAsync","useSwitchChain","useAggregator","accountConfig","useConfig","isDropdownOpen","setIsDropdownOpen","useState","walletCapabilities","useCapabilitiesSafe","base","id","lifecycleStatus","updateLifecycleStatus","useLifecycleStatus","statusName","statusData","isMissingRequiredField","transactionHash","setTransactionHash","hasHandledSuccess","setHasHandledSuccess","from","fromETH","fromUSDC","to","useBuyTokens","sendTransactionAsync","useSendTransaction","sendCallsAsync","useSendCalls","resetInputs","useResetBuyInputs","awaitCallsStatus","useAwaitCalls","onPopupClose","useOnrampEventListeners","startPopupMonitor","usePopupMonitor","sendAnalytics","useAnalytics","useEffect","transactionReceipt","txHash","BuyEvent","BuySuccess","amount","Number","token","console","error","transactionType","timer","setTimeout","clearTimeout","handleAmountChange","useCallback","amountETH","amountUSDC","amountTo","tokenTo","parseFloat","setAmount","setAmountUSD","setLoading","amountFrom","tokenFromETH","tokenFromUSDC","tokenFrom","response","responseETH","formattedFromAmount","formattedAmountETH","getBuyQuote","String","fromSwapUnit","responseUSDC","formattedAmountUSDC","responseFrom","formattedAmountFrom","isValid","validateQuote","err","BuyFailure","message","metadata","code","JSON","stringify","handleSubmit","BuyInitiated","symbol","buildSwapTransaction","fromAddress","RequestContext","Buy","isSwapError","processSwapTransaction","swapTransaction","errorMessage","isUserRejectedRequestError","GENERIC_ERROR_MESSAGE"],"mappings":"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"}