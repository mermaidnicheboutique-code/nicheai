{"version":3,"file":"BuyDropdown.js","sources":["../../../src/buy/components/BuyDropdown.tsx"],"sourcesContent":["'use client';\nimport { useAnalytics } from '@/core/analytics/hooks/useAnalytics';\nimport { BuyEvent, type BuyOptionType } from '@/core/analytics/types';\nimport { type PaymentMethod } from '@/fund/types';\nimport { openPopup } from '@/internal/utils/openPopup';\nimport { useCallback, useEffect, useMemo } from 'react';\nimport { getFundingPopupSize } from '../../fund/utils/getFundingPopupSize';\nimport { getRoundedAmount } from '../../internal/utils/getRoundedAmount';\nimport { cn, text } from '../../styles/theme';\nimport { ONRAMP_PAYMENT_METHODS } from '../constants';\nimport { getBuyFundingUrl } from '../utils/getBuyFundingUrl';\nimport { isApplePaySupported } from '../utils/isApplePaySupported';\nimport { BuyOnrampItem } from './BuyOnrampItem';\nimport { useBuyContext } from './BuyProvider';\nimport { BuyTokenItem } from './BuyTokenItem';\n\n// eslint-disable-next-line complexity\nexport function BuyDropdown() {\n  const {\n    to,\n    fromETH,\n    fromUSDC,\n    from,\n    startPopupMonitor,\n    setIsDropdownOpen,\n    sessionToken,\n  } = useBuyContext();\n  const { sendAnalytics } = useAnalytics();\n\n  const handleOnrampClick = useCallback(\n    (paymentMethodId: string) => {\n      return () => {\n        sendAnalytics(BuyEvent.BuyOptionSelected, {\n          option: paymentMethodId as BuyOptionType,\n        });\n\n        const fundingUrl = getBuyFundingUrl({\n          to,\n          paymentMethodId,\n          sessionToken,\n        });\n\n        if (!fundingUrl) {\n          return;\n        }\n\n        const { height, width } = getFundingPopupSize('md', fundingUrl);\n        const popupWindow = openPopup({\n          url: fundingUrl,\n          height,\n          width,\n          target: '_blank',\n        });\n\n        if (popupWindow) {\n          // Detects when the popup is closed\n          // to stop loading state\n          startPopupMonitor(popupWindow);\n        }\n      };\n    },\n    [sendAnalytics, to, sessionToken, startPopupMonitor],\n  );\n\n  const formattedAmountUSD = useMemo(() => {\n    if (!to?.amountUSD || to?.amountUSD === '0') {\n      return null;\n    }\n    const roundedAmount = Number(getRoundedAmount(to?.amountUSD, 2));\n    return `$${roundedAmount.toFixed(2)}`;\n  }, [to?.amountUSD]);\n\n  const isToETH = to?.token?.symbol === 'ETH';\n  const isToUSDC = to?.token?.symbol === 'USDC';\n  const showFromToken =\n    to?.token?.symbol !== from?.token?.symbol &&\n    from &&\n    from?.token?.symbol !== 'ETH' &&\n    from?.token?.symbol !== 'USDC';\n\n  useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (event.key === 'Escape') {\n        setIsDropdownOpen(false);\n      }\n    };\n\n    document.addEventListener('keydown', handleKeyDown);\n    return () => {\n      document.removeEventListener('keydown', handleKeyDown);\n    };\n  }, [setIsDropdownOpen]);\n\n  const isApplePayEnabled = isApplePaySupported();\n\n  const availablePaymentMethods = useMemo(() => {\n    return ONRAMP_PAYMENT_METHODS.filter((method: PaymentMethod) => {\n      if (method.id === 'APPLE_PAY') {\n        return isApplePayEnabled;\n      }\n      return true;\n    });\n  }, [isApplePayEnabled]);\n\n  return (\n    <div\n      className={cn(\n        'text-ock-foreground',\n        'bg-ock-background',\n        'absolute right-0 bottom-0 flex translate-y-[102%] flex-col gap-2',\n        'z-10 min-w-80 rounded border p-2',\n        'rounded-ock-default',\n      )}\n      role=\"menu\"\n      aria-label=\"Buy options\"\n    >\n      <div\n        className={cn(text.headline, 'px-2 pt-2')}\n        role=\"heading\"\n        aria-level={2}\n      >\n        Buy with\n      </div>\n      {!isToETH && <BuyTokenItem swapUnit={fromETH} />}\n      {!isToUSDC && <BuyTokenItem swapUnit={fromUSDC} />}\n      {showFromToken && <BuyTokenItem swapUnit={from} />}\n\n      {availablePaymentMethods.map((method) => {\n        return (\n          <BuyOnrampItem\n            key={method.id}\n            name={method.name}\n            description={method.description}\n            onClick={handleOnrampClick(method.id)}\n            icon={method.icon}\n            to={to}\n          />\n        );\n      })}\n\n      {!!formattedAmountUSD && (\n        <div\n          className={cn(\n            'flex justify-end',\n            text.legal,\n            'text-ock-foreground-muted',\n          )}\n        >{`${to?.amount} ${to?.token?.name} â‰ˆ ${formattedAmountUSD}`}</div>\n      )}\n    </div>\n  );\n}\n"],"names":["BuyDropdown","to","fromETH","fromUSDC","from","startPopupMonitor","setIsDropdownOpen","sessionToken","useBuyContext","sendAnalytics","useAnalytics","handleOnrampClick","useCallback","paymentMethodId","BuyEvent","BuyOptionSelected","option","fundingUrl","getBuyFundingUrl","height","width","getFundingPopupSize","popupWindow","openPopup","url","target","formattedAmountUSD","useMemo","amountUSD","roundedAmount","Number","getRoundedAmount","toFixed","isToETH","token","symbol","isToUSDC","showFromToken","useEffect","handleKeyDown","event","key","addEventListener","removeEventListener","isApplePayEnabled","isApplePaySupported","availablePaymentMethods","ONRAMP_PAYMENT_METHODS","filter","method","id","cn","text","headline","map","name","description","icon","legal","amount"],"mappings":"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"}