{"version":3,"file":"useOnrampEventListeners.js","sources":["../../../src/buy/hooks/useOnrampEventListeners.ts"],"sourcesContent":["import type { EventMetadata } from '@/fund/types';\nimport type { LifecycleStatus } from '@/swap/types';\nimport { useCallback, useEffect } from 'react';\nimport type { TransactionReceipt } from 'viem';\nimport { setupOnrampEventListeners } from '../../fund/utils/setupOnrampEventListeners';\n\ntype UseOnrampLifecycleParams = {\n  updateLifecycleStatus: (status: LifecycleStatus) => void;\n  maxSlippage: number;\n  lifecycleStatus: LifecycleStatus;\n};\n\nexport const useOnrampEventListeners = ({\n  updateLifecycleStatus,\n  maxSlippage,\n  lifecycleStatus,\n}: UseOnrampLifecycleParams) => {\n  const handleOnrampEvent = useCallback(\n    (data: EventMetadata) => {\n      // Only update the lifecycle status if the current status is not 'transactionPending'\n      // Onramp emits a 'transition_view' event multiple times\n      if (\n        data.eventName === 'transition_view' &&\n        lifecycleStatus?.statusName !== 'transactionPending'\n      ) {\n        updateLifecycleStatus({\n          statusName: 'transactionPending',\n          statusData: {\n            isMissingRequiredField: false,\n            maxSlippage,\n          },\n        });\n      }\n    },\n    [maxSlippage, updateLifecycleStatus, lifecycleStatus?.statusName],\n  );\n\n  const handleOnrampSuccess = useCallback(() => {\n    updateLifecycleStatus({\n      statusName: 'success',\n      statusData: {\n        isMissingRequiredField: false,\n        transactionReceipt: {} as TransactionReceipt,\n        maxSlippage,\n      },\n    });\n  }, [maxSlippage, updateLifecycleStatus]);\n\n  const onPopupClose = useCallback(() => {\n    updateLifecycleStatus({\n      statusName: 'init',\n      statusData: {\n        isMissingRequiredField: false,\n        maxSlippage,\n      },\n    });\n  }, [updateLifecycleStatus, maxSlippage]);\n\n  useEffect(() => {\n    const unsubscribe = setupOnrampEventListeners({\n      onEvent: handleOnrampEvent,\n      onSuccess: handleOnrampSuccess,\n    });\n\n    return () => {\n      unsubscribe();\n    };\n  }, [handleOnrampEvent, handleOnrampSuccess]);\n\n  return { onPopupClose };\n};\n"],"names":["useOnrampEventListeners","updateLifecycleStatus","maxSlippage","lifecycleStatus","handleOnrampEvent","useCallback","data","eventName","statusName","statusData","isMissingRequiredField","handleOnrampSuccess","transactionReceipt","onPopupClose","useEffect","unsubscribe","setupOnrampEventListeners","onEvent","onSuccess"],"mappings":";;AAYO,MAAMA,0BAA0BA,CAAC;AAAA,EACtCC;AAAAA,EACAC;AAAAA,EACAC;AACwB,MAAM;AACxBC,QAAAA,oBAAoBC,YACxB,CAACC,SAAwB;AAGvB,QACEA,KAAKC,cAAc,sBACnBJ,mDAAiBK,gBAAe,sBAChC;AACsB,4BAAA;AAAA,QACpBA,YAAY;AAAA,QACZC,YAAY;AAAA,UACVC,wBAAwB;AAAA,UACxBR;AAAAA,QAAAA;AAAAA,MACF,CACD;AAAA,IAAA;AAAA,KAGL,CAACA,aAAaD,uBAAuBE,mDAAiBK,UAAU,CAClE;AAEMG,QAAAA,sBAAsBN,YAAY,MAAM;AACtB,0BAAA;AAAA,MACpBG,YAAY;AAAA,MACZC,YAAY;AAAA,QACVC,wBAAwB;AAAA,QACxBE,oBAAoB,CAAC;AAAA,QACrBV;AAAAA,MAAAA;AAAAA,IACF,CACD;AAAA,EAAA,GACA,CAACA,aAAaD,qBAAqB,CAAC;AAEjCY,QAAAA,eAAeR,YAAY,MAAM;AACf,0BAAA;AAAA,MACpBG,YAAY;AAAA,MACZC,YAAY;AAAA,QACVC,wBAAwB;AAAA,QACxBR;AAAAA,MAAAA;AAAAA,IACF,CACD;AAAA,EAAA,GACA,CAACD,uBAAuBC,WAAW,CAAC;AAEvCY,YAAU,MAAM;AACd,UAAMC,cAAcC,0BAA0B;AAAA,MAC5CC,SAASb;AAAAA,MACTc,WAAWP;AAAAA,IAAAA,CACZ;AAED,WAAO,MAAM;AACC,kBAAA;AAAA,IACd;AAAA,EAAA,GACC,CAACP,mBAAmBO,mBAAmB,CAAC;AAEpC,SAAA;AAAA,IAAEE;AAAAA,EAAa;AACxB;"}