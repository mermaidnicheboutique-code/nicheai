{"version":3,"file":"getAvatar.js","sources":["../../../src/identity/utils/getAvatar.ts"],"sourcesContent":["import { getChainPublicClient } from '@/core/network/getChainPublicClient';\nimport { isBase } from '@/core/utils/isBase';\nimport { isEthereum } from '@/core/utils/isEthereum';\nimport type {\n  Basename,\n  GetAvatarParams,\n  GetAvatarReturnType,\n} from '@/identity/types';\nimport { mainnet } from 'viem/chains';\nimport { normalize } from 'viem/ens';\nimport { RESOLVER_ADDRESSES_BY_CHAIN_ID } from '../constants';\nimport { getBaseDefaultProfilePicture } from './getBaseDefaultProfilePicture';\nimport { isBasename } from './isBasename';\n\n/**\n * An asynchronous function to fetch the Ethereum Name Service (ENS)\n * avatar for a given Ethereum name. It returns the ENS name if it exists,\n * or null if it doesn't or in case of an error.\n */\nexport const getAvatar = async ({\n  ensName,\n  chain = mainnet,\n}: GetAvatarParams): Promise<GetAvatarReturnType> => {\n  const chainIsBase = isBase({ chainId: chain.id });\n  const chainIsEthereum = isEthereum({ chainId: chain.id });\n  const chainSupportsUniversalResolver = chainIsEthereum || chainIsBase;\n  const usernameIsBasename = isBasename(ensName);\n\n  if (!chainSupportsUniversalResolver) {\n    return Promise.reject(\n      'ChainId not supported, avatar resolution is only supported on Ethereum and Base.',\n    );\n  }\n\n  let client = getChainPublicClient(chain);\n  let baseEnsAvatar = null;\n\n  // 1. Try basename\n  if (chainIsBase) {\n    try {\n      baseEnsAvatar = await client.getEnsAvatar({\n        name: normalize(ensName),\n        universalResolverAddress: RESOLVER_ADDRESSES_BY_CHAIN_ID[chain.id],\n      });\n\n      if (baseEnsAvatar) {\n        return baseEnsAvatar;\n      }\n    } catch {\n      // This is a best effort attempt, so we don't need to do anything here.\n    }\n  }\n\n  // 2. Defaults to mainnet\n  client = getChainPublicClient(mainnet);\n  const mainnetEnsAvatar = await client.getEnsAvatar({\n    name: normalize(ensName),\n  });\n\n  if (mainnetEnsAvatar) {\n    return mainnetEnsAvatar;\n  }\n\n  // 3. If username is a Basename (.base.eth / .basetest.eth), use default Basename avatars\n  if (usernameIsBasename) {\n    return getBaseDefaultProfilePicture(ensName as Basename);\n  }\n\n  // 4. No avatars to display\n  return null;\n};\n"],"names":["getAvatar","ensName","chain","mainnet","chainIsBase","isBase","chainId","id","chainIsEthereum","isEthereum","chainSupportsUniversalResolver","usernameIsBasename","isBasename","Promise","reject","client","getChainPublicClient","baseEnsAvatar","getEnsAvatar","name","normalize","universalResolverAddress","RESOLVER_ADDRESSES_BY_CHAIN_ID","mainnetEnsAvatar","getBaseDefaultProfilePicture"],"mappings":";;;;;;;;AAmBO,MAAMA,YAAY,OAAO;AAAA,EAC9BC;AAAAA,EACAC,QAAQC;AACO,MAAoC;AACnD,QAAMC,cAAcC,OAAO;AAAA,IAAEC,SAASJ,MAAMK;AAAAA,EAAAA,CAAI;AAChD,QAAMC,kBAAkBC,WAAW;AAAA,IAAEH,SAASJ,MAAMK;AAAAA,EAAAA,CAAI;AACxD,QAAMG,iCAAiCF,mBAAmBJ;AACpDO,QAAAA,qBAAqBC,WAAWX,OAAO;AAE7C,MAAI,CAACS,gCAAgC;AAC5BG,WAAAA,QAAQC,OACb,kFACF;AAAA,EAAA;AAGEC,MAAAA,SAASC,qBAAqBd,KAAK;AACvC,MAAIe,gBAAgB;AAGpB,MAAIb,aAAa;AACX,QAAA;AACc,sBAAA,MAAMW,OAAOG,aAAa;AAAA,QACxCC,MAAMC,UAAUnB,OAAO;AAAA,QACvBoB,0BAA0BC,+BAA+BpB,MAAMK,EAAE;AAAA,MAAA,CAClE;AAED,UAAIU,eAAe;AACVA,eAAAA;AAAAA,MAAAA;AAAAA,IACT,QACM;AAAA,IAAA;AAAA,EACN;AAKJF,WAASC,qBAAqBb,OAAO;AAC/BoB,QAAAA,mBAAmB,MAAMR,OAAOG,aAAa;AAAA,IACjDC,MAAMC,UAAUnB,OAAO;AAAA,EAAA,CACxB;AAED,MAAIsB,kBAAkB;AACbA,WAAAA;AAAAA,EAAAA;AAIT,MAAIZ,oBAAoB;AACtB,WAAOa,6BAA6BvB,OAAmB;AAAA,EAAA;AAIlD,SAAA;AACT;"}