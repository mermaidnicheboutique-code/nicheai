{"version":3,"file":"Badge.js","sources":["../../../src/identity/components/Badge.tsx"],"sourcesContent":["'use client';\nimport { useAttestations } from '@/identity/hooks/useAttestations';\nimport { COINBASE_VERIFIED_ACCOUNT_SCHEMA_ID } from '@/identity/constants';\nimport type { BadgeProps } from '@/identity/types';\nimport { badgeSvg } from '@/internal/svg/badgeSvg';\nimport { zIndex } from '@/styles/constants';\nimport { cn, pressable, text } from '@/styles/theme';\nimport { useMemo, useState } from 'react';\nimport { useOnchainKit } from '../../useOnchainKit';\nimport { useIdentityContext } from './IdentityProvider';\n\ntype ExtractAttestationNameParams = {\n  decodedDataJson?: string;\n  id?: string;\n  attester?: string;\n  expirationTime?: number;\n  recipient?: string;\n  revocationTime?: number;\n  revoked?: boolean;\n  schemaId?: string;\n  time?: number;\n};\n\n/**\n * Badge component.\n */\nexport function Badge({ className, tooltip = false }: BadgeProps) {\n  const [showTooltip, setShowTooltip] = useState(false);\n  const { address, schemaId: contextSchemaId } = useIdentityContext();\n  const { chain } = useOnchainKit();\n\n  const attestations = useAttestations({\n    address,\n    chain,\n    schemaId: tooltip\n      ? (contextSchemaId ?? COINBASE_VERIFIED_ACCOUNT_SCHEMA_ID)\n      : null,\n  });\n\n  // Get tooltip text from tooltip prop or attestation\n  const displayText = useMemo(() => {\n    if (!tooltip) {\n      return null;\n    }\n\n    return typeof tooltip === 'string'\n      ? tooltip\n      : extractAttestationName(attestations[0]);\n  }, [tooltip, attestations]);\n\n  const ariaLabel = useMemo(() => {\n    if (displayText) {\n      return `Verification badge: ${displayText}`;\n    }\n    return 'Verification badge';\n  }, [displayText]);\n\n  const badgeSize = '12px';\n\n  return (\n    <div className=\"relative inline-flex\" data-testid=\"ockBadgeContainer\">\n      <span\n        className={cn(\n          'bg-ock-primary',\n          'border-ock-background',\n          'rounded-ock-default',\n          tooltip && 'cursor-pointer',\n          className,\n        )}\n        style={{\n          height: badgeSize,\n          width: badgeSize,\n          maxHeight: badgeSize,\n          maxWidth: badgeSize,\n        }}\n        aria-label={ariaLabel}\n        data-testid=\"ockBadge\"\n        {...(tooltip && {\n          onMouseEnter: () => setShowTooltip(true),\n          onMouseLeave: () => setShowTooltip(false),\n        })}\n      >\n        {badgeSvg}\n      </span>\n      {showTooltip && tooltip && (\n        <div\n          className={cn(\n            'rounded-ock-default',\n            'border-ock-background',\n            pressable.alternate,\n            text.legal,\n            'text-ock-foreground',\n            zIndex.tooltip,\n            '-translate-x-1/2 absolute bottom-full left-1/2 mb-1 transform',\n            'whitespace-nowrap px-1.5 py-0.5',\n          )}\n          data-testid=\"ockBadgeTooltip\"\n        >\n          {displayText}\n          <div\n            className={cn(\n              '-translate-x-1/2 absolute top-full left-1/2 transform',\n            )}\n          />\n        </div>\n      )}\n    </div>\n  );\n}\n\n/**\n * Extracts the attestation name from an attestation object\n */\nfunction extractAttestationName(\n  attestation?: ExtractAttestationNameParams,\n): string {\n  if (!attestation?.decodedDataJson) {\n    return 'Verified';\n  }\n\n  try {\n    const decodedData = JSON.parse(attestation.decodedDataJson);\n\n    if (Array.isArray(decodedData) && decodedData[0]?.name) {\n      return decodedData[0].name;\n    }\n\n    const value = Object.values(decodedData)[0];\n\n    if (typeof value === 'string') {\n      return value;\n    }\n\n    if (\n      value &&\n      typeof value === 'object' &&\n      'value' in value &&\n      typeof value.value === 'string'\n    ) {\n      return value.value;\n    }\n  } catch {\n    // If parsing fails, return default\n  }\n\n  return 'Verified';\n}\n"],"names":["Badge","className","tooltip","showTooltip","setShowTooltip","useState","address","schemaId","contextSchemaId","useIdentityContext","chain","useOnchainKit","attestations","useAttestations","COINBASE_VERIFIED_ACCOUNT_SCHEMA_ID","displayText","useMemo","extractAttestationName","ariaLabel","badgeSize","cn","height","width","maxHeight","maxWidth","onMouseEnter","onMouseLeave","badgeSvg","pressable","alternate","text","legal","zIndex","attestation","decodedDataJson","decodedData","JSON","parse","Array","isArray","name","value","Object","values"],"mappings":";;;;;;;;;AA0BO,SAASA,MAAM;AAAA,EAAEC;AAAAA,EAAWC,UAAU;AAAkB,GAAG;AAChE,QAAM,CAACC,aAAaC,cAAc,IAAIC,SAAS,KAAK;AAC9C,QAAA;AAAA,IAAEC;AAAAA,IAASC,UAAUC;AAAAA,MAAoBC,mBAAmB;AAC5D,QAAA;AAAA,IAAEC;AAAAA,MAAUC,cAAc;AAEhC,QAAMC,eAAeC,gBAAgB;AAAA,IACnCP;AAAAA,IACAI;AAAAA,IACAH,UAAUL,UACLM,mBAAmBM,sCACpB;AAAA,EAAA,CACL;AAGKC,QAAAA,cAAcC,QAAQ,MAAM;AAChC,QAAI,CAACd,SAAS;AACL,aAAA;AAAA,IAAA;AAGT,WAAO,OAAOA,YAAY,WACtBA,UACAe,uBAAuBL,aAAa,CAAC,CAAC;AAAA,EAAA,GACzC,CAACV,SAASU,YAAY,CAAC;AAEpBM,QAAAA,YAAYF,QAAQ,MAAM;AAC9B,QAAID,aAAa;AACf,aAAO,uBAAuBA,WAAW;AAAA,IAAA;AAEpC,WAAA;AAAA,EAAA,GACN,CAACA,WAAW,CAAC;AAEhB,QAAMI,YAAY;AAElB,SACG,qBAAA,OAAA,EAAI,WAAU,gCAAuB,eAAY,qBAChD,UAAA;AAAA,IAAC,oBAAA,QAAA,EACC,WAAWC,GAAE,sBAAA,6BAAA,2BAIXlB,WAAO,sBACPD,SACF,GACA,OAAO;AAAA,MACLoB,QAAQF;AAAAA,MACRG,OAAOH;AAAAA,MACPI,WAAWJ;AAAAA,MACXK,UAAUL;AAAAA,OAEZ,cAAYD,WACZ,eAAY,YACZ,GAAKhB,WAAW;AAAA,MACduB,cAAcA,MAAMrB,eAAe,IAAI;AAAA,MACvCsB,cAAcA,MAAMtB,eAAe,KAAK;AAAA,IAAA,GAGzCuB,UACH,UAAA;AAAA,IACCxB,eAAeD,WACd,qBAAC,SACC,WAAWkB,2DAGTQ,UAAUC,WACVC,KAAKC,OAAK,2BAEVC,OAAO9B,SAAO,yFAAA,6CAGhB,GACA,eAAY,mBAEXa,UAAAA;AAAAA,MAAAA;AAAAA,MACA,oBAAA,OAAA,EACC,WAAWK,GAEX,2EAAA,EAAE,CAAA;AAAA,IAAA,EAEN,CAAA;AAAA,EAAA,GAEJ;AAEJ;AAKA,SAASH,uBACPgB,aACQ;;AACJ,MAAA,EAACA,2CAAaC,kBAAiB;AAC1B,WAAA;AAAA,EAAA;AAGL,MAAA;AACF,UAAMC,cAAcC,KAAKC,MAAMJ,YAAYC,eAAe;AAE1D,QAAII,MAAMC,QAAQJ,WAAW,OAAKA,iBAAY,CAAC,MAAbA,mBAAgBK,OAAM;AAC/CL,aAAAA,YAAY,CAAC,EAAEK;AAAAA,IAAAA;AAGxB,UAAMC,QAAQC,OAAOC,OAAOR,WAAW,EAAE,CAAC;AAEtC,QAAA,OAAOM,UAAU,UAAU;AACtBA,aAAAA;AAAAA,IAAAA;AAIPA,QAAAA,SACA,OAAOA,UAAU,YACjB,WAAWA,SACX,OAAOA,MAAMA,UAAU,UACvB;AACA,aAAOA,MAAMA;AAAAA,IAAAA;AAAAA,EACf,QACM;AAAA,EAAA;AAID,SAAA;AACT;"}