{"version":3,"file":"FundCardPaymentMethodDropdown.js","sources":["../../../src/fund/components/FundCardPaymentMethodDropdown.tsx"],"sourcesContent":["'use client';\nimport { isApplePaySupported } from '@/buy/utils/isApplePaySupported';\nimport { Skeleton } from '@/internal/components/Skeleton';\nimport { useOutsideClick } from '@/internal/hooks/useOutsideClick';\nimport { formatFiatAmount } from '@/internal/utils/formatFiatAmount';\nimport { useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport { useAnalytics } from '../../core/analytics/hooks/useAnalytics';\nimport { FundEvent } from '../../core/analytics/types';\nimport { border, cn } from '../../styles/theme';\nimport type {\n  FundCardPaymentMethodDropdownProps,\n  PaymentMethod,\n} from '../types';\nimport { FundCardPaymentMethodSelectRow } from './FundCardPaymentMethodSelectRow';\nimport { FundCardPaymentMethodSelectorToggle } from './FundCardPaymentMethodSelectorToggle';\nimport { useFundContext } from './FundCardProvider';\n\nexport function FundCardPaymentMethodDropdown({\n  className,\n}: FundCardPaymentMethodDropdownProps) {\n  const [isOpen, setIsOpen] = useState(false);\n\n  const {\n    selectedPaymentMethod,\n    setSelectedPaymentMethod,\n    paymentMethods,\n    fundAmountFiat,\n    isPaymentMethodsLoading,\n    currency,\n  } = useFundContext();\n\n  const { sendAnalytics } = useAnalytics();\n\n  const filteredPaymentMethods = useMemo(() => {\n    return paymentMethods.filter(\n      (method) => method.id !== 'APPLE_PAY' || isApplePaySupported(),\n    );\n  }, [paymentMethods]);\n\n  const getPaymentMethodDisabledReason = useCallback(\n    (method: PaymentMethod) => {\n      const amount = Number(fundAmountFiat);\n\n      if (method.minAmount && amount < method.minAmount) {\n        return `Minimum amount of ${formatFiatAmount({\n          amount: method.minAmount,\n          currency: currency,\n          minimumFractionDigits: 0,\n        })} required`;\n      }\n\n      if (method.maxAmount && amount > method.maxAmount) {\n        return `Maximum amount allowed is ${formatFiatAmount({\n          amount: method.maxAmount,\n          currency: currency,\n          minimumFractionDigits: 0,\n        })}`;\n      }\n\n      return undefined;\n    },\n    [fundAmountFiat, currency],\n  );\n\n  const isPaymentMethodDisabled = useCallback(\n    (method: PaymentMethod) => {\n      if (!fundAmountFiat) {\n        return false;\n      }\n\n      return Boolean(getPaymentMethodDisabledReason(method));\n    },\n    [fundAmountFiat, getPaymentMethodDisabledReason],\n  );\n\n  // If current selected method becomes disabled, switch to Coinbase\n  useEffect(() => {\n    if (\n      selectedPaymentMethod &&\n      isPaymentMethodDisabled(selectedPaymentMethod)\n    ) {\n      const coinbaseMethod = paymentMethods.find((m) => m.id === '');\n      if (coinbaseMethod) {\n        setSelectedPaymentMethod(coinbaseMethod);\n      }\n    }\n  }, [\n    selectedPaymentMethod,\n    paymentMethods,\n    setSelectedPaymentMethod,\n    isPaymentMethodDisabled,\n  ]);\n\n  const handlePaymentMethodSelect = useCallback(\n    (paymentMethod: PaymentMethod) => {\n      if (!isPaymentMethodDisabled(paymentMethod)) {\n        sendAnalytics(FundEvent.FundOptionSelected, {\n          option: paymentMethod.id,\n        });\n        setSelectedPaymentMethod(paymentMethod);\n        setIsOpen(false);\n      }\n    },\n    [setSelectedPaymentMethod, isPaymentMethodDisabled, sendAnalytics],\n  );\n\n  const handleToggle = useCallback(() => {\n    setIsOpen(!isOpen);\n  }, [isOpen]);\n\n  const dropdownRef = useRef<HTMLDivElement | null>(null);\n  const dropdownContainerRef = useRef<HTMLDivElement | null>(null);\n  const buttonRef = useRef<HTMLButtonElement | null>(null);\n\n  useOutsideClick(dropdownContainerRef, () => {\n    if (isOpen) {\n      setIsOpen(false);\n    }\n  });\n\n  const handleEscKeyPress = useCallback(\n    (event: React.KeyboardEvent<HTMLDivElement>) => {\n      if (event.key === 'Escape') {\n        setIsOpen(false);\n      }\n    },\n    [],\n  );\n\n  const paymentMethod = selectedPaymentMethod || filteredPaymentMethods[0];\n\n  return (\n    <div\n      className={cn('relative py-4', className)}\n      ref={dropdownContainerRef}\n      data-testid=\"ockFundCardPaymentMethodDropdownContainer\"\n      onKeyUp={handleEscKeyPress}\n    >\n      {isPaymentMethodsLoading || !paymentMethod ? (\n        <Skeleton className=\"h-12 w-full\" />\n      ) : (\n        <FundCardPaymentMethodSelectorToggle\n          ref={buttonRef}\n          onClick={handleToggle}\n          isOpen={isOpen}\n          paymentMethod={paymentMethod}\n        />\n      )}\n      {isOpen && (\n        <div\n          ref={dropdownRef}\n          data-testid=\"ockFundCardPaymentMethodDropdown\"\n          className={cn(\n            border.lineDefault,\n            'rounded-ock-default ock-scrollbar absolute z-10 mt-2 flex w-full flex-col overflow-y-hidden',\n          )}\n        >\n          <div className={cn('bg-ock-background', 'overflow-y-auto p-2')}>\n            {filteredPaymentMethods.map((paymentMethod) => {\n              const isDisabled = isPaymentMethodDisabled(paymentMethod);\n              return (\n                <FundCardPaymentMethodSelectRow\n                  key={paymentMethod.name}\n                  testId={`ockFundCardPaymentMethodSelectRow__${paymentMethod.id}`}\n                  paymentMethod={paymentMethod}\n                  onClick={handlePaymentMethodSelect}\n                  disabled={isDisabled}\n                  disabledReason={getPaymentMethodDisabledReason(paymentMethod)}\n                />\n              );\n            })}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":["FundCardPaymentMethodDropdown","className","isOpen","setIsOpen","useState","selectedPaymentMethod","setSelectedPaymentMethod","paymentMethods","fundAmountFiat","isPaymentMethodsLoading","currency","useFundContext","sendAnalytics","useAnalytics","filteredPaymentMethods","useMemo","filter","method","id","isApplePaySupported","getPaymentMethodDisabledReason","useCallback","amount","Number","minAmount","formatFiatAmount","minimumFractionDigits","maxAmount","undefined","isPaymentMethodDisabled","Boolean","useEffect","coinbaseMethod","find","m","handlePaymentMethodSelect","paymentMethod","FundEvent","FundOptionSelected","option","handleToggle","dropdownRef","useRef","dropdownContainerRef","buttonRef","useOutsideClick","handleEscKeyPress","event","key","cn","border","lineDefault","map","isDisabled","name"],"mappings":"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"}