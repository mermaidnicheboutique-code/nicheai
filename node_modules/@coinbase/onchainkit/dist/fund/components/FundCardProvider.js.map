{"version":3,"file":"FundCardProvider.js","sources":["../../../src/fund/components/FundCardProvider.tsx"],"sourcesContent":["'use client';\nimport type { LifecycleStatusUpdate } from '@/internal/types';\nimport {\n  createContext,\n  useCallback,\n  useContext,\n  useEffect,\n  useState,\n} from 'react';\nimport { useAnalytics } from '../../core/analytics/hooks/useAnalytics';\nimport { FundEvent } from '../../core/analytics/types';\nimport { useEmitLifecycleStatus } from '../hooks/useEmitLifecycleStatus';\nimport { useOnrampExchangeRate } from '../hooks/useOnrampExchangeRate';\nimport { usePaymentMethods } from '../hooks/usePaymentMethods';\nimport type {\n  AmountInputType,\n  FundButtonState,\n  FundCardProviderProps,\n  LifecycleStatus,\n  OnrampError,\n  PaymentMethod,\n  PresetAmountInputs,\n} from '../types';\n\ntype FundCardContextType = {\n  asset: string;\n  currency: string;\n  selectedPaymentMethod?: PaymentMethod;\n  setSelectedPaymentMethod: (paymentMethod: PaymentMethod) => void;\n  selectedInputType: AmountInputType;\n  setSelectedInputType: (inputType: AmountInputType) => void;\n  fundAmountFiat: string;\n  setFundAmountFiat: (amount: string) => void;\n  fundAmountCrypto: string;\n  setFundAmountCrypto: (amount: string) => void;\n  exchangeRate: number;\n  setExchangeRate: (exchangeRate: number) => void;\n  exchangeRateLoading: boolean;\n  setExchangeRateLoading: (loading: boolean) => void;\n  submitButtonState: FundButtonState;\n  setSubmitButtonState: (state: FundButtonState) => void;\n  paymentMethods: PaymentMethod[];\n  setPaymentMethods: (paymentMethods: PaymentMethod[]) => void;\n  isPaymentMethodsLoading: boolean;\n  setIsPaymentMethodsLoading: (loading: boolean) => void;\n  headerText?: string;\n  buttonText?: string;\n  country: string;\n  subdivision?: string;\n  inputType?: 'fiat' | 'crypto';\n  sessionToken?: string;\n  lifecycleStatus: LifecycleStatus;\n\n  presetAmountInputs?: PresetAmountInputs;\n  updateLifecycleStatus: (\n    newStatus: LifecycleStatusUpdate<LifecycleStatus>,\n  ) => void;\n  onError?: (error: OnrampError) => void;\n};\n\nconst FundContext = createContext<FundCardContextType | undefined>(undefined);\n\nexport function FundCardProvider({\n  children,\n  asset,\n  currency = 'USD',\n  headerText = `Buy ${asset.toUpperCase()}`,\n  buttonText,\n  country,\n  subdivision,\n  inputType,\n  onError,\n  onStatus,\n  onSuccess,\n  presetAmountInputs,\n  sessionToken,\n}: FundCardProviderProps) {\n  const [selectedPaymentMethod, setSelectedPaymentMethod] = useState<\n    PaymentMethod | undefined\n  >();\n  const [selectedInputType, setSelectedInputType] = useState<AmountInputType>(\n    inputType || 'fiat',\n  );\n  const [fundAmountFiat, setFundAmountFiat] = useState<string>('');\n  const [fundAmountCrypto, setFundAmountCrypto] = useState<string>('');\n  const [exchangeRate, setExchangeRate] = useState<number>(0);\n  const [exchangeRateLoading, setExchangeRateLoading] = useState<boolean>(true);\n\n  const [submitButtonState, setSubmitButtonState] =\n    useState<FundButtonState>('default');\n\n  const [paymentMethods, setPaymentMethods] = useState<PaymentMethod[]>([]);\n  const [isPaymentMethodsLoading, setIsPaymentMethodsLoading] =\n    useState<boolean>(true);\n  const { lifecycleStatus, updateLifecycleStatus } = useEmitLifecycleStatus({\n    onError,\n    onSuccess,\n    onStatus,\n  });\n\n  const { fetchExchangeRate } = useOnrampExchangeRate({\n    asset,\n    currency,\n    country,\n    subdivision,\n    setExchangeRate,\n    onError,\n  });\n\n  const { sendAnalytics } = useAnalytics();\n\n  const handleAnalyticsAmountChanged = useCallback(\n    (amount: number, currency: string) => {\n      sendAnalytics(FundEvent.FundAmountChanged, {\n        amount,\n        currency,\n      });\n    },\n    [sendAnalytics],\n  );\n\n  const handleAnalyticsOptionSelected = useCallback(\n    (option: string) => {\n      sendAnalytics(FundEvent.FundOptionSelected, {\n        option,\n      });\n    },\n    [sendAnalytics],\n  );\n\n  const handleSetFundAmountFiat = useCallback(\n    (amount: string) => {\n      const newAmount = Number.parseFloat(amount);\n\n      if (!Number.isNaN(newAmount)) {\n        handleAnalyticsAmountChanged(newAmount, currency);\n      }\n\n      setFundAmountFiat(amount);\n    },\n    [currency, handleAnalyticsAmountChanged],\n  );\n\n  const handleSetSelectedPaymentMethod = useCallback(\n    (paymentMethod: PaymentMethod) => {\n      handleAnalyticsOptionSelected(paymentMethod.id);\n      setSelectedPaymentMethod(paymentMethod);\n    },\n    [handleAnalyticsOptionSelected],\n  );\n\n  const handleFetchExchangeRate = useCallback(async () => {\n    setExchangeRateLoading(true);\n    await fetchExchangeRate();\n    setExchangeRateLoading(false);\n  }, [fetchExchangeRate]);\n\n  useEffect(() => {\n    handleFetchExchangeRate();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  // Fetches and sets the payment methods to the context\n  usePaymentMethods({\n    country,\n    subdivision,\n    currency,\n    setPaymentMethods,\n    setIsPaymentMethodsLoading,\n    onError,\n  });\n\n  return (\n    <FundContext.Provider\n      value={{\n        asset,\n        currency,\n        selectedPaymentMethod,\n        setSelectedPaymentMethod: handleSetSelectedPaymentMethod,\n        fundAmountFiat,\n        setFundAmountFiat: handleSetFundAmountFiat,\n        fundAmountCrypto,\n        setFundAmountCrypto,\n        selectedInputType,\n        setSelectedInputType,\n        exchangeRate,\n        setExchangeRate,\n        exchangeRateLoading,\n        setExchangeRateLoading,\n        submitButtonState,\n        setSubmitButtonState,\n        paymentMethods,\n        setPaymentMethods,\n        isPaymentMethodsLoading,\n        setIsPaymentMethodsLoading,\n        headerText,\n        buttonText,\n        country,\n        subdivision,\n        lifecycleStatus,\n        updateLifecycleStatus,\n        presetAmountInputs,\n        sessionToken,\n        onError,\n      }}\n    >\n      {children}\n    </FundContext.Provider>\n  );\n}\n\nexport function useFundContext() {\n  const context = useContext(FundContext);\n\n  if (!context) {\n    throw new Error('useFundContext must be used within a FundCardProvider');\n  }\n\n  return context;\n}\n"],"names":["FundContext","createContext","undefined","FundCardProvider","children","asset","currency","headerText","toUpperCase","buttonText","country","subdivision","inputType","onError","onStatus","onSuccess","presetAmountInputs","sessionToken","selectedPaymentMethod","setSelectedPaymentMethod","useState","selectedInputType","setSelectedInputType","fundAmountFiat","setFundAmountFiat","fundAmountCrypto","setFundAmountCrypto","exchangeRate","setExchangeRate","exchangeRateLoading","setExchangeRateLoading","submitButtonState","setSubmitButtonState","paymentMethods","setPaymentMethods","isPaymentMethodsLoading","setIsPaymentMethodsLoading","lifecycleStatus","updateLifecycleStatus","useEmitLifecycleStatus","fetchExchangeRate","useOnrampExchangeRate","sendAnalytics","useAnalytics","handleAnalyticsAmountChanged","useCallback","amount","FundEvent","FundAmountChanged","handleAnalyticsOptionSelected","option","FundOptionSelected","handleSetFundAmountFiat","newAmount","Number","parseFloat","isNaN","handleSetSelectedPaymentMethod","paymentMethod","id","handleFetchExchangeRate","useEffect","useFundContext","context","useContext","Error"],"mappings":"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"}