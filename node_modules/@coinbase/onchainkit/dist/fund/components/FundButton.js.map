{"version":3,"file":"FundButton.js","sources":["../../../src/fund/components/FundButton.tsx"],"sourcesContent":["'use client';\n\nimport { useCallback, useMemo } from 'react';\n\nimport { cn, pressable, text, prefixClassName } from '../../styles/theme';\nimport { useAccount } from 'wagmi';\nimport { useAnalytics } from '../../core/analytics/hooks/useAnalytics';\nimport { FundEvent } from '../../core/analytics/types';\nimport { usePopupMonitor } from '@/buy/hooks/usePopupMonitor';\nimport { ErrorSvg } from '@/internal/svg/errorSvg';\nimport { openPopup } from '@/internal/utils/openPopup';\nimport { Spinner } from '../../internal/components/Spinner';\nimport { AddSvg } from '../../internal/svg/addSvg';\nimport { SuccessSvg } from '../../internal/svg/successSvg';\nimport { ConnectWallet } from '../../wallet/components/ConnectWallet';\nimport { useGetFundingUrl } from '../hooks/useGetFundingUrl';\nimport type { FundButtonProps } from '../types';\nimport { getFundingPopupSize } from '../utils/getFundingPopupSize';\n\nexport function FundButton({\n  className,\n  children,\n  disabled = false,\n  fundingUrl,\n  openIn = 'popup',\n  popupSize = 'md',\n  target,\n  state: buttonState = 'default',\n  fiatCurrency = 'USD',\n  onPopupClose,\n  onClick,\n  render,\n  sessionToken,\n}: FundButtonProps) {\n  // If the fundingUrl prop is undefined, fallback to our recommended funding URL based on the wallet type\n  const fallbackFundingUrl = useGetFundingUrl({\n    fiatCurrency,\n    originComponentName: 'FundButton',\n    sessionToken,\n  });\n  const { address } = useAccount();\n  const fundingUrlToRender = fundingUrl ?? fallbackFundingUrl;\n  const isDisabled = disabled || !fundingUrlToRender;\n\n  const { startPopupMonitor } = usePopupMonitor(onPopupClose);\n  const { sendAnalytics } = useAnalytics();\n\n  const handleAnalyticsInitiated = useCallback(() => {\n    sendAnalytics(FundEvent.FundInitiated, {\n      currency: fiatCurrency,\n    });\n  }, [sendAnalytics, fiatCurrency]);\n\n  const handleAnalyticsFailure = useCallback(\n    (error: string) => {\n      sendAnalytics(FundEvent.FundFailure, {\n        error,\n        metadata: { currency: fiatCurrency },\n      });\n    },\n    [sendAnalytics, fiatCurrency],\n  );\n\n  const handleClick = useCallback(\n    (e: React.MouseEvent) => {\n      e.preventDefault();\n\n      if (fundingUrlToRender && openIn === 'tab') {\n        handleAnalyticsInitiated();\n        onClick?.();\n        window.open(fundingUrlToRender, '_blank');\n        return;\n      }\n\n      if (fundingUrlToRender) {\n        handleAnalyticsInitiated();\n        onClick?.();\n        const { height, width } = getFundingPopupSize(\n          popupSize,\n          fundingUrlToRender,\n        );\n        const popupWindow = openPopup({\n          url: fundingUrlToRender,\n          height,\n          width,\n          target,\n        });\n\n        if (popupWindow) {\n          startPopupMonitor(popupWindow);\n        } else {\n          handleAnalyticsFailure('Failed to open funding popup');\n        }\n      }\n    },\n    [\n      fundingUrlToRender,\n      openIn,\n      handleAnalyticsInitiated,\n      onClick,\n      popupSize,\n      target,\n      startPopupMonitor,\n      handleAnalyticsFailure,\n    ],\n  );\n\n  const buttonColorClass = useMemo(() => {\n    if (buttonState === 'error') {\n      return prefixClassName('bg-ock-error');\n    }\n    return pressable.primary;\n  }, [buttonState]);\n\n  const classNames = cn(\n    buttonColorClass,\n    'rounded-ock-default px-4 py-3 inline-flex items-center justify-center space-x-2',\n    {\n      [pressable.disabled]: isDisabled,\n    },\n    text.headline,\n    'text-ock-foreground-inverse',\n    className,\n  );\n\n  const buttonIcon = useMemo(() => {\n    switch (buttonState) {\n      case 'loading':\n        return '';\n      case 'success':\n        return <SuccessSvg className=\"fill-[#F9FAFB]\" />;\n      case 'error':\n        return <ErrorSvg className=\"fill-[#F9FAFB]\" />;\n      default:\n        return <AddSvg />;\n    }\n  }, [buttonState]);\n\n  const buttonTextContent = useMemo(() => {\n    switch (buttonState) {\n      case 'loading':\n        return '';\n      case 'success':\n        return 'Success';\n      case 'error':\n        return 'Something went wrong';\n      default:\n        return 'Fund';\n    }\n  }, [buttonState]);\n\n  const buttonContent = useMemo(() => {\n    if (buttonState === 'loading') {\n      return <Spinner />;\n    }\n\n    return (\n      <>\n        {buttonIcon && (\n          <span\n            data-testid=\"ockFundButtonIcon\"\n            className=\"flex h-6 items-center\"\n          >\n            {buttonIcon}\n          </span>\n        )}\n        <span data-testid=\"ockFundButtonTextContent\">{buttonTextContent}</span>\n      </>\n    );\n  }, [buttonState, buttonIcon, buttonTextContent]);\n\n  if (!address) {\n    return <ConnectWallet className={cn('w-full', className)} />;\n  }\n\n  if (render) {\n    return render({\n      status: buttonState,\n      onClick: handleClick,\n      isDisabled,\n    });\n  }\n\n  return (\n    <button\n      className={classNames}\n      onClick={handleClick}\n      type=\"button\"\n      disabled={isDisabled}\n      data-testid=\"ockFundButton\"\n    >\n      {children ?? buttonContent}\n    </button>\n  );\n}\n"],"names":["FundButton","className","children","disabled","fundingUrl","openIn","popupSize","target","state","buttonState","fiatCurrency","onPopupClose","onClick","render","sessionToken","fallbackFundingUrl","useGetFundingUrl","originComponentName","address","useAccount","fundingUrlToRender","isDisabled","startPopupMonitor","usePopupMonitor","sendAnalytics","useAnalytics","handleAnalyticsInitiated","useCallback","FundEvent","FundInitiated","currency","handleAnalyticsFailure","error","FundFailure","metadata","handleClick","e","preventDefault","open","height","width","getFundingPopupSize","popupWindow","openPopup","url","buttonColorClass","useMemo","prefixClassName","pressable","primary","classNames","cn","text","headline","buttonIcon","buttonTextContent","buttonContent","status"],"mappings":"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"}