{"version":3,"file":"useFundCardSetupOnrampEventListeners.js","sources":["../../../src/fund/hooks/useFundCardSetupOnrampEventListeners.ts"],"sourcesContent":["import { useCallback, useEffect, useRef } from 'react';\nimport { useFundContext } from '../components/FundCardProvider';\nimport { FUND_BUTTON_RESET_TIMEOUT } from '../constants';\nimport type { EventMetadata, SuccessEventData } from '../types';\nimport { setupOnrampEventListeners } from '../utils/setupOnrampEventListeners';\n\nexport const useFundCardSetupOnrampEventListeners = () => {\n  const { setSubmitButtonState, updateLifecycleStatus } = useFundContext();\n  const timeoutRef = useRef<NodeJS.Timeout | null>(null);\n\n  const scheduleFundButtonReset = useCallback(() => {\n    if (timeoutRef.current) {\n      clearTimeout(timeoutRef.current);\n    }\n\n    timeoutRef.current = setTimeout(() => {\n      setSubmitButtonState('default');\n    }, FUND_BUTTON_RESET_TIMEOUT);\n  }, [setSubmitButtonState]);\n\n  const handleOnrampEvent = useCallback(\n    (data: EventMetadata) => {\n      if (data.eventName === 'transition_view') {\n        updateLifecycleStatus({\n          statusName: 'transactionPending',\n          statusData: undefined,\n        });\n      } else if (data.eventName === 'error') {\n        updateLifecycleStatus({\n          statusName: 'error',\n          statusData: data.error,\n        });\n\n        setSubmitButtonState('error');\n        scheduleFundButtonReset();\n      }\n    },\n    [updateLifecycleStatus, setSubmitButtonState, scheduleFundButtonReset],\n  );\n\n  const handleOnrampSuccess = useCallback(\n    (data?: SuccessEventData) => {\n      updateLifecycleStatus({\n        statusName: 'transactionSuccess',\n        statusData: data,\n      });\n\n      setSubmitButtonState('success');\n      scheduleFundButtonReset();\n    },\n    [updateLifecycleStatus, setSubmitButtonState, scheduleFundButtonReset],\n  );\n\n  const handleOnrampExit = useCallback(() => {\n    setSubmitButtonState('default');\n\n    updateLifecycleStatus({\n      statusName: 'exit',\n      statusData: undefined,\n    });\n  }, [updateLifecycleStatus, setSubmitButtonState]);\n\n  useEffect(() => {\n    const unsubscribe = setupOnrampEventListeners({\n      onEvent: handleOnrampEvent,\n      onExit: handleOnrampExit,\n      onSuccess: handleOnrampSuccess,\n    });\n\n    return () => {\n      unsubscribe();\n\n      if (timeoutRef.current) {\n        clearTimeout(timeoutRef.current);\n      }\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n};\n"],"names":["useFundCardSetupOnrampEventListeners","setSubmitButtonState","updateLifecycleStatus","useFundContext","timeoutRef","useRef","scheduleFundButtonReset","useCallback","current","clearTimeout","setTimeout","FUND_BUTTON_RESET_TIMEOUT","handleOnrampEvent","data","eventName","statusName","statusData","undefined","error","handleOnrampSuccess","handleOnrampExit","useEffect","unsubscribe","setupOnrampEventListeners","onEvent","onExit","onSuccess"],"mappings":";;;;AAMO,MAAMA,uCAAuCA,MAAM;AAClD,QAAA;AAAA,IAAEC;AAAAA,IAAsBC;AAAAA,MAA0BC,eAAe;AACjEC,QAAAA,aAAaC,OAA8B,IAAI;AAE/CC,QAAAA,0BAA0BC,YAAY,MAAM;AAChD,QAAIH,WAAWI,SAAS;AACtBC,mBAAaL,WAAWI,OAAO;AAAA,IAAA;AAGtBA,eAAAA,UAAUE,WAAW,MAAM;AACpCT,2BAAqB,SAAS;AAAA,OAC7BU,yBAAyB;AAAA,EAAA,GAC3B,CAACV,oBAAoB,CAAC;AAEnBW,QAAAA,oBAAoBL,YACxB,CAACM,SAAwB;AACnBA,QAAAA,KAAKC,cAAc,mBAAmB;AAClB,4BAAA;AAAA,QACpBC,YAAY;AAAA,QACZC,YAAYC;AAAAA,MAAAA,CACb;AAAA,IAAA,WACQJ,KAAKC,cAAc,SAAS;AACf,4BAAA;AAAA,QACpBC,YAAY;AAAA,QACZC,YAAYH,KAAKK;AAAAA,MAAAA,CAClB;AAEDjB,2BAAqB,OAAO;AACJ,8BAAA;AAAA,IAAA;AAAA,EAG5B,GAAA,CAACC,uBAAuBD,sBAAsBK,uBAAuB,CACvE;AAEMa,QAAAA,sBAAsBZ,YAC1B,CAACM,SAA4B;AACL,0BAAA;AAAA,MACpBE,YAAY;AAAA,MACZC,YAAYH;AAAAA,IAAAA,CACb;AAEDZ,yBAAqB,SAAS;AACN,4BAAA;AAAA,EAE1B,GAAA,CAACC,uBAAuBD,sBAAsBK,uBAAuB,CACvE;AAEMc,QAAAA,mBAAmBb,YAAY,MAAM;AACzCN,yBAAqB,SAAS;AAER,0BAAA;AAAA,MACpBc,YAAY;AAAA,MACZC,YAAYC;AAAAA,IAAAA,CACb;AAAA,EAAA,GACA,CAACf,uBAAuBD,oBAAoB,CAAC;AAEhDoB,YAAU,MAAM;AACd,UAAMC,cAAcC,0BAA0B;AAAA,MAC5CC,SAASZ;AAAAA,MACTa,QAAQL;AAAAA,MACRM,WAAWP;AAAAA,IAAAA,CACZ;AAED,WAAO,MAAM;AACC,kBAAA;AAEZ,UAAIf,WAAWI,SAAS;AACtBC,qBAAaL,WAAWI,OAAO;AAAA,MAAA;AAAA,IAEnC;AAAA,EAEF,GAAG,EAAE;AACP;"}