{"version":3,"file":"useWithdrawAnalytics.js","sources":["../../../src/earn/hooks/useWithdrawAnalytics.ts"],"sourcesContent":["import { useAnalytics } from '@/core/analytics/hooks/useAnalytics';\nimport { EarnEvent } from '@/core/analytics/types';\nimport { useEarnContext } from '@/earn/components/EarnProvider';\nimport type { LifecycleStatus } from '@/transaction/types';\nimport { useEffect, useMemo, useRef, useState } from 'react';\n\nexport const useWithdrawAnalytics = (withdrawnAmount: string) => {\n  const [transactionState, setTransactionState] = useState<\n    LifecycleStatus['statusName'] | null\n  >(null);\n  const successSent = useRef(false);\n  const errorSent = useRef(false);\n  const { sendAnalytics } = useAnalytics();\n\n  const { vaultAddress, vaultToken, recipientAddress, withdrawAmount } =\n    useEarnContext();\n\n  const analyticsData = useMemo(\n    () => ({\n      amount: Number(withdrawAmount) || Number(withdrawnAmount), // fall back to withdrawnAmount to avoid sending 0\n      address: recipientAddress ?? '',\n      tokenAddress: vaultToken?.address ?? '',\n      vaultAddress,\n    }),\n    [\n      withdrawAmount,\n      withdrawnAmount,\n      recipientAddress,\n      vaultToken?.address,\n      vaultAddress,\n    ],\n  );\n\n  useEffect(() => {\n    if (transactionState === 'buildingTransaction') {\n      successSent.current = false;\n      sendAnalytics(EarnEvent.EarnWithdrawInitiated, analyticsData);\n    }\n\n    if (transactionState === 'success' && !successSent.current) {\n      successSent.current = true;\n      sendAnalytics(EarnEvent.EarnWithdrawSuccess, analyticsData);\n    }\n\n    if (transactionState === 'error' && !errorSent.current) {\n      errorSent.current = true;\n      sendAnalytics(EarnEvent.EarnWithdrawFailure, analyticsData);\n    }\n  }, [transactionState, analyticsData, sendAnalytics]);\n\n  return {\n    setTransactionState,\n  };\n};\n"],"names":["useWithdrawAnalytics","withdrawnAmount","transactionState","setTransactionState","useState","successSent","useRef","errorSent","sendAnalytics","useAnalytics","vaultAddress","vaultToken","recipientAddress","withdrawAmount","useEarnContext","analyticsData","useMemo","amount","Number","address","tokenAddress","useEffect","current","EarnEvent","EarnWithdrawInitiated","EarnWithdrawSuccess","EarnWithdrawFailure"],"mappings":";;;;AAMaA,MAAAA,uBAAuBA,CAACC,oBAA4B;AAC/D,QAAM,CAACC,kBAAkBC,mBAAmB,IAAIC,SAE9C,IAAI;AACAC,QAAAA,cAAcC,OAAO,KAAK;AAC1BC,QAAAA,YAAYD,OAAO,KAAK;AACxB,QAAA;AAAA,IAAEE;AAAAA,MAAkBC,aAAa;AAEjC,QAAA;AAAA,IAAEC;AAAAA,IAAcC;AAAAA,IAAYC;AAAAA,IAAkBC;AAAAA,MAClDC,eAAe;AAEXC,QAAAA,gBAAgBC,QACpB,OAAO;AAAA,IACLC,QAAQC,OAAOL,cAAc,KAAKK,OAAOjB,eAAe;AAAA;AAAA,IACxDkB,SAASP,oBAAoB;AAAA,IAC7BQ,eAAcT,yCAAYQ,YAAW;AAAA,IACrCT;AAAAA,EAAAA,IAEF,CACEG,gBACAZ,iBACAW,kBACAD,yCAAYQ,SACZT,YAAY,CAEhB;AAEAW,YAAU,MAAM;AACd,QAAInB,qBAAqB,uBAAuB;AAC9CG,kBAAYiB,UAAU;AACRC,oBAAAA,UAAUC,uBAAuBT,aAAa;AAAA,IAAA;AAG9D,QAAIb,qBAAqB,aAAa,CAACG,YAAYiB,SAAS;AAC1DjB,kBAAYiB,UAAU;AACRC,oBAAAA,UAAUE,qBAAqBV,aAAa;AAAA,IAAA;AAG5D,QAAIb,qBAAqB,WAAW,CAACK,UAAUe,SAAS;AACtDf,gBAAUe,UAAU;AACNC,oBAAAA,UAAUG,qBAAqBX,aAAa;AAAA,IAAA;AAAA,EAE3D,GAAA,CAACb,kBAAkBa,eAAeP,aAAa,CAAC;AAE5C,SAAA;AAAA,IACLL;AAAAA,EACF;AACF;"}