{"version":3,"file":"useDepositAnalytics.js","sources":["../../../src/earn/hooks/useDepositAnalytics.ts"],"sourcesContent":["import { useAnalytics } from '@/core/analytics/hooks/useAnalytics';\nimport { EarnEvent } from '@/core/analytics/types';\nimport { useEarnContext } from '@/earn/components/EarnProvider';\nimport type { LifecycleStatus } from '@/transaction/types';\nimport { useEffect, useMemo, useRef, useState } from 'react';\n\nexport const useDepositAnalytics = (depositedAmount: string) => {\n  const [transactionState, setTransactionState] = useState<\n    LifecycleStatus['statusName'] | null\n  >(null);\n  // Undesirable, but required because Transaction emits multiple success and error events\n  const successSent = useRef(false);\n  const errorSent = useRef(false);\n  const { sendAnalytics } = useAnalytics();\n  const { vaultAddress, vaultToken, recipientAddress, depositAmount } =\n    useEarnContext();\n\n  const analyticsData = useMemo(\n    () => ({\n      amount: Number(depositAmount) || Number(depositedAmount), // fall back to depositedAmount to avoid sending 0\n      address: recipientAddress ?? '',\n      tokenAddress: vaultToken?.address ?? '',\n      vaultAddress,\n    }),\n    [\n      depositedAmount,\n      depositAmount,\n      recipientAddress,\n      vaultToken?.address,\n      vaultAddress,\n    ],\n  );\n\n  useEffect(() => {\n    if (transactionState === 'buildingTransaction') {\n      successSent.current = false; // in case user does a second deposit\n      sendAnalytics(EarnEvent.EarnDepositInitiated, analyticsData);\n    }\n\n    if (transactionState === 'success' && !successSent.current) {\n      successSent.current = true;\n      sendAnalytics(EarnEvent.EarnDepositSuccess, analyticsData);\n    }\n\n    if (transactionState === 'error' && !errorSent.current) {\n      errorSent.current = true;\n      sendAnalytics(EarnEvent.EarnDepositFailure, analyticsData);\n    }\n  }, [transactionState, analyticsData, sendAnalytics]);\n\n  return {\n    setTransactionState,\n  };\n};\n"],"names":["useDepositAnalytics","depositedAmount","transactionState","setTransactionState","useState","successSent","useRef","errorSent","sendAnalytics","useAnalytics","vaultAddress","vaultToken","recipientAddress","depositAmount","useEarnContext","analyticsData","useMemo","amount","Number","address","tokenAddress","useEffect","current","EarnEvent","EarnDepositInitiated","EarnDepositSuccess","EarnDepositFailure"],"mappings":";;;;AAMaA,MAAAA,sBAAsBA,CAACC,oBAA4B;AAC9D,QAAM,CAACC,kBAAkBC,mBAAmB,IAAIC,SAE9C,IAAI;AAEAC,QAAAA,cAAcC,OAAO,KAAK;AAC1BC,QAAAA,YAAYD,OAAO,KAAK;AACxB,QAAA;AAAA,IAAEE;AAAAA,MAAkBC,aAAa;AACjC,QAAA;AAAA,IAAEC;AAAAA,IAAcC;AAAAA,IAAYC;AAAAA,IAAkBC;AAAAA,MAClDC,eAAe;AAEXC,QAAAA,gBAAgBC,QACpB,OAAO;AAAA,IACLC,QAAQC,OAAOL,aAAa,KAAKK,OAAOjB,eAAe;AAAA;AAAA,IACvDkB,SAASP,oBAAoB;AAAA,IAC7BQ,eAAcT,yCAAYQ,YAAW;AAAA,IACrCT;AAAAA,EAAAA,IAEF,CACET,iBACAY,eACAD,kBACAD,yCAAYQ,SACZT,YAAY,CAEhB;AAEAW,YAAU,MAAM;AACd,QAAInB,qBAAqB,uBAAuB;AAC9CG,kBAAYiB,UAAU;AACRC,oBAAAA,UAAUC,sBAAsBT,aAAa;AAAA,IAAA;AAG7D,QAAIb,qBAAqB,aAAa,CAACG,YAAYiB,SAAS;AAC1DjB,kBAAYiB,UAAU;AACRC,oBAAAA,UAAUE,oBAAoBV,aAAa;AAAA,IAAA;AAG3D,QAAIb,qBAAqB,WAAW,CAACK,UAAUe,SAAS;AACtDf,gBAAUe,UAAU;AACNC,oBAAAA,UAAUG,oBAAoBX,aAAa;AAAA,IAAA;AAAA,EAE1D,GAAA,CAACb,kBAAkBa,eAAeP,aAAa,CAAC;AAE5C,SAAA;AAAA,IACLL;AAAAA,EACF;AACF;"}