{"version":3,"file":"WithdrawButton.js","sources":["../../../src/earn/components/WithdrawButton.tsx"],"sourcesContent":["'use client';\nimport { useWithdrawAnalytics } from '@/earn/hooks/useWithdrawAnalytics';\nimport { cn } from '@/styles/theme';\nimport {\n  type LifecycleStatus,\n  Transaction,\n  TransactionButton,\n  type TransactionResponseType,\n} from '@/transaction';\nimport { TransactionButtonRenderParams } from '@/transaction/types';\nimport { ConnectWallet } from '@/wallet';\nimport { useCallback, useState } from 'react';\nimport type { WithdrawButtonProps } from '../types';\nimport { useEarnContext } from './EarnProvider';\nimport { RenderWithdrawButton } from './RenderWithdrawButton';\n\nexport function WithdrawButton({ className }: WithdrawButtonProps) {\n  const {\n    recipientAddress: address,\n    withdrawCalls,\n    withdrawAmount,\n    setWithdrawAmount,\n    updateLifecycleStatus,\n    refetchDepositedBalance,\n    withdrawAmountError,\n    vaultToken,\n    isSponsored,\n  } = useEarnContext();\n  const [withdrawnAmount, setWithdrawnAmount] = useState('');\n  const { setTransactionState } = useWithdrawAnalytics(withdrawnAmount);\n\n  const handleOnStatus = useCallback(\n    (status: LifecycleStatus) => {\n      setTransactionState(status.statusName);\n      if (status.statusName === 'transactionPending') {\n        updateLifecycleStatus({ statusName: 'transactionPending' });\n      }\n\n      if (\n        status.statusName === 'transactionLegacyExecuted' ||\n        status.statusName === 'success' ||\n        status.statusName === 'error'\n      ) {\n        updateLifecycleStatus(status);\n      }\n    },\n    [updateLifecycleStatus, setTransactionState],\n  );\n\n  const handleOnSuccess = useCallback(\n    (res: TransactionResponseType) => {\n      if (\n        res.transactionReceipts[0] &&\n        res.transactionReceipts[0].status === 'success'\n      ) {\n        if (withdrawAmount) {\n          setWithdrawnAmount(withdrawAmount);\n        }\n        setWithdrawAmount('');\n        refetchDepositedBalance();\n      }\n    },\n    [setWithdrawAmount, refetchDepositedBalance, withdrawAmount],\n  );\n\n  if (!address) {\n    return (\n      <ConnectWallet\n        className={cn('w-full', className)}\n        disconnectedLabel=\"Connect to withdraw\"\n      />\n    );\n  }\n\n  return (\n    <Transaction\n      className={className}\n      calls={withdrawCalls}\n      onStatus={handleOnStatus}\n      onSuccess={handleOnSuccess}\n      isSponsored={isSponsored}\n      resetAfter={3_000}\n    >\n      <TransactionButton\n        render={(params: TransactionButtonRenderParams) => {\n          return (\n            <RenderWithdrawButton\n              withdrawAmountError={withdrawAmountError}\n              withdrawnAmount={withdrawAmount}\n              vaultToken={vaultToken}\n              {...params}\n            />\n          );\n        }}\n        disabled={!!withdrawAmountError || !withdrawAmount}\n      />\n    </Transaction>\n  );\n}\n"],"names":["WithdrawButton","className","recipientAddress","address","withdrawCalls","withdrawAmount","setWithdrawAmount","updateLifecycleStatus","refetchDepositedBalance","withdrawAmountError","vaultToken","isSponsored","useEarnContext","withdrawnAmount","setWithdrawnAmount","useState","setTransactionState","useWithdrawAnalytics","handleOnStatus","useCallback","status","statusName","handleOnSuccess","res","transactionReceipts","cn","params"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgBO,SAASA,eAAe;AAAA,EAAEC;AAA+B,GAAG;AAC3D,QAAA;AAAA,IACJC,kBAAkBC;AAAAA,IAClBC;AAAAA,IACAC;AAAAA,IACAC;AAAAA,IACAC;AAAAA,IACAC;AAAAA,IACAC;AAAAA,IACAC;AAAAA,IACAC;AAAAA,MACEC,eAAe;AACnB,QAAM,CAACC,iBAAiBC,kBAAkB,IAAIC,SAAS,EAAE;AACnD,QAAA;AAAA,IAAEC;AAAAA,EAAAA,IAAwBC,qBAAqBJ,eAAe;AAE9DK,QAAAA,iBAAiBC,YACrB,CAACC,WAA4B;AAC3BJ,wBAAoBI,OAAOC,UAAU;AACjCD,QAAAA,OAAOC,eAAe,sBAAsB;AACxB,4BAAA;AAAA,QAAEA,YAAY;AAAA,MAAA,CAAsB;AAAA,IAAA;AAI1DD,QAAAA,OAAOC,eAAe,+BACtBD,OAAOC,eAAe,aACtBD,OAAOC,eAAe,SACtB;AACAd,4BAAsBa,MAAM;AAAA,IAAA;AAAA,EAC9B,GAEF,CAACb,uBAAuBS,mBAAmB,CAC7C;AAEMM,QAAAA,kBAAkBH,YACtB,CAACI,QAAiC;AAE9BA,QAAAA,IAAIC,oBAAoB,CAAC,KACzBD,IAAIC,oBAAoB,CAAC,EAAEJ,WAAW,WACtC;AACA,UAAIf,gBAAgB;AAClBS,2BAAmBT,cAAc;AAAA,MAAA;AAEnCC,wBAAkB,EAAE;AACI,8BAAA;AAAA,IAAA;AAAA,EAG5B,GAAA,CAACA,mBAAmBE,yBAAyBH,cAAc,CAC7D;AAEA,MAAI,CAACF,SAAS;AAEV,WAAA,oBAAC,iBACC,WAAWsB,GAAaxB,cAAAA,SAAS,GACjC,mBAAkB,uBAClB;AAAA,EAAA;AAIN,6BACG,aACC,EAAA,WACA,OAAOG,eACP,UAAUc,gBACV,WAAWI,iBACX,aACA,YAAY,KAEZ,UAAA,oBAAC,mBACC,EAAA,QAAQ,CAACI,WAA0C;AACjD,+BACG,sBACC,EAAA,qBACA,iBAAiBrB,gBACjB,YACA,GAAIqB,QACJ;AAAA,EAAA,GAGN,UAAU,CAAC,CAACjB,uBAAuB,CAACJ,gBAAe,EAEvD,CAAA;AAEJ;"}