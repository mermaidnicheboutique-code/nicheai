{"version":3,"file":"DepositButton.js","sources":["../../../src/earn/components/DepositButton.tsx"],"sourcesContent":["'use client';\nimport { useDepositAnalytics } from '@/earn/hooks/useDepositAnalytics';\nimport { cn } from '@/styles/theme';\nimport {\n  type LifecycleStatus,\n  Transaction,\n  TransactionButton,\n  type TransactionResponseType,\n} from '@/transaction';\nimport { TransactionButtonRenderParams } from '@/transaction/types';\nimport { ConnectWallet } from '@/wallet';\nimport { useCallback, useState } from 'react';\nimport type { DepositButtonProps } from '../types';\nimport { useEarnContext } from './EarnProvider';\nimport { RenderDepositButton } from './RenderDepositButton';\n\nexport function DepositButton({ className }: DepositButtonProps) {\n  const {\n    recipientAddress: address,\n    vaultToken,\n    depositCalls,\n    depositAmount,\n    setDepositAmount,\n    depositAmountError,\n    updateLifecycleStatus,\n    refetchWalletBalance,\n    isSponsored,\n  } = useEarnContext();\n  const [depositedAmount, setDepositedAmount] = useState('');\n  const { setTransactionState } = useDepositAnalytics(depositedAmount);\n\n  const handleOnStatus = useCallback(\n    (status: LifecycleStatus) => {\n      setTransactionState(status.statusName);\n\n      if (status.statusName === 'transactionPending') {\n        updateLifecycleStatus({ statusName: 'transactionPending' });\n      }\n\n      if (\n        status.statusName === 'transactionLegacyExecuted' ||\n        status.statusName === 'success' ||\n        status.statusName === 'error'\n      ) {\n        updateLifecycleStatus(status);\n      }\n    },\n    [updateLifecycleStatus, setTransactionState],\n  );\n\n  const handleOnSuccess = useCallback(\n    (res: TransactionResponseType) => {\n      if (\n        res.transactionReceipts[0] &&\n        res.transactionReceipts[0].status === 'success'\n      ) {\n        // Don't overwrite to '' when the second txn comes in\n        if (depositAmount) {\n          setDepositedAmount(depositAmount);\n        }\n        setDepositAmount('');\n        refetchWalletBalance();\n      }\n    },\n    [depositAmount, setDepositAmount, refetchWalletBalance],\n  );\n\n  if (!address) {\n    return (\n      <ConnectWallet\n        className={cn('w-full', className)}\n        disconnectedLabel=\"Connect to deposit\"\n      />\n    );\n  }\n\n  return (\n    <Transaction\n      className={className}\n      calls={depositCalls}\n      onStatus={handleOnStatus}\n      onSuccess={handleOnSuccess}\n      isSponsored={isSponsored}\n      resetAfter={3_000}\n    >\n      <TransactionButton\n        render={(params: TransactionButtonRenderParams) => {\n          return (\n            <RenderDepositButton\n              {...params}\n              depositAmountError={depositAmountError}\n              depositedAmount={depositedAmount}\n              vaultToken={vaultToken}\n            />\n          );\n        }}\n        disabled={!!depositAmountError || !depositAmount}\n      />\n    </Transaction>\n  );\n}\n"],"names":["DepositButton","className","recipientAddress","address","vaultToken","depositCalls","depositAmount","setDepositAmount","depositAmountError","updateLifecycleStatus","refetchWalletBalance","isSponsored","useEarnContext","depositedAmount","setDepositedAmount","useState","setTransactionState","useDepositAnalytics","handleOnStatus","useCallback","status","statusName","handleOnSuccess","res","transactionReceipts","cn","params"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgBO,SAASA,cAAc;AAAA,EAAEC;AAA8B,GAAG;AACzD,QAAA;AAAA,IACJC,kBAAkBC;AAAAA,IAClBC;AAAAA,IACAC;AAAAA,IACAC;AAAAA,IACAC;AAAAA,IACAC;AAAAA,IACAC;AAAAA,IACAC;AAAAA,IACAC;AAAAA,MACEC,eAAe;AACnB,QAAM,CAACC,iBAAiBC,kBAAkB,IAAIC,SAAS,EAAE;AACnD,QAAA;AAAA,IAAEC;AAAAA,EAAAA,IAAwBC,oBAAoBJ,eAAe;AAE7DK,QAAAA,iBAAiBC,YACrB,CAACC,WAA4B;AAC3BJ,wBAAoBI,OAAOC,UAAU;AAEjCD,QAAAA,OAAOC,eAAe,sBAAsB;AACxB,4BAAA;AAAA,QAAEA,YAAY;AAAA,MAAA,CAAsB;AAAA,IAAA;AAI1DD,QAAAA,OAAOC,eAAe,+BACtBD,OAAOC,eAAe,aACtBD,OAAOC,eAAe,SACtB;AACAZ,4BAAsBW,MAAM;AAAA,IAAA;AAAA,EAC9B,GAEF,CAACX,uBAAuBO,mBAAmB,CAC7C;AAEMM,QAAAA,kBAAkBH,YACtB,CAACI,QAAiC;AAE9BA,QAAAA,IAAIC,oBAAoB,CAAC,KACzBD,IAAIC,oBAAoB,CAAC,EAAEJ,WAAW,WACtC;AAEA,UAAId,eAAe;AACjBQ,2BAAmBR,aAAa;AAAA,MAAA;AAElCC,uBAAiB,EAAE;AACE,2BAAA;AAAA,IAAA;AAAA,EAGzB,GAAA,CAACD,eAAeC,kBAAkBG,oBAAoB,CACxD;AAEA,MAAI,CAACP,SAAS;AAEV,WAAA,oBAAC,iBACC,WAAWsB,GAAaxB,cAAAA,SAAS,GACjC,mBAAkB,sBAClB;AAAA,EAAA;AAIN,6BACG,aACC,EAAA,WACA,OAAOI,cACP,UAAUa,gBACV,WAAWI,iBACX,aACA,YAAY,KAEZ,UAAA,oBAAC,mBACC,EAAA,QAAQ,CAACI,WAA0C;AACjD,+BACG,qBACKA,EAAAA,GAAAA,QACJ,oBACA,iBACA,YACA;AAAA,EAAA,GAGN,UAAU,CAAC,CAAClB,sBAAsB,CAACF,eAAc,EAErD,CAAA;AAEJ;"}