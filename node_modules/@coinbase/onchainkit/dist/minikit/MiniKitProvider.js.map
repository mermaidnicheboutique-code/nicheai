{"version":3,"file":"MiniKitProvider.js","sources":["../../src/minikit/MiniKitProvider.tsx"],"sourcesContent":["'use client';\nimport sdk, { type Context } from '@farcaster/miniapp-sdk';\nimport {\n  createContext,\n  useCallback,\n  useEffect,\n  useMemo,\n  useState,\n} from 'react';\nimport type {\n  MiniKitContextType,\n  MiniKitProviderProps,\n  UpdateClientContextParams,\n} from './types';\nimport { AutoConnect } from './components/AutoConnect';\n\nexport const MiniKitContext = createContext<MiniKitContextType>({\n  enabled: false,\n  context: null,\n  updateClientContext: () => {},\n  notificationProxyUrl: '',\n  __isMiniKit: false,\n});\n\nfunction MiniKitProviderContent({\n  children,\n  notificationProxyUrl = '/api/notify',\n  autoConnect = true,\n}: MiniKitProviderProps) {\n  const [context, setContext] = useState<Context.MiniAppContext | null>(null);\n\n  const updateClientContext = useCallback(\n    ({ details, miniAppAdded }: UpdateClientContextParams) => {\n      setContext((prevContext) => {\n        if (!prevContext) {\n          return null;\n        }\n        return {\n          ...prevContext,\n          client: {\n            ...prevContext.client,\n            notificationDetails: details ?? undefined,\n            added: miniAppAdded ?? prevContext.client.added,\n          },\n        };\n      });\n    },\n    [],\n  );\n\n  useEffect(() => {\n    sdk.on('miniAppAdded', ({ notificationDetails }) => {\n      if (notificationDetails) {\n        updateClientContext({\n          details: notificationDetails,\n          miniAppAdded: true,\n        });\n      }\n    });\n\n    sdk.on('miniAppAddRejected', ({ reason }) => {\n      console.error('MiniApp add rejected', reason);\n    });\n\n    sdk.on('miniAppRemoved', () => {\n      updateClientContext({\n        details: undefined,\n        miniAppAdded: false,\n      });\n    });\n\n    sdk.on('notificationsEnabled', ({ notificationDetails }) => {\n      updateClientContext({\n        details: notificationDetails,\n      });\n    });\n\n    sdk.on('notificationsDisabled', () => {\n      updateClientContext({\n        details: undefined,\n      });\n    });\n\n    async function fetchContext() {\n      try {\n        // if not running in a frame, context resolves as undefined\n        const context = await sdk.context;\n        setContext(context);\n      } catch (error) {\n        console.error('Error fetching context:', error);\n      }\n    }\n\n    fetchContext();\n\n    return () => {\n      sdk.removeAllListeners();\n    };\n  }, [updateClientContext]);\n\n  const value = useMemo(() => {\n    return {\n      enabled: true,\n      context,\n      updateClientContext,\n      notificationProxyUrl,\n      __isMiniKit: true,\n    };\n  }, [updateClientContext, notificationProxyUrl, context]);\n\n  return (\n    <MiniKitContext.Provider value={value}>\n      <AutoConnect enabled={autoConnect}>{children}</AutoConnect>\n    </MiniKitContext.Provider>\n  );\n}\n\nexport function MiniKitProvider({\n  children,\n  notificationProxyUrl,\n  enabled,\n  autoConnect,\n}: MiniKitProviderProps) {\n  if (!enabled) {\n    return children;\n  }\n\n  return (\n    <MiniKitProviderContent\n      notificationProxyUrl={notificationProxyUrl}\n      autoConnect={autoConnect}\n    >\n      {children}\n    </MiniKitProviderContent>\n  );\n}\n"],"names":["MiniKitContext","createContext","enabled","context","updateClientContext","notificationProxyUrl","__isMiniKit","MiniKitProviderContent","children","autoConnect","setContext","useState","useCallback","details","miniAppAdded","prevContext","client","notificationDetails","undefined","added","useEffect","on","reason","error","fetchContext","sdk","removeAllListeners","value","useMemo","MiniKitProvider"],"mappings":";;;;AAgBO,MAAMA,iBAAiBC,cAAkC;AAAA,EAC9DC,SAAS;AAAA,EACTC,SAAS;AAAA,EACTC,qBAAqBA,MAAM;AAAA,EAAC;AAAA,EAC5BC,sBAAsB;AAAA,EACtBC,aAAa;AACf,CAAC;AAED,SAASC,uBAAuB;AAAA,EAC9BC;AAAAA,EACAH,uBAAuB;AAAA,EACvBI,cAAc;AACM,GAAG;AACvB,QAAM,CAACN,SAASO,UAAU,IAAIC,SAAwC,IAAI;AAEpEP,QAAAA,sBAAsBQ,YAC1B,CAAC;AAAA,IAAEC;AAAAA,IAASC;AAAAA,EAAAA,MAA8C;AACxDJ,eAAYK,CAAgB,gBAAA;AAC1B,UAAI,CAACA,aAAa;AACT,eAAA;AAAA,MAAA;AAEF,aAAA;AAAA,QACL,GAAGA;AAAAA,QACHC,QAAQ;AAAA,UACN,GAAGD,YAAYC;AAAAA,UACfC,qBAAqBJ,WAAWK;AAAAA,UAChCC,OAAOL,gBAAgBC,YAAYC,OAAOG;AAAAA,QAAAA;AAAAA,MAE9C;AAAA,IAAA,CACD;AAAA,EACH,GACA,EACF;AAEAC,YAAU,MAAM;AACVC,QAAAA,GAAG,gBAAgB,CAAC;AAAA,MAAEJ;AAAAA,IAAAA,MAA0B;AAClD,UAAIA,qBAAqB;AACH,4BAAA;AAAA,UAClBJ,SAASI;AAAAA,UACTH,cAAc;AAAA,QAAA,CACf;AAAA,MAAA;AAAA,IACH,CACD;AAEGO,QAAAA,GAAG,sBAAsB,CAAC;AAAA,MAAEC;AAAAA,IAAAA,MAAa;AACnCC,cAAAA,MAAM,wBAAwBD,MAAM;AAAA,IAAA,CAC7C;AAEGD,QAAAA,GAAG,kBAAkB,MAAM;AACT,0BAAA;AAAA,QAClBR,SAASK;AAAAA,QACTJ,cAAc;AAAA,MAAA,CACf;AAAA,IAAA,CACF;AAEGO,QAAAA,GAAG,wBAAwB,CAAC;AAAA,MAAEJ;AAAAA,IAAAA,MAA0B;AACtC,0BAAA;AAAA,QAClBJ,SAASI;AAAAA,MAAAA,CACV;AAAA,IAAA,CACF;AAEGI,QAAAA,GAAG,yBAAyB,MAAM;AAChB,0BAAA;AAAA,QAClBR,SAASK;AAAAA,MAAAA,CACV;AAAA,IAAA,CACF;AAED,mBAAeM,eAAe;AACxB,UAAA;AAEIrB,cAAAA,WAAU,MAAMsB,IAAItB;AAC1BO,mBAAWP,QAAO;AAAA,eACXoB,OAAO;AACNA,gBAAAA,MAAM,2BAA2BA,KAAK;AAAA,MAAA;AAAA,IAChD;AAGW,iBAAA;AAEb,WAAO,MAAM;AACXE,UAAIC,mBAAmB;AAAA,IACzB;AAAA,EAAA,GACC,CAACtB,mBAAmB,CAAC;AAElBuB,QAAAA,QAAQC,QAAQ,MAAM;AACnB,WAAA;AAAA,MACL1B,SAAS;AAAA,MACTC;AAAAA,MACAC;AAAAA,MACAC;AAAAA,MACAC,aAAa;AAAA,IACf;AAAA,EACC,GAAA,CAACF,qBAAqBC,sBAAsBF,OAAO,CAAC;AAGrD,SAAA,oBAAC,eAAe,UAAf,EAAwB,OACvB,8BAAC,aAAY,EAAA,SAASM,aAAcD,SAAAA,CAAS,EAC/C,CAAA;AAEJ;AAEO,SAASqB,gBAAgB;AAAA,EAC9BrB;AAAAA,EACAH;AAAAA,EACAH;AAAAA,EACAO;AACoB,GAAG;AACvB,MAAI,CAACP,SAAS;AACLM,WAAAA;AAAAA,EAAAA;AAGT,SACG,oBAAA,wBAAA,EACC,sBACA,aAECA,SACH,CAAA;AAEJ;"}