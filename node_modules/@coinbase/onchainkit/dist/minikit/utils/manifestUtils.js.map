{"version":3,"file":"manifestUtils.js","sources":["../../../src/minikit/utils/manifestUtils.ts"],"sourcesContent":["import type {\n  MiniAppManifest,\n  MiniAppFields,\n  LegacyMiniAppManifest,\n} from './types';\n\nexport function withValidManifest<\n  T extends MiniAppManifest | LegacyMiniAppManifest,\n>(manifest: T): T {\n  const { accountAssociation, miniapp, frame, ...rest } = manifest;\n\n  const miniappObject =\n    ('miniapp' in manifest && miniapp) || ('frame' in manifest && frame);\n\n  // Validate that miniapp object exists\n  if (!miniappObject) {\n    throw new Error('Invalid manifest: miniapp field is required');\n  }\n\n  // Validate required fields\n  const requiredFields: Array<keyof MiniAppFields> = [\n    'version',\n    'name',\n    'homeUrl',\n    'iconUrl',\n  ];\n\n  for (const field of requiredFields) {\n    if (!miniappObject[field]) {\n      throw new Error(`Invalid manifest: ${field} is required`);\n    }\n  }\n\n  // Validate version constraint\n  if (miniappObject.version !== '1') {\n    throw new Error('Invalid manifest: version must be \"1\"');\n  }\n\n  // Clean optional fields that are missing/empty\n  const cleanedMiniapp = Object.fromEntries(\n    Object.entries(miniappObject).filter(([key, value]) => {\n      if (requiredFields.includes(key as keyof MiniAppFields)) {\n        return true;\n      }\n\n      if (Array.isArray(value)) {\n        return value.length > 0;\n      }\n\n      return value !== undefined && value !== null && value !== '';\n    }),\n  ) as MiniAppFields;\n\n  const hasValidAccountAssociation =\n    accountAssociation &&\n    accountAssociation.header &&\n    accountAssociation.payload &&\n    accountAssociation.signature;\n\n  if (accountAssociation && !hasValidAccountAssociation) {\n    console.warn(\n      'Invalid manifest accountAssociation. Omitting from manifest.',\n    );\n  }\n\n  return {\n    ...(hasValidAccountAssociation && {\n      accountAssociation: manifest.accountAssociation,\n    }),\n    miniapp: cleanedMiniapp,\n    ...rest,\n  } as T;\n}\n"],"names":["withValidManifest","manifest","accountAssociation","miniapp","frame","rest","miniappObject","Error","requiredFields","field","version","cleanedMiniapp","Object","fromEntries","entries","filter","key","value","includes","Array","isArray","length","undefined","hasValidAccountAssociation","header","payload","signature","console","warn"],"mappings":"AAMO,SAASA,kBAEdC,UAAgB;AACV,QAAA;AAAA,IAAEC;AAAAA,IAAoBC;AAAAA,IAASC;AAAAA,IAAO,GAAGC;AAAAA,EAAAA,IAASJ;AAExD,QAAMK,gBACH,aAAaL,YAAYE,WAAa,WAAWF,YAAYG;AAGhE,MAAI,CAACE,eAAe;AACZ,UAAA,IAAIC,MAAM,6CAA6C;AAAA,EAAA;AAI/D,QAAMC,iBAA6C,CACjD,WACA,QACA,WACA,SAAS;AAGX,aAAWC,SAASD,gBAAgB;AAC9B,QAAA,CAACF,cAAcG,KAAK,GAAG;AACzB,YAAM,IAAIF,MAAM,qBAAqBE,KAAK,cAAc;AAAA,IAAA;AAAA,EAC1D;AAIEH,MAAAA,cAAcI,YAAY,KAAK;AAC3B,UAAA,IAAIH,MAAM,uCAAuC;AAAA,EAAA;AAIzD,QAAMI,iBAAiBC,OAAOC,YAC5BD,OAAOE,QAAQR,aAAa,EAAES,OAAO,CAAC,CAACC,KAAKC,KAAK,MAAM;AACjDT,QAAAA,eAAeU,SAASF,GAA0B,GAAG;AAChD,aAAA;AAAA,IAAA;AAGLG,QAAAA,MAAMC,QAAQH,KAAK,GAAG;AACxB,aAAOA,MAAMI,SAAS;AAAA,IAAA;AAGxB,WAAOJ,UAAUK,UAAaL,UAAU,QAAQA,UAAU;AAAA,EAAA,CAC3D,CACH;AAEA,QAAMM,6BACJrB,sBACAA,mBAAmBsB,UACnBtB,mBAAmBuB,WACnBvB,mBAAmBwB;AAEjBxB,MAAAA,sBAAsB,CAACqB,4BAA4B;AACrDI,YAAQC,KACN,8DACF;AAAA,EAAA;AAGK,SAAA;AAAA,IACL,GAAIL,8BAA8B;AAAA,MAChCrB,oBAAoBD,SAASC;AAAAA,IAC/B;AAAA,IACAC,SAASQ;AAAAA,IACT,GAAGN;AAAAA,EACL;AACF;"}