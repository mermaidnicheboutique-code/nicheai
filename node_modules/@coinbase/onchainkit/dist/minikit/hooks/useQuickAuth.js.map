{"version":3,"file":"useQuickAuth.js","sources":["../../../src/minikit/hooks/useQuickAuth.ts"],"sourcesContent":["'use client';\nimport { useQuery, UseQueryOptions } from '@tanstack/react-query';\nimport sdk from '@farcaster/miniapp-sdk';\nimport { useIsInMiniApp } from './useIsInMiniApp';\nimport { useRef } from 'react';\n\ntype FetchParams = Parameters<typeof sdk.quickAuth.fetch>;\ntype Input = FetchParams[0];\ntype Init = FetchParams[1];\n\n/**\n * Hook to authenticate user via Farcaster SDK's Quick Auth feature.\n * Runs only in Mini App context, performs a single authenticated fetch to\n * your app's auth endpoint\n * @param input - The endpoint that will process the Quick Auth request\n * @param init - A RequestInit object containing any custom settings that you want to apply to the request\n * @param useQueryOptions - Options to pass to the useQuery hook\n * @returns The React Query result where `data` is `TQuickAuthResponse | null`\n */\nexport function useQuickAuth<TQuickAuthResponse = unknown>(\n  input: Input,\n  init?: Init,\n  useQueryOptions?: UseQueryOptions<TQuickAuthResponse | null>,\n) {\n  const { isInMiniApp } = useIsInMiniApp();\n  const hasAuthedRef = useRef(false);\n\n  return useQuery<TQuickAuthResponse | null>({\n    queryKey: ['useQuickAuth', isInMiniApp],\n    queryFn: async () => {\n      if (hasAuthedRef.current) {\n        return null;\n      }\n\n      try {\n        const result = await sdk.quickAuth.fetch(input, init);\n\n        if (!result.ok) {\n          throw new Error('quickAuth.fetch response was not successful');\n        }\n\n        const data = (await result.json()) as TQuickAuthResponse;\n        hasAuthedRef.current = true;\n        return data;\n      } catch (err) {\n        console.error('Quick auth error:', err);\n        hasAuthedRef.current = true;\n        return null;\n      }\n    },\n    enabled: !!isInMiniApp,\n    ...useQueryOptions,\n  });\n}\n"],"names":["useQuickAuth","input","init","useQueryOptions","isInMiniApp","useIsInMiniApp","hasAuthedRef","useRef","useQuery","queryKey","queryFn","current","result","sdk","quickAuth","fetch","ok","Error","data","json","err","error","enabled"],"mappings":";;;;AAmBgBA,SAAAA,aACdC,OACAC,MACAC,iBACA;AACM,QAAA;AAAA,IAAEC;AAAAA,MAAgBC,eAAe;AACjCC,QAAAA,eAAeC,OAAO,KAAK;AAEjC,SAAOC,SAAoC;AAAA,IACzCC,UAAU,CAAC,gBAAgBL,WAAW;AAAA,IACtCM,SAAS,YAAY;AACnB,UAAIJ,aAAaK,SAAS;AACjB,eAAA;AAAA,MAAA;AAGL,UAAA;AACF,cAAMC,SAAS,MAAMC,IAAIC,UAAUC,MAAMd,OAAOC,IAAI;AAEhD,YAAA,CAACU,OAAOI,IAAI;AACR,gBAAA,IAAIC,MAAM,6CAA6C;AAAA,QAAA;AAGzDC,cAAAA,OAAQ,MAAMN,OAAOO,KAAK;AAChCb,qBAAaK,UAAU;AAChBO,eAAAA;AAAAA,eACAE,KAAK;AACJC,gBAAAA,MAAM,qBAAqBD,GAAG;AACtCd,qBAAaK,UAAU;AAChB,eAAA;AAAA,MAAA;AAAA,IAEX;AAAA,IACAW,SAAS,CAAC,CAAClB;AAAAA,IACX,GAAGD;AAAAA,EAAAA,CACJ;AACH;"}