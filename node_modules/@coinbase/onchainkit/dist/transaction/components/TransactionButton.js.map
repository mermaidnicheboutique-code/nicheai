{"version":3,"file":"TransactionButton.js","sources":["../../../src/transaction/components/TransactionButton.tsx"],"sourcesContent":["import { useCallback, useMemo } from 'react';\nimport { useAccount, useChainId } from 'wagmi';\nimport { getChainExplorer } from '../../core/network/getChainExplorer';\nimport { Spinner } from '../../internal/components/Spinner';\nimport { cn, pressable, text } from '../../styles/theme';\nimport type { TransactionButtonProps } from '../types';\nimport { useTransactionContext } from './TransactionProvider';\n\nexport function TransactionButton({\n  className,\n  disabled = false,\n  text: idleText = 'Transact',\n  render,\n}: TransactionButtonProps) {\n  const context = useTransactionContext();\n  const {\n    chainId,\n    errorMessage,\n    isLoading,\n    onSubmit,\n    receipt,\n    transactions,\n    transactionHash,\n    transactionId,\n  } = context;\n\n  const { address } = useAccount();\n  // eslint-disable-next-line react-hooks/rules-of-hooks\n  const accountChainId = chainId ?? useChainId();\n\n  const isMissingProps = !transactions || !address;\n  const isWaitingForReceipt = !!transactionId || !!transactionHash;\n\n  const isDisabled =\n    !receipt &&\n    (isLoading || isMissingProps || isWaitingForReceipt || disabled);\n\n  const handleSuccess = useCallback(() => {\n    // SW will have txn id so open in wallet\n    if (receipt && transactionId && transactionHash && chainId && address) {\n      const url = new URL('https://wallet.coinbase.com/assets/transactions');\n      url.searchParams.set('contentParams[txHash]', transactionHash);\n      url.searchParams.set('contentParams[chainId]', JSON.stringify(chainId));\n      url.searchParams.set('contentParams[fromAddress]', address);\n      return window.open(url, '_blank', 'noopener,noreferrer');\n    }\n    // EOA will not have txn id so open in explorer\n    const chainExplorer = getChainExplorer(accountChainId);\n    return window.open(\n      `${chainExplorer}/tx/${transactionHash}`,\n      '_blank',\n      'noopener,noreferrer',\n    );\n  }, [\n    address,\n    chainId,\n    receipt,\n    transactionId,\n    transactionHash,\n    accountChainId,\n  ]);\n\n  const buttonContent = useMemo(() => {\n    // txn successful\n    if (receipt) {\n      return 'View transaction';\n    }\n    if (errorMessage) {\n      return 'Try again';\n    }\n    if (isLoading) {\n      return <Spinner />;\n    }\n    return idleText;\n  }, [isLoading, errorMessage, receipt, idleText]);\n\n  const handleSubmit = useCallback(() => {\n    if (receipt) {\n      handleSuccess();\n    } else {\n      onSubmit();\n    }\n  }, [onSubmit, receipt, handleSuccess]);\n\n  const status = useMemo(() => {\n    if (receipt) {\n      return 'success';\n    }\n    if (errorMessage) {\n      return 'error';\n    }\n    if (isLoading) {\n      return 'pending';\n    }\n    return 'default';\n  }, [isLoading, errorMessage, receipt]);\n\n  if (render) {\n    return render({\n      status,\n      context,\n      onSubmit: handleSubmit,\n      onSuccess: handleSuccess,\n      isDisabled,\n    });\n  }\n\n  return (\n    <button\n      className={cn(\n        pressable.primary,\n        'rounded-ock-default',\n        'w-full rounded-xl',\n        'px-4 py-3 font-medium leading-6',\n        isDisabled && pressable.disabled,\n        text.headline,\n        'text-ock-foreground-inverse',\n        className,\n      )}\n      onClick={handleSubmit}\n      type=\"button\"\n      disabled={isDisabled}\n      data-testid=\"ockTransactionButton_Button\"\n    >\n      {buttonContent}\n    </button>\n  );\n}\n"],"names":["TransactionButton","className","disabled","text","idleText","render","context","useTransactionContext","chainId","errorMessage","isLoading","onSubmit","receipt","transactions","transactionHash","transactionId","address","useAccount","accountChainId","useChainId","isMissingProps","isWaitingForReceipt","isDisabled","handleSuccess","useCallback","url","URL","searchParams","set","JSON","stringify","window","open","chainExplorer","getChainExplorer","buttonContent","useMemo","handleSubmit","status","onSuccess","cn","pressable","primary","headline"],"mappings":";;;;;;;AAQO,SAASA,kBAAkB;AAAA,EAChCC;AAAAA,EACAC,WAAW;AAAA,EACXC,MAAMC,WAAW;AAAA,EACjBC;AACsB,GAAG;AACzB,QAAMC,UAAUC,sBAAsB;AAChC,QAAA;AAAA,IACJC;AAAAA,IACAC;AAAAA,IACAC;AAAAA,IACAC;AAAAA,IACAC;AAAAA,IACAC;AAAAA,IACAC;AAAAA,IACAC;AAAAA,EAAAA,IACET;AAEE,QAAA;AAAA,IAAEU;AAAAA,MAAYC,WAAW;AAEzBC,QAAAA,iBAAiBV,WAAWW,WAAW;AAEvCC,QAAAA,iBAAiB,CAACP,gBAAgB,CAACG;AACzC,QAAMK,sBAAsB,CAAC,CAACN,iBAAiB,CAAC,CAACD;AAEjD,QAAMQ,aACJ,CAACV,YACAF,aAAaU,kBAAkBC,uBAAuBnB;AAEnDqB,QAAAA,gBAAgBC,YAAY,MAAM;AAEtC,QAAIZ,WAAWG,iBAAiBD,mBAAmBN,WAAWQ,SAAS;AAC/DS,YAAAA,MAAM,IAAIC,IAAI,iDAAiD;AACjEC,UAAAA,aAAaC,IAAI,yBAAyBd,eAAe;AAC7DW,UAAIE,aAAaC,IAAI,0BAA0BC,KAAKC,UAAUtB,OAAO,CAAC;AAClEmB,UAAAA,aAAaC,IAAI,8BAA8BZ,OAAO;AAC1D,aAAOe,OAAOC,KAAKP,KAAK,UAAU,qBAAqB;AAAA,IAAA;AAGnDQ,UAAAA,gBAAgBC,iBAAiBhB,cAAc;AAC9Ca,WAAAA,OAAOC,KACZ,GAAGC,aAAa,OAAOnB,eAAe,IACtC,UACA,qBACF;AAAA,EAAA,GACC,CACDE,SACAR,SACAI,SACAG,eACAD,iBACAI,cAAc,CACf;AAEKiB,QAAAA,gBAAgBC,QAAQ,MAAM;AAElC,QAAIxB,SAAS;AACJ,aAAA;AAAA,IAAA;AAET,QAAIH,cAAc;AACT,aAAA;AAAA,IAAA;AAET,QAAIC,WAAW;AACb,iCAAQ,SAAU,EAAA;AAAA,IAAA;AAEbN,WAAAA;AAAAA,KACN,CAACM,WAAWD,cAAcG,SAASR,QAAQ,CAAC;AAEzCiC,QAAAA,eAAeb,YAAY,MAAM;AACrC,QAAIZ,SAAS;AACG,oBAAA;AAAA,IAAA,OACT;AACI,eAAA;AAAA,IAAA;AAAA,EAEV,GAAA,CAACD,UAAUC,SAASW,aAAa,CAAC;AAE/Be,QAAAA,SAASF,QAAQ,MAAM;AAC3B,QAAIxB,SAAS;AACJ,aAAA;AAAA,IAAA;AAET,QAAIH,cAAc;AACT,aAAA;AAAA,IAAA;AAET,QAAIC,WAAW;AACN,aAAA;AAAA,IAAA;AAEF,WAAA;AAAA,EACN,GAAA,CAACA,WAAWD,cAAcG,OAAO,CAAC;AAErC,MAAIP,QAAQ;AACV,WAAOA,OAAO;AAAA,MACZiC;AAAAA,MACAhC;AAAAA,MACAK,UAAU0B;AAAAA,MACVE,WAAWhB;AAAAA,MACXD;AAAAA,IAAAA,CACD;AAAA,EAAA;AAID,SAAA,oBAAC,UACC,EAAA,WAAWkB,GACTC,UAAUC,SAIVpB,2BAAAA,6BAAAA,mDAAAA,cAAcmB,UAAUvC,UACxBC,KAAKwC,UAAQ,mCAEb1C,SACF,GACA,SAASoC,cACT,MAAK,UACL,UAAUf,YACV,eAAY,+BAEXa,UACH,cAAA,CAAA;AAEJ;"}