import { jsx } from "react/jsx-runtime";
import { useCallback, useMemo } from "react";
import { useAccount, useChainId } from "wagmi";
import { getChainExplorer } from "../../core/network/getChainExplorer.js";
import { Spinner } from "../../internal/components/Spinner.js";
import { cn, text, pressable } from "../../styles/theme.js";
import { useTransactionContext } from "./TransactionProvider.js";
function TransactionButton({
  className,
  disabled = false,
  text: idleText = "Transact",
  render
}) {
  const context = useTransactionContext();
  const {
    chainId,
    errorMessage,
    isLoading,
    onSubmit,
    receipt,
    transactions,
    transactionHash,
    transactionId
  } = context;
  const {
    address
  } = useAccount();
  const accountChainId = chainId ?? useChainId();
  const isMissingProps = !transactions || !address;
  const isWaitingForReceipt = !!transactionId || !!transactionHash;
  const isDisabled = !receipt && (isLoading || isMissingProps || isWaitingForReceipt || disabled);
  const handleSuccess = useCallback(() => {
    if (receipt && transactionId && transactionHash && chainId && address) {
      const url = new URL("https://wallet.coinbase.com/assets/transactions");
      url.searchParams.set("contentParams[txHash]", transactionHash);
      url.searchParams.set("contentParams[chainId]", JSON.stringify(chainId));
      url.searchParams.set("contentParams[fromAddress]", address);
      return window.open(url, "_blank", "noopener,noreferrer");
    }
    const chainExplorer = getChainExplorer(accountChainId);
    return window.open(`${chainExplorer}/tx/${transactionHash}`, "_blank", "noopener,noreferrer");
  }, [address, chainId, receipt, transactionId, transactionHash, accountChainId]);
  const buttonContent = useMemo(() => {
    if (receipt) {
      return "View transaction";
    }
    if (errorMessage) {
      return "Try again";
    }
    if (isLoading) {
      return /* @__PURE__ */ jsx(Spinner, {});
    }
    return idleText;
  }, [isLoading, errorMessage, receipt, idleText]);
  const handleSubmit = useCallback(() => {
    if (receipt) {
      handleSuccess();
    } else {
      onSubmit();
    }
  }, [onSubmit, receipt, handleSuccess]);
  const status = useMemo(() => {
    if (receipt) {
      return "success";
    }
    if (errorMessage) {
      return "error";
    }
    if (isLoading) {
      return "pending";
    }
    return "default";
  }, [isLoading, errorMessage, receipt]);
  if (render) {
    return render({
      status,
      context,
      onSubmit: handleSubmit,
      onSuccess: handleSuccess,
      isDisabled
    });
  }
  return /* @__PURE__ */ jsx("button", { className: cn(pressable.primary, "ock:rounded-ock-default", "ock:w-full ock:rounded-xl", "ock:px-4 ock:py-3 ock:font-medium ock:leading-6", isDisabled && pressable.disabled, text.headline, "ock:text-ock-foreground-inverse", className), onClick: handleSubmit, type: "button", disabled: isDisabled, "data-testid": "ockTransactionButton_Button", children: buttonContent });
}
export {
  TransactionButton
};
//# sourceMappingURL=TransactionButton.js.map
